<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>JVM ç›‘æ§ä¸è¯Šæ–­å·¥å…·</title>
    <link href="/2021/05/26/jvm-monitor-tool/"/>
    <url>/2021/05/26/jvm-monitor-tool/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ğŸ˜ å‰æ–¹å¤šå›¾å¤šä»£ç å—é¢„è­¦ï¼ï¼ï¼</p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Java è™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼Œå¦‚æœè¿™ä¸ªå¤æ‚çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªé»‘ç›’å­ï¼Œé‚£ä¸€æ—¦å‡ºç°äº†é—®é¢˜é‚£å°†æ˜¯éå¸¸æ£˜æ‰‹çš„ï¼Œæˆ‘ä»¬å°†æ²¡æœ‰ä»»ä½•çš„æ–¹å¼æ–¹æ³•æ¥å®šä½é—®é¢˜ï¼Œè¿™æ˜¯ä¸å¯æ¥å—çš„ã€‚å› æ­¤ JDK å†…ç½®äº†å¾ˆå¤šçš„å·¥å…·å»è¯Šæ–­åˆ†æé—®é¢˜ï¼Œè¿™é‡Œé¢ä¸ä»…åŒ…æ‹¬ä¸€äº›å‘½ä»¤è¡Œå·¥å…·è¿˜æœ‰ä¸€äº›å›¾å½¢åŒ–å·¥å…·ï¼Œæ¯”å¦‚å‘½ä»¤è¡Œæœ‰å¸¸è§çš„ <code>jps</code>ã€<code>jinfo</code>ã€<code>jstat</code>ã€<code>jmap</code>ç­‰ï¼Œå›¾å½¢åŒ–å·¥å…·ä¹Ÿæœ‰ <code>jconsole</code>ã€<code>jvisualvm</code>ã€<code>jmc</code>ç­‰ã€‚å½“ç„¶å®é™…ä¸Šç”Ÿäº§ä¸Šè¿™ç±»å·¥å…·ç”¨çš„è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ã€‚è¿™äº›å·¥å…·äº†å°±å¥½æ¯”æ˜¯èœåˆ€é˜Ÿäº†ï¼Œè€Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬å®šä½é—®é¢˜éƒ½æ˜¯æœ‰æœºæªå¤§ç‚®çš„ã€‚åœ¨å·¥å…·å®Œå¤‡å‡†å¤‡å……åˆ†çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ Prometheus é…ä¸Šé›†æˆå¯è§†åŒ–å·¥å…· Grafana æˆ– DataDogã€‚å‡ºç°é—®é¢˜ä¹‹åï¼Œä¼šä½¿ç”¨ä¸€äº›åˆ†æå·¥å…·ï¼Œå¦‚ <code>Eclipse MAT</code>å†ç»“åˆä¸€äº›åœ¨çº¿å·¥å…·è¿›è¡Œæ•°æ®åˆ†æå¦‚ GCEasy å’Œ FastThreadã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Œç›‘æ§çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Œç›‘æ§çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Œç›‘æ§çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Œç›‘æ§çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬çš„é‡è¦å·¥ä½œä¹‹ä¸€å°±æ˜¯è¦ä¿è¯æˆ‘ä»¬å†™å‡ºæ¥çš„ç¨‹åºæ˜¯æ­£ç¡®çš„ä¸”å¥å£®çš„ï¼Œä¸èƒ½å› ä¸ºä¸€äº›å°å°çš„é—®é¢˜ä»£ç å°±å˜å¾—ä¸å¯ç”¨ï¼Œè¿™æ˜¯ä¸èƒ½æ¥å—çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•å‘ç°æˆ‘ä»¬çš„ç³»ç»Ÿå‡ºç°äº†å¼‚æ ·å‘¢ï¼Ÿå¾ˆç®€å•å°±æ˜¯ç›‘æ§å®ƒï¼Œç±»æ¯”åˆ°äººç±»ä¸–ç•Œï¼Œå°±æ˜¯æˆ‘ä»¬çš„å°åŒºä¿å®‰æ˜¯å¦‚ä½•å¢å¼ºæˆ‘ä»¬çš„å®‰å…¨æ„Ÿçš„å‘¢ï¼Ÿä¹Ÿæ˜¯é€šè¿‡ç›‘æ§çš„æ‰‹æ®µï¼Œåªä¸è¿‡ä¿å®‰ç›‘æ§çš„æ˜¯å°åŒºå†…éƒ¨çš„æƒ…å†µï¼Œè€Œæˆ‘ä»¬ç›‘æ§çš„æ˜¯JVMçš„è¿è¡ŒæŒ‡æ ‡ã€‚è¿™äº›æŒ‡æ ‡åŒ…æ‹¬ä¸€äº›å¸¸è§çš„è¿è¡Œæ—¶æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢æåˆ°çš„å †æ ˆçš„å ç”¨æ•°æ®ï¼Œä»¥åŠæˆ‘ä»¬åé¢ä¼šæåˆ°çš„GCæœ‰å…³æ•°æ®ï¼Œå½“ç„¶è¿˜æœ‰æˆ‘ä»¬æœåŠ¡å™¨æœ¬èº«çš„å†…å­˜å’Œ CPU è´Ÿè½½æƒ…å†µç­‰ã€‚åªæœ‰æœ‰äº†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬æ‰èƒ½è¿˜åŸå¼‚å¸¸æƒ…å†µå‘ç”Ÿæ—¶çš„ç³»ç»Ÿç¯å¢ƒã€‚è¿™å°±æ˜¯åƒæ˜¯è¿˜åŸå‡¶æ€ç°åœºä¸€æ ·åˆºæ¿€ã€‚åˆ†äº«ä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…¬å¸ä¹‹å‰çš„ç³»ç»Ÿæ˜¯æ²¡æœ‰ç›‘æ§çš„ï¼Œæ‰€æœ‰çš„æœåŠ¡å°±æ˜¯ä¸€ä¸ªå•ä½“ç³»ç»Ÿå¹¶ä¸”æ•´ä½“ä»£ç è´¨é‡ä¹Ÿä¸é«˜ï¼Œæœ‰ä¸€æ¬¡ä¸Šçº¿ä¸€ä¸ªç‰ˆæœ¬ç„¶åç¬¬äºŒå¤©ä¸‹åˆä¸šåŠ¡é«˜å³°çš„æ—¶å€™ï¼ŒJVM çªç„¶å¼€å§‹å®•æœºæ‰€æœ‰æœåŠ¡å…¨éƒ¨æŒ‚æ‰ã€‚å½“æ—¶æˆ‘ä»¬æ˜¯å•ä½“æœåŠ¡ï¼ŒJVM ä¹Ÿæ²¡æœ‰é…ç½®ä»»ä½•çš„å¯ä»¥å¯¼å‡ºå †æ ˆä¿¡æ¯çš„JVMå‚æ•°ï¼Œä½†æ˜¯ä¸šåŠ¡æ˜¯åœ¨é«˜å³°æœŸä¸èƒ½åœï¼Œæ‰€ä»¥æˆ‘ä»¬åªæœ‰é‡å¯ï¼Œé‡å¯å®Œè¿‡äº†10åˆ†é’Ÿç»§ç»­æŒ‚æ‰ï¼Œç„¶åæ¥ç€é‡å¯ï¼ŒæœåŠ¡é•¿æ—¶é—´å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚è¿™å°±åƒæ˜¯å‡¶æ¡ˆç°åœºå‡¶æ‰‹ä½œæ¡ˆåï¼Œå‡¶æ€ç°åœºå´ä¸€ä¸ç—•è¿¹éƒ½æ²¡ç•™ä¸‹ï¼Œä¸ä»…æ€ä¼¤åŠ›å·¨å¤§è€Œä¸”ä¾®è¾±æ€§æå¼ºã€‚ æ‰€ä»¥å†å›åˆ°è¿™ä¸ªé—®é¢˜ä¸Šæ¥ï¼Œä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Œ<code>å› ä¸ºæˆ‘ä»¬è¦ä¿è¯ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€éœ€è¦å¯¹ç³»ç»Ÿè¿›è¡Œæ€§èƒ½åˆ†æã€éœ€è¦åœ¨ç³»ç»Ÿå‡ºç°å¼‚å¸¸æ—¶ä¿ç•™è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œç³»ç»Ÿçš„ç›‘æ§å¿…ä¸å¯å°‘ã€‚</code></p><h2 id="JDK-å†…ç½®å·¥å…·"><a href="#JDK-å†…ç½®å·¥å…·" class="headerlink" title="JDK å†…ç½®å·¥å…·"></a>JDK å†…ç½®å·¥å…·</h2><p>æˆ‘ä»¬è¿™é‡Œä¸»è¦è¦ç›‘æ§çš„æ˜¯JVMï¼Œè™½ç„¶ä¸€èˆ¬ç¬¬ä¸€ç›´è§‰æƒ³åˆ°çš„éƒ½æ˜¯ä¸€äº›é«˜å¤§ä¸Šçš„ç›‘æ§å·¥å…·ï¼Œä½†æ˜¯JDKæœ¬èº«ä¹Ÿæä¾›äº†å¾ˆå¤šçš„å·¥å…·ã€‚è¿™é‡Œé¢ä¸ä»…æœ‰å‘½ä»¤è¡Œå·¥å…·è¿˜æœ‰ä¸€äº›å›¾å½¢åŒ–å·¥å…·ã€‚</p><h3 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h3><blockquote><p>ä»¥ä¸‹çš„æµ‹è¯•å…¨éƒ¨åŸºäº jdk11 è¾“å‡ºç»“æœï¼Œæµ‹è¯•ä½¿ç”¨ jdk8 æ—¶åŸºæœ¬å…¨éƒ¨ç¿»è½¦ã€‚</p></blockquote><h4 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h4><p>jps æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­çš„ Java è¿›ç¨‹ã€‚è¿™ä¸ªå‘½ä»¤å­˜åœ¨ç”¨æˆ·æƒé™éš”ç¦»ï¼Œä¹Ÿå°±æ˜¯ root ç”¨æˆ·èƒ½çœ‹åˆ°æ‰€æœ‰çš„ Java è¿›ç¨‹ï¼Œå…¶ä»–çš„ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„ Java çš„è¿›ç¨‹ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘å¯åŠ¨äº† HelloServer å’Œ CxfDemoApplication å…¶ä¸­å‰é¢çš„æ•°å­— 5455 å’Œ 5350 æ˜¯ä»–ä»¬çš„<code>pid</code>ã€‚</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">daiwei@daiweideMacBook-Pro ~ % jps -help<br>usage: jps [-help]<br>       jps [-q] [-mlvV] <span class="hljs-meta">[&lt;hostid&gt;]</span><br><br>Definitions:<br>    &lt;hostid&gt;:      &lt;hostname&gt;[:&lt;port&gt;]<br>    <br>daiwei@daiweideMacBook-Pro ~ % jps<br><span class="hljs-number">5780</span> Jps<br><span class="hljs-number">5350</span> CxfDemoApplication<br><span class="hljs-number">1560</span> RemoteMavenServer36<br><span class="hljs-number">394</span><br><span class="hljs-number">5454</span> Launcher<br><span class="hljs-number">5455</span> HelloServer<br></code></pre></td></tr></table></figure><h4 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h4><p>è¿™ä¸ªå‘½ä»¤çš„å…¨ç¨‹æ˜¯ Java Configuration Infoï¼Œæ‰€ä»¥å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´JVMé…ç½®å‚æ•°ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs gradle">daiwei@daiweideMacBook-Pro ~ % jinfo -help<br>Usage:<br>    jinfo [option] &lt;pid&gt;<br>        (to connect to running process)<br>    jinfo [option] &lt;executable &lt;core&gt;<br>        (to connect to a core <span class="hljs-keyword">file</span>)<br>    jinfo [option] [server_id@]&lt;remote server IP or hostname&gt;<br>        (to connect to remote debug server)<br><br>where &lt;option&gt; is one of:<br>    -flag &lt;name&gt;         to <span class="hljs-keyword">print</span> the value of the named VM flag<br>    -flag [+|-]&lt;name&gt;    to enable or disable the named VM flag<br>    -flag &lt;name&gt;=&lt;value&gt; to set the named VM flag to the given value<br>    -flags               to <span class="hljs-keyword">print</span> VM flags<br>    -sysprops            to <span class="hljs-keyword">print</span> Java system properties<br>    &lt;no option&gt;          to <span class="hljs-keyword">print</span> both of the above<br>    -h | -help           to <span class="hljs-keyword">print</span> <span class="hljs-keyword">this</span> help message<br>daiwei@daiweideMacBook-Pro ~ % jinfo -flalgs <span class="hljs-number">8386</span><br>Java System Properties:<br>#Thu May <span class="hljs-number">20</span> <span class="hljs-number">23</span>:<span class="hljs-number">25</span>:<span class="hljs-number">31</span> CST <span class="hljs-number">2021</span><br>java.<span class="hljs-keyword">runtime</span>.name=Java(TM) SE <span class="hljs-keyword">Runtime</span> Environment<br>sun.boot.library.path=<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<br>java.vm.version=<span class="hljs-number">25.231</span>-b11<br>gopherProxySet=<span class="hljs-keyword">false</span><br>java.vm.vendor=Oracle Corporation<br>java.vendor.url=http\:<span class="hljs-comment">//java.oracle.com/</span><br>path.separator=\:<br>java.vm.name=Java HotSpot(TM) <span class="hljs-number">64</span>-Bit Server VM<br><span class="hljs-keyword">file</span>.encoding.pkg=sun.io<br>user.country=CN<br>sun.java.launcher=SUN_STANDARD<br>sun.os.patch.level=unknown<br>java.vm.specification.name=Java Virtual Machine Specification<br>user.dir=<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/github/</span>thinking-in-code<br>java.<span class="hljs-keyword">runtime</span>.version=<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>_231-b11<br>java.awt.graphicsenv=sun.awt.CGraphicsEnvironment<br>java.endorsed.dirs=<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib/endorsed<br>os.arch=x86_64<br>java.io.tmpdir=<span class="hljs-regexp">/var/</span>folders<span class="hljs-regexp">/4_/</span>dbqw6z6100535snfk5508v080000gn<span class="hljs-regexp">/T/</span><br>line.separator=\n<br>java.vm.specification.vendor=Oracle Corporation<br>os.name=Mac OS X<br>sun.jnu.encoding=UTF-<span class="hljs-number">8</span><br>java.library.path=<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/Extensions\:/</span>Library<span class="hljs-regexp">/Java/</span>Extensions\:<span class="hljs-regexp">/Network/</span>Library<span class="hljs-regexp">/Java/</span>Extensions\:<span class="hljs-regexp">/System/</span>Library<span class="hljs-regexp">/Java/</span>Extensions\:<span class="hljs-regexp">/usr/</span>lib/java\:.<br>sun.nio.ch.bugLevel=<br>java.specification.name=Java Platform API Specification<br>java.<span class="hljs-keyword">class</span>.version=<span class="hljs-number">52.0</span><br>sun.management.compiler=HotSpot <span class="hljs-number">64</span>-Bit Tiered Compilers<br>os.version=<span class="hljs-number">10.16</span><br>user.home=<span class="hljs-regexp">/Users/</span>daiwei<br>user.timezone=Asia/Shanghai<br>java.awt.printerjob=sun.lwawt.macosx.CPrinterJob<br><span class="hljs-keyword">file</span>.encoding=UTF-<span class="hljs-number">8</span><br>java.specification.version=<span class="hljs-number">1.8</span><br>java.<span class="hljs-keyword">class</span>.path=<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/charsets.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>deploy.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>cldrdata.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>dnsns.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>jaccess.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>jfxrt.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>localedata.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>nashorn.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>sunec.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>sunjce_provider.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>sunpkcs11.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>zipfs.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/javaws.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>jce.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/jfr.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>jfxswt.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/jsse.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/m</span>anagement-agent.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/plugin.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>resources.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/rt.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/ant-javafx.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/dt.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/javafx-mx.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/jconsole.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/packager.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/sa-jdi.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/tools.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/gi</span>thub<span class="hljs-regexp">/thinking-in-code/</span>thinking-in-grpc<span class="hljs-regexp">/target/</span>classes\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/io/g</span>rpc<span class="hljs-regexp">/grpc-netty-shaded/</span><span class="hljs-number">1.34</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/grpc-netty-shaded-1.34.1.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/i</span>o<span class="hljs-regexp">/grpc/g</span>rpc-core<span class="hljs-regexp">/1.34.1/g</span>rpc-core-<span class="hljs-number">1.34</span>.<span class="hljs-number">1</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/com/g</span>oogle<span class="hljs-regexp">/android/</span>annotations<span class="hljs-regexp">/4.1.1.4/</span>annotations-<span class="hljs-number">4.1</span>.<span class="hljs-number">1.4</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/io/</span>perfmark<span class="hljs-regexp">/perfmark-api/</span><span class="hljs-number">0.19</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/perfmark-api-0.19.0.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/i</span>o<span class="hljs-regexp">/grpc/g</span>rpc-protobuf<span class="hljs-regexp">/1.34.1/g</span>rpc-protobuf-<span class="hljs-number">1.34</span>.<span class="hljs-number">1</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/io/g</span>rpc<span class="hljs-regexp">/grpc-api/</span><span class="hljs-number">1.34</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/grpc-api-1.34.1.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/i</span>o<span class="hljs-regexp">/grpc/g</span>rpc-context<span class="hljs-regexp">/1.34.1/g</span>rpc-context-<span class="hljs-number">1.34</span>.<span class="hljs-number">1</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/com/g</span>oogle<span class="hljs-regexp">/code/</span>findbugs<span class="hljs-regexp">/jsr305/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/jsr305-3.0.2.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/</span>protobuf<span class="hljs-regexp">/protobuf-java/</span><span class="hljs-number">3.14</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/protobuf-java-3.14.0.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/</span>api<span class="hljs-regexp">/grpc/</span>proto-google-common-protos<span class="hljs-regexp">/1.17.0/</span>proto-google-common-protos-<span class="hljs-number">1.17</span>.<span class="hljs-number">0</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/io/g</span>rpc<span class="hljs-regexp">/grpc-protobuf-lite/</span><span class="hljs-number">1.34</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/grpc-protobuf-lite-1.34.1.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/gu</span>ava<span class="hljs-regexp">/guava/</span><span class="hljs-number">29.0</span>-android<span class="hljs-regexp">/guava-29.0-android.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/gu</span>ava<span class="hljs-regexp">/failureaccess/</span><span class="hljs-number">1.0</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/failureaccess-1.0.1.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/gu</span>ava<span class="hljs-regexp">/listenablefuture/</span><span class="hljs-number">9999.0</span>-empty-to-avoid-conflict-with-guava<span class="hljs-regexp">/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>org<span class="hljs-regexp">/checkerframework/</span>checker-compat-qual<span class="hljs-regexp">/2.5.5/</span>checker-compat-qual-<span class="hljs-number">2.5</span>.<span class="hljs-number">5</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/com/g</span>oogle<span class="hljs-regexp">/j2objc/</span>j2objc-annotations<span class="hljs-regexp">/1.3/</span>j2objc-annotations-<span class="hljs-number">1.3</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/com/g</span>oogle<span class="hljs-regexp">/errorprone/</span>error_prone_annotations<span class="hljs-regexp">/2.3.4/</span>error_prone_annotations-<span class="hljs-number">2.3</span>.<span class="hljs-number">4</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/org/</span>codehaus<span class="hljs-regexp">/mojo/</span>animal-sniffer-annotations<span class="hljs-regexp">/1.18/</span>animal-sniffer-annotations-<span class="hljs-number">1.18</span>.jar\:<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/.m2/</span>repository<span class="hljs-regexp">/io/g</span>rpc<span class="hljs-regexp">/grpc-stub/</span><span class="hljs-number">1.34</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/grpc-stub-1.34.1.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/</span>protobuf<span class="hljs-regexp">/protobuf-java-util/</span><span class="hljs-number">3.12</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/protobuf-java-util-3.12.0.jar\:/U</span>sers<span class="hljs-regexp">/daiwei/</span>.m2<span class="hljs-regexp">/repository/</span>com<span class="hljs-regexp">/google/</span>code<span class="hljs-regexp">/gson/g</span>son<span class="hljs-regexp">/2.8.6/g</span>son-<span class="hljs-number">2.8</span>.<span class="hljs-number">6</span>.jar\:<span class="hljs-regexp">/Applications/I</span>ntelliJ IDEA.app<span class="hljs-regexp">/Contents/</span>lib/idea_rt.jar<br>user.name=daiwei<br>java.vm.specification.version=<span class="hljs-number">1.8</span><br>sun.java.command=io.daiwei.grpc.HelloServer<br>java.home=<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home/jre<br>sun.arch.data.model=<span class="hljs-number">64</span><br>user.language=zh<br>java.specification.vendor=Oracle Corporation<br>awt.toolkit=sun.lwawt.macosx.LWCToolkit<br>java.vm.info=mixed mode<br>java.version=<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>_231<br>java.ext.dirs=<span class="hljs-regexp">/Users/</span>daiwei<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/Extensions\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>ext\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/Extensions\:/</span>Network<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/Extensions\:/</span>System<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/Extensions\:/u</span>sr<span class="hljs-regexp">/lib/</span>java<br>sun.boot.<span class="hljs-keyword">class</span>.path=<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/resources.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>rt.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/sunrsasign.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>jsse.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/jce.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>charsets.jar\:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/jfr.jar\:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre/classes<br>java.vendor=Oracle Corporation<br><span class="hljs-keyword">file</span>.separator=/<br>java.vendor.url.bug=http\:<span class="hljs-comment">//bugreport.sun.com/bugreport/</span><br>sun.io.unicode.encoding=UnicodeBig<br>sun.cpu.endian=little<br>sun.cpu.isalist=<br><br>VM Flags:<br>-XX:CICompilerCount=<span class="hljs-number">4</span> -XX:InitialHeapSize=<span class="hljs-number">268435456</span> -XX:MaxHeapSize=<span class="hljs-number">4294967296</span> -XX:MaxNewSize=<span class="hljs-number">1431306240</span> -XX:MinHeapDeltaBytes=<span class="hljs-number">524288</span> -XX:NewSize=<span class="hljs-number">89128960</span> -XX:OldSize=<span class="hljs-number">179306496</span> -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:+UseParallelGC<br><br>VM Arguments:<br>jvm_args: -javaagent:<span class="hljs-regexp">/Applications/I</span>ntelliJ IDEA.app<span class="hljs-regexp">/Contents/</span>lib<span class="hljs-regexp">/idea_rt.jar=51341:/</span>Applications<span class="hljs-regexp">/IntelliJ IDEA.app/</span>Contents/bin -Dfile.encoding=UTF-<span class="hljs-number">8</span><br>java_command: io.daiwei.grpc.HelloServer<br>java_class_path (initial): <span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/charsets.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>deploy.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>cldrdata.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>dnsns.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>jaccess.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>jfxrt.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>localedata.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>nashorn.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>sunec.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>sunjce_provider.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>sunpkcs11.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext/</span>zipfs.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/javaws.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>jce.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/jfr.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>jfxswt.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/jsse.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/m</span>anagement-agent.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/plugin.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>jre<span class="hljs-regexp">/lib/</span>resources.jar:<span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>jdk1.<span class="hljs-number">8.0</span>_231.jdk<span class="hljs-regexp">/Contents/</span>Home<span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/rt.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents<span class="hljs-regexp">/Home/</span>lib<span class="hljs-regexp">/ant-javafx.jar:/</span>Library<span class="hljs-regexp">/Java/</span>JavaVirtualMachines<span class="hljs-regexp">/jdk1.8.0_231.jdk/</span>Contents/Home<br>Launcher Type: SUN_STANDARD<br></code></pre></td></tr></table></figure><h4 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h4><p>è¿™æ˜¯æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„ä¸€ä¸ªå‘½ä»¤ï¼Œä¹Ÿæ˜¯ç”¨çš„ç¨å¾®å¤šé‚£ä¹ˆä¸€äº›çš„å‘½ä»¤ï¼Œå°±åƒè¿™ä¸ªåå­—ä¸€æ ·ï¼Œjstat å¯ä»¥è¾“å‡ºä¸€äº› jvm çš„çŠ¶æ€ä¿¡æ¯ã€‚å…¶ä¸­ä¸»è¦ç”¨å®ƒå¯ä»¥å®æ—¶åœ°è¾“å‡º GC æœ‰å…³æ•°æ®ã€‚</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs dns">daiwei@daiweideMacBook-Pro ~ % jstat<br>Usage: jstat --help|-options<br>       jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]<br><br>Definitions:<br>  &lt;option&gt;      An option reported by the -options option<br>  &lt;vmid&gt;        Virtual Machine Identifier. <span class="hljs-keyword">A</span> vmid takes the following form:<br>                     &lt;lvmid&gt;[@&lt;hostname&gt;[:&lt;port&gt;]]<br>                Where &lt;lvmid&gt; is the local vm identifier for the target<br>                Java virtual machine, typically a process id<span class="hljs-comment">; &lt;hostname&gt; is</span><br>                the name of the host running the target Java virtual machine<span class="hljs-comment">;</span><br>                and &lt;port&gt; is the port number for the rmiregistry on the<br>                target host. See the jvmstat documentation for a more complete<br>                description of the Virtual Machine Identifier.<br>  &lt;lines&gt;       Number of samples between header lines.<br>  &lt;interval&gt;    Sampling interval. The following forms are allowed:<br>                    &lt;n&gt;[&quot;ms&quot;|&quot;s&quot;]<br>                Where &lt;n&gt; is an integer and the suffix specifies the units as<br>                milliseconds(&quot;ms&quot;) or seconds(&quot;s&quot;). The default units are &quot;ms&quot;.<br>  &lt;count&gt;       Number of samples to take before terminating.<br>  -J&lt;flag&gt;      Pass &lt;flag&gt; directly to the runtime system.<br>  -? -h --help  Prints this help message.<br>  -help         Prints this help message.<br>  <br>daiwei@daiweideMacBook-Pro ~ % jstat -options<br>-class                          # ç±»åŠ è½½ï¼ˆClass loaderï¼‰ä¿¡æ¯ç»Ÿè®¡<br>-compiler                       # JITå³æ—¶ç¼–è¯‘å™¨ç›¸å…³ç»Ÿè®¡ä¿¡æ¯<br>-gc                                 # GCç›¸å…³çš„å †å†…å­˜ä¿¡æ¯ï¼Œç”¨æ³• jstat -gc -h <span class="hljs-number">10</span> -t <span class="hljs-number">864</span> <span class="hljs-number">1</span>s <span class="hljs-number">20</span><br>-gccapacity                 # å„ä¸ªå†…å­˜æ± åˆ†ä»£ç©ºé—´çš„å®¹é‡<br>-gccause                        # çœ‹ä¸Šæ¬¡GCï¼Œæœ¬æ¬¡GCï¼ˆå¦‚æœæ­£åœ¨GCä¸­ï¼‰çš„åŸå› ï¼Œå…¶ä»–è¾“å‡ºå’Œ -gcutil çš„é€‰é¡¹ä¸€è‡´<br>-gcmetacapacity     # å…ƒæ•°æ®åŒºå¤§å°ç»Ÿè®¡<br>-gcnew                          # å¹´è½»ä»£çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œï¼ˆNEW = YOUNG = Eden + S0 + S1ï¼‰<br>-gcnewcapacity          # å¹´è½»ä»£ç©ºé—´å¤§å°ç»Ÿè®¡<br>-gcold                          # è€å¹´ä»£å’Œå…ƒæ•°æ®åŒºçš„è¡Œä¸ºç»Ÿè®¡<br>-gcoldcapacity          # è€å¹´ä»£çš„ç©ºé—´ç»Ÿè®¡<br>-gcutil                         # GCç›¸å…³åŒºåŸŸçš„ä½¿ç”¨ç‡ï¼ˆutillizationï¼‰ç»Ÿè®¡<br>-printcompilation       # æ‰“å°JVMç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ <br><br><br>jstat -gcutil <span class="hljs-number">11064 1000</span> <span class="hljs-number">15</span><br>  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT<br> <span class="hljs-number">37</span>.<span class="hljs-number">50</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">26</span>.<span class="hljs-number">20</span>   <span class="hljs-number">5</span>.<span class="hljs-number">81</span>  <span class="hljs-number">97</span>.<span class="hljs-number">40</span>  <span class="hljs-number">94</span>.<span class="hljs-number">92</span>    <span class="hljs-number">156</span>    <span class="hljs-number">0</span>.<span class="hljs-number">200</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">200</span><br> <span class="hljs-number">37</span>.<span class="hljs-number">50</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">99</span>.<span class="hljs-number">77</span>   <span class="hljs-number">5</span>.<span class="hljs-number">81</span>  <span class="hljs-number">97</span>.<span class="hljs-number">40</span>  <span class="hljs-number">94</span>.<span class="hljs-number">92</span>    <span class="hljs-number">156</span>    <span class="hljs-number">0</span>.<span class="hljs-number">200</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">200</span><br> <span class="hljs-number">43</span>.<span class="hljs-number">75</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>   <span class="hljs-number">6</span>.<span class="hljs-number">00</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">164</span>    <span class="hljs-number">0</span>.<span class="hljs-number">209</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">209</span><br>  <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">43</span>.<span class="hljs-number">75</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>   <span class="hljs-number">6</span>.<span class="hljs-number">18</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">171</span>    <span class="hljs-number">0</span>.<span class="hljs-number">216</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">216</span><br> <span class="hljs-number">50</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">49</span>.<span class="hljs-number">84</span>   <span class="hljs-number">6</span>.<span class="hljs-number">34</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">178</span>    <span class="hljs-number">0</span>.<span class="hljs-number">223</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">223</span><br>  <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">37</span>.<span class="hljs-number">50</span>  <span class="hljs-number">53</span>.<span class="hljs-number">75</span>   <span class="hljs-number">6</span>.<span class="hljs-number">49</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">185</span>    <span class="hljs-number">0</span>.<span class="hljs-number">231</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">231</span><br>  <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">50</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>   <span class="hljs-number">6</span>.<span class="hljs-number">69</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">193</span>    <span class="hljs-number">0</span>.<span class="hljs-number">239</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">239</span><br> <span class="hljs-number">25</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">14</span>.<span class="hljs-number">03</span>   <span class="hljs-number">6</span>.<span class="hljs-number">80</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">200</span>    <span class="hljs-number">0</span>.<span class="hljs-number">246</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">246</span><br> <span class="hljs-number">50</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">32</span>.<span class="hljs-number">01</span>   <span class="hljs-number">6</span>.<span class="hljs-number">93</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">206</span>    <span class="hljs-number">0</span>.<span class="hljs-number">253</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">253</span><br> <span class="hljs-number">50</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">47</span>.<span class="hljs-number">99</span>   <span class="hljs-number">7</span>.<span class="hljs-number">08</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">212</span>    <span class="hljs-number">0</span>.<span class="hljs-number">259</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">259</span><br> <span class="hljs-number">50</span>.<span class="hljs-number">00</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">27</span>.<span class="hljs-number">80</span>   <span class="hljs-number">7</span>.<span class="hljs-number">21</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">218</span>    <span class="hljs-number">0</span>.<span class="hljs-number">266</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">266</span><br> <span class="hljs-number">37</span>.<span class="hljs-number">50</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">57</span>.<span class="hljs-number">97</span>   <span class="hljs-number">7</span>.<span class="hljs-number">34</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br> <span class="hljs-number">37</span>.<span class="hljs-number">50</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">57</span>.<span class="hljs-number">97</span>   <span class="hljs-number">7</span>.<span class="hljs-number">34</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br> <span class="hljs-number">37</span>.<span class="hljs-number">50</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">57</span>.<span class="hljs-number">97</span>   <span class="hljs-number">7</span>.<span class="hljs-number">34</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br> <span class="hljs-number">37</span>.<span class="hljs-number">50</span>   <span class="hljs-number">0</span>.<span class="hljs-number">00</span>  <span class="hljs-number">57</span>.<span class="hljs-number">97</span>   <span class="hljs-number">7</span>.<span class="hljs-number">34</span>  <span class="hljs-number">96</span>.<span class="hljs-number">34</span>  <span class="hljs-number">94</span>.<span class="hljs-number">93</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>     -        -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br> <br>daiwei@daiweideMacBook-Pro ~ % jstat -gc <span class="hljs-number">11064 1000</span> <span class="hljs-number">15</span><br> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT<br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">192</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">19405.0</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">12854.1</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">19977.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2673.3</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">192</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">19405.1</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">12854.1</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">19977.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2673.3</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">192</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">19405.1</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">12854.1</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">19977.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2673.3</span>    <span class="hljs-number">224</span>    <span class="hljs-number">0</span>.<span class="hljs-number">272</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">272</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">160</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>   <span class="hljs-number">5617</span>.<span class="hljs-number">8</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">13354.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20071.3</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">230</span>    <span class="hljs-number">0</span>.<span class="hljs-number">279</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">279</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">224</span>.<span class="hljs-number">0</span>  <span class="hljs-number">31232.0</span>  <span class="hljs-number">10477.4</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">13674.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">237</span>    <span class="hljs-number">0</span>.<span class="hljs-number">286</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">286</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">256</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">21876.8</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">13986.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">244</span>    <span class="hljs-number">0</span>.<span class="hljs-number">294</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">294</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">224</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">0</span>     <span class="hljs-number">175104.0</span>   <span class="hljs-number">14306.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">252</span>    <span class="hljs-number">0</span>.<span class="hljs-number">303</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">303</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">256</span>.<span class="hljs-number">0</span>  <span class="hljs-number">31232.0</span>  <span class="hljs-number">11824.0</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">14658.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.0</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">259</span>    <span class="hljs-number">0</span>.<span class="hljs-number">310</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">310</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">256</span>.<span class="hljs-number">0</span>  <span class="hljs-number">31232.0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">0</span>     <span class="hljs-number">175104.0</span>   <span class="hljs-number">15042.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.8</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">267</span>    <span class="hljs-number">0</span>.<span class="hljs-number">318</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">318</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">256</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>   <span class="hljs-number">6867</span>.<span class="hljs-number">3</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">15330.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.8</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">274</span>    <span class="hljs-number">0</span>.<span class="hljs-number">326</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">326</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">224</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">15562.0</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">15562.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.8</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">280</span>    <span class="hljs-number">0</span>.<span class="hljs-number">332</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">332</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">160</span>.<span class="hljs-number">0</span>  <span class="hljs-number">31232.0</span>    <span class="hljs-number">0</span>.<span class="hljs-number">0</span>     <span class="hljs-number">175104.0</span>   <span class="hljs-number">15842.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20073.8</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">287</span>    <span class="hljs-number">0</span>.<span class="hljs-number">340</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">340</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">192</span>.<span class="hljs-number">0</span>  <span class="hljs-number">31232.0</span>   <span class="hljs-number">7477</span>.<span class="hljs-number">3</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">16090.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20074.2</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">293</span>    <span class="hljs-number">0</span>.<span class="hljs-number">346</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">346</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">224</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">21846.6</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">16138.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20074.2</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">294</span>    <span class="hljs-number">0</span>.<span class="hljs-number">347</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">347</span><br><span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">512</span>.<span class="hljs-number">0</span>  <span class="hljs-number">224</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>   <span class="hljs-number">31232.0</span>  <span class="hljs-number">21846.6</span>   <span class="hljs-number">175104.0</span>   <span class="hljs-number">16138.2</span>   <span class="hljs-number">20736.0</span> <span class="hljs-number">20074.2</span> <span class="hljs-number">2816</span>.<span class="hljs-number">0 2674.4</span>    <span class="hljs-number">294</span>    <span class="hljs-number">0</span>.<span class="hljs-number">347</span>   <span class="hljs-number">0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">000</span>   -          -    <span class="hljs-number">0</span>.<span class="hljs-number">347</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ä¸€æ¬¡æŒç»­ 10 ç§’çš„æœåŠ¡å‹æµ‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›æ•°æ®æŒç»­ä¸æ–­çš„å˜åŒ–ã€‚-gc å’Œ-gcutil çš„å‚æ•°éƒ½æ˜¯ä¸€æ ·çš„ <code>11064</code> æ˜¯ pidï¼Œ<code>1000</code> æ˜¯æ‰“å°æ—¶é—´é—´éš”å•ä½ msï¼Œ<code>15</code> æ˜¯æ‰“å°æ¬¡æ•°ï¼Œæ‰“å°15æ¬¡ã€‚</p><p>gcutil çš„ è¾“å‡ºå‚æ•°ï¼š</p><ul><li><code>S0</code> 0 å· Survivor åŒºçš„ä½¿ç”¨ç™¾åˆ†æ¯”ï¼ˆS0 å’Œ S1 æ€»æœ‰ä¸€ä¸ªæ˜¯ç©ºçš„ï¼‰ã€‚</li><li><code>S1</code> 1 å· Survivor åŒºçš„ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚</li><li><code>E</code> Eden åŒºï¼Œä¹Ÿå°±æ˜¯æ–°ç”Ÿä»£çš„ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚</li><li><code>O</code> Old åŒºè€å¹´ä»£çš„ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚</li><li><code>M</code> MetaåŒºå…ƒæ•°æ®åŒºçš„ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚</li><li><code>CSS</code> å‹ç¼©classç©ºé—´ï¼ˆCompress class spaceï¼‰çš„ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚</li><li><code>YGC</code> youngGC æ¬¡æ•°</li><li><code>YGCT</code> youngGC æ€»è€—æ—¶ï¼Œå•ä½ç§’</li><li><code>FGC</code> fullGC çš„æ¬¡æ•°ï¼Œå¯ä»¥çœ‹åˆ° fullGC ä¸€æ¬¡éƒ½æ²¡æœ‰ã€‚</li><li><code>FGCT</code> fullGC çš„æ€»æ•°æ—¶é—´ï¼Œä¸€æ¬¡FullGC éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥FullGC æ—¶é—´ä¸º 0</li><li><code>CGC</code> concurrentGC å¹¶å‘åƒåœ¾æ”¶é›†æ¬¡æ•°ï¼Œå› ä¸º jdk8 çš„é»˜è®¤å›æ”¶å™¨æ˜¯ parallelGC æ²¡æœ‰å¹¶å‘é˜¶æ®µæ‰€ä»¥è¿™é‡Œæ˜¯ - </li><li><code>CGCT</code> concurrentGC æ”¶é›†æ€»æ—¶é—´ã€‚</li><li><code>GCT</code> æ‰€æœ‰ GC åŠ åœ¨ä¸€èµ·çš„æ—¶é—´ã€‚</li></ul><p>å…¶å® -gcutil å’Œ -gc è¾“å‡ºé€»è¾‘æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯ -gc è¾“å‡ºçš„<code>å®é™…å ç”¨çš„å¤§å°å•ä½ kb</code>ï¼Œå¹¶ä¸” -gc è¾“å‡ºçš„éƒ½æ˜¯ <code>XXU</code>ã€ <code>XXC</code> è¿™ä»£è¡¨ç€ <code>XX Usage</code> å’Œ <code>XX Capacity</code> çš„æ„æ€ã€‚</p><h4 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h4><p>ç”¨äºè¾“å‡ºç³»ç»Ÿ JVM å †ä¿¡æ¯ã€‚ç”¨çš„æœ€å¤šçš„ä¸¤ä¸ªå‘½ä»¤ <code>-histo</code> å’Œ <code>-dump</code> ã€‚å…¶ä¸­<code>-histo</code>ï¼ˆæŸ±çŠ¶å›¾ï¼‰è¾“å‡ºå½“å‰å †ä¸­çš„å¯¹è±¡å¹¶æŒ‰ç…§å ç”¨ç©ºé—´ä»å¤§åˆ°å°æ’åºã€‚<code>-dump</code> dump å½“å‰å †ä¿¡æ¯ã€‚jmap åœ¨ jdk8 ä¸­è¿˜æœ‰ä¸€ä¸ª <code>-heap</code> å‘½ä»¤ï¼Œä½†æ˜¯åœ¨è¿™ä¸€ç‰ˆçš„ jdk11 ä¸­ç§»é™¤äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æœ‰åŠæ³•è¾“å‡º -heap çš„å†…å®¹ï¼Œåˆ«ç€æ€¥å¾€ä¸‹çœ‹ã€‚</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">daiwei@daiweideMacBook-Pro ~ % <span class="hljs-keyword">jmap </span>-help<br><span class="hljs-symbol">Usage:</span><br>    <span class="hljs-keyword">jmap </span>-clstats &lt;pid&gt;<br>        to connect to running process <span class="hljs-keyword">and </span>print class loader statistics<br>    <span class="hljs-keyword">jmap </span>-finalizerinfo &lt;pid&gt;<br>        to connect to running process <span class="hljs-keyword">and </span>print information on objects awaiting finalization<br>    <span class="hljs-keyword">jmap </span>-histo[:live] &lt;pid&gt;<br>        to connect to running process <span class="hljs-keyword">and </span>print histogram of <span class="hljs-keyword">java </span>object heap<br>        if the <span class="hljs-string">&quot;live&quot;</span> <span class="hljs-keyword">suboption </span>is specified, only <span class="hljs-built_in">count</span> live objects<br>    <span class="hljs-keyword">jmap </span>-dump:&lt;dump-options&gt; &lt;pid&gt;<br>        to connect to running process <span class="hljs-keyword">and </span>dump <span class="hljs-keyword">java </span>heap<br>    <span class="hljs-keyword">jmap </span>-? -h --help<br>        to print this help message<br><br>    dump-options:<br>      live         dump only live objects<span class="hljs-comment">; if not specified,</span><br>                   all objects in the heap are dumped.<br>      format=<span class="hljs-keyword">b </span>    <span class="hljs-keyword">binary </span>format<br>      file=&lt;file&gt;  dump heap to &lt;file&gt;<br><br><span class="hljs-symbol">    Example:</span> <span class="hljs-keyword">jmap </span>-dump:live,format=<span class="hljs-keyword">b,file=heap.bin </span>&lt;pid&gt;<br>    <br> daiwei@daiweideMacBook-Pro ~ % <span class="hljs-keyword">jmap </span>-histo <span class="hljs-number">33208</span><br><br> num     <span class="hljs-comment">#instances         #bytes  class name</span><br>----------------------------------------------<br><span class="hljs-symbol">   1:</span>        <span class="hljs-number">106522</span>        <span class="hljs-number">4260880</span>  <span class="hljs-keyword">java.lang.ref.Finalizer</span><br><span class="hljs-keyword"> </span>  <span class="hljs-number">2</span>:        <span class="hljs-number">106222</span>        <span class="hljs-number">4248880</span>  <span class="hljs-keyword">java.util.WeakHashMap$Entry</span><br><span class="hljs-keyword"> </span>  <span class="hljs-number">3</span>:        <span class="hljs-number">106200</span>        <span class="hljs-number">3398400</span>  <span class="hljs-keyword">java.lang.ref.WeakReference</span><br><span class="hljs-keyword"> </span>  <span class="hljs-number">4</span>:          <span class="hljs-number">4569</span>        <span class="hljs-number">2491656</span>  [I<br><span class="hljs-symbol">   5:</span>         <span class="hljs-number">67343</span>        <span class="hljs-number">2154976</span>  com.sun.<span class="hljs-keyword">jna.Memory</span><br><span class="hljs-keyword"> </span>  <span class="hljs-number">6</span>:         <span class="hljs-number">46271</span>        <span class="hljs-number">1698896</span>  [Ljava.lang.Object;<br><span class="hljs-symbol">   7:</span>         <span class="hljs-number">28666</span>        <span class="hljs-number">1330904</span>  [C<br><span class="hljs-symbol">   8:</span>         <span class="hljs-number">13698</span>        <span class="hljs-number">1271480</span>  [<span class="hljs-keyword">B</span><br><span class="hljs-keyword"> </span>  <span class="hljs-number">9</span>:         <span class="hljs-number">31081</span>        <span class="hljs-number">1243240</span>  com.sun.<span class="hljs-keyword">jna.NativeString$StringMemory</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">10</span>:         <span class="hljs-number">14391</span>        <span class="hljs-number">1036744</span>  [<span class="hljs-keyword">J</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">11</span>:         <span class="hljs-number">31081</span>         <span class="hljs-number">745944</span>  com.sun.<span class="hljs-keyword">jna.NativeString</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">12</span>:          <span class="hljs-number">7526</span>         <span class="hljs-number">613808</span>  [Ljava.util.HashMap$Node;<br><span class="hljs-symbol">  13:</span>            <span class="hljs-number">46</span>         <span class="hljs-number">527904</span>  [Ljava.util.WeakHashMap$Entry;<br><span class="hljs-symbol">  14:</span>         <span class="hljs-number">20227</span>         <span class="hljs-number">485448</span>  <span class="hljs-keyword">java.lang.String</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">15</span>:          <span class="hljs-number">6157</span>         <span class="hljs-number">443304</span>  <span class="hljs-keyword">java.lang.reflect.Field</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">16</span>:          <span class="hljs-number">7534</span>         <span class="hljs-number">361632</span>  <span class="hljs-keyword">java.util.HashMap</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">17</span>:         <span class="hljs-number">12098</span>         <span class="hljs-number">290352</span>  <span class="hljs-keyword">java.util.ArrayList</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">18</span>:          <span class="hljs-number">7771</span>         <span class="hljs-number">248672</span>  com.sun.<span class="hljs-keyword">jna.Structure$AutoAllocated</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">19</span>:         <span class="hljs-number">15131</span>         <span class="hljs-number">242096</span>  <span class="hljs-keyword">java.lang.Integer</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">20</span>:          <span class="hljs-number">7074</span>         <span class="hljs-number">226368</span>  <span class="hljs-keyword">java.util.HashMap$Node</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">21</span>:          <span class="hljs-number">3969</span>         <span class="hljs-number">190512</span>  [Loshi.hardware.CentralProcessor$TickType;<br><span class="hljs-symbol">  22:</span>          <span class="hljs-number">2987</span>         <span class="hljs-number">167272</span>  <span class="hljs-keyword">java.util.LinkedHashMap</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">23</span>:          <span class="hljs-number">1277</span>         <span class="hljs-number">146176</span>  <span class="hljs-keyword">java.lang.Class</span><br><span class="hljs-keyword"> </span> <span class="hljs-number">24</span>:          <span class="hljs-number">5978</span>         <span class="hljs-number">144200</span>  [Ljava.lang.reflect.Field;<br>  ......<br><span class="hljs-symbol"> 517:</span>             <span class="hljs-number">1</span>             <span class="hljs-number">16</span>  sun.util.resources.LocaleData<br><span class="hljs-symbol"> 518:</span>             <span class="hljs-number">1</span>             <span class="hljs-number">16</span>  sun.util.resources.LocaleData$LocaleDataResourceBundleControl<br>Total        <span class="hljs-number">710496</span>       <span class="hljs-number">29890984</span><br><br>daiwei@daiweideMacBook-Pro ~ % <span class="hljs-keyword">jmap </span>-dump:format=<span class="hljs-keyword">b,file=dump.hprof </span><span class="hljs-number">34471</span><br>Heap dump file created<br></code></pre></td></tr></table></figure><h4 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h4><p>jmap å¯ä»¥è¾“å‡ºå †ç©ºé—´çš„ä¿¡æ¯ï¼Œjstack å°±æ˜¯è¾“å‡º<code>æ ˆç©ºé—´</code>çš„ä¿¡æ¯ã€‚æœ€ä¸»è¦ä½¿ç”¨çš„<code>-l</code>å³æ‰“å° jvm ä¸­çš„é”ä¿¡æ¯ï¼Œ<code>-e</code>æ‰“å° jvm ä¸­çš„çº¿ç¨‹ä¿¡æ¯ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs routeros">daiwei@daiweideMacBook-Pro ~ % jstack -help<br>Usage:<br>    jstack [-l][-e] &lt;pid&gt;<br>        (<span class="hljs-keyword">to</span> connect <span class="hljs-keyword">to</span> running process)<br><br>Options:<br>    -l  long listing. Prints additional information about locks<br>    -e  extended listing. Prints additional information about threads<br>    -? -h --help -help <span class="hljs-keyword">to</span> <span class="hljs-builtin-name">print</span> this help message<br><br>daiwei@daiweideMacBook-Pro ~ % jstack -l 34979<br>2021-05-22 21:49:23<br>Full thread dump Java HotSpot(TM) 64-Bit<span class="hljs-built_in"> Server </span>VM (25.231-b11 mixed mode):<br><br><span class="hljs-string">&quot;Attach Listener&quot;</span> #11 daemon <span class="hljs-attribute">prio</span>=9 <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff5270d5800 <span class="hljs-attribute">nid</span>=0xa803 waiting on condition [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE<br><br>   Locked ownable synchronizers:<br>    - None<br><br><span class="hljs-string">&quot;Service Thread&quot;</span> #10 daemon <span class="hljs-attribute">prio</span>=9 <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff526079800 <span class="hljs-attribute">nid</span>=0x3e03 runnable [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE<br><br>   Locked ownable synchronizers:<br>    - None<br><br><span class="hljs-string">&quot;C1 CompilerThread3&quot;</span> #9 daemon <span class="hljs-attribute">prio</span>=9 <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff526040800 <span class="hljs-attribute">nid</span>=0x3c03 waiting on condition [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE<br><br>   Locked ownable synchronizers:<br>    - None<br><br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<br><br><span class="hljs-string">&quot;main&quot;</span> #1 <span class="hljs-attribute">prio</span>=5 <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528809000 <span class="hljs-attribute">nid</span>=0xf03 waiting on condition [0x0000700001c52000]<br>   java.lang.Thread.State: TIMED_WAITING (sleeping)<br>    at java.lang.Thread.sleep(Native Method)<br>    at io.daiwei.TestCPULoadMain.main(TestCPULoadMain.java:21)<br><br>   Locked ownable synchronizers:<br>    - None<br><br><span class="hljs-string">&quot;VM Thread&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528840800 <span class="hljs-attribute">nid</span>=0x5003 runnable<br><br><span class="hljs-string">&quot;GC task thread#0 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff52880a800 <span class="hljs-attribute">nid</span>=0x2607 runnable<br><br><span class="hljs-string">&quot;GC task thread#1 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528816000 <span class="hljs-attribute">nid</span>=0x2503 runnable<br><br><span class="hljs-string">&quot;GC task thread#2 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528816800 <span class="hljs-attribute">nid</span>=0x2303 runnable<br><br><span class="hljs-string">&quot;GC task thread#3 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528817000 <span class="hljs-attribute">nid</span>=0x2a03 runnable<br><br><span class="hljs-string">&quot;GC task thread#4 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528817800 <span class="hljs-attribute">nid</span>=0x5403 runnable<br><br><span class="hljs-string">&quot;GC task thread#5 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528818800 <span class="hljs-attribute">nid</span>=0x5203 runnable<br><br><span class="hljs-string">&quot;GC task thread#6 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528819000 <span class="hljs-attribute">nid</span>=0x2c03 runnable<br><br><span class="hljs-string">&quot;GC task thread#7 (ParallelGC)&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528819800 <span class="hljs-attribute">nid</span>=0x2e03 runnable<br><br><span class="hljs-string">&quot;VM Periodic Task Thread&quot;</span> <span class="hljs-attribute">os_prio</span>=31 <span class="hljs-attribute">tid</span>=0x00007ff528875000 <span class="hljs-attribute">nid</span>=0x5503 waiting on condition<br><br>JNI global references: 375<br></code></pre></td></tr></table></figure><h4 id="jcmd"><a href="#jcmd" class="headerlink" title="jcmd"></a>jcmd</h4><p>ä»€ä¹ˆä½ è¯´å‘½ä»¤å¤ªå¤šè®°ä¸ä½ï¼Ÿæ²¡å…³ç³»ã€‚jcmd æ˜¯ä¸€ä¸ªå‘½ä»¤çš„èšåˆï¼Œé‡Œé¢æœ‰å¾ˆå¤šçš„ optionï¼ŒåŸºæœ¬ä¸Šå‰é¢çš„å‘½ä»¤éƒ½å¯ä»¥ç”¨ jcmd è¾“å‡ºï¼Œæ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs vim">daiwei@daiweideMacBook-Pro ~ % jcmd -<span class="hljs-keyword">help</span><br>Usage: jcmd &lt;pid | main class&gt; &lt;<span class="hljs-keyword">command</span> ...|PerfCounter.<span class="hljs-keyword">print</span>|-<span class="hljs-keyword">f</span> <span class="hljs-keyword">file</span>&gt;<br>   <span class="hljs-built_in">or</span>: jcmd -<span class="hljs-keyword">l</span><br>   <span class="hljs-built_in">or</span>: jcmd -h<br><br>  <span class="hljs-keyword">command</span> must <span class="hljs-keyword">be</span> <span class="hljs-keyword">a</span> valid jcmd <span class="hljs-keyword">command</span> <span class="hljs-keyword">for</span> the selected jvm.<br>  Use the <span class="hljs-keyword">command</span> <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">to</span> see which commands are available.<br>  If the pid <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>, commands will <span class="hljs-keyword">be</span> sent <span class="hljs-keyword">to</span> <span class="hljs-keyword">all</span> Java processes.<br>  The main class <span class="hljs-keyword">argument</span> will <span class="hljs-keyword">be</span> used <span class="hljs-keyword">to</span> <span class="hljs-keyword">match</span> (either partially<br>  <span class="hljs-built_in">or</span> fully) the class used <span class="hljs-keyword">to</span> start Java.<br>  If <span class="hljs-keyword">no</span> <span class="hljs-keyword">options</span> are given, lists Java processes (same <span class="hljs-keyword">as</span> -<span class="hljs-keyword">l</span>).<br><br>  PerfCounter.<span class="hljs-keyword">print</span> <span class="hljs-keyword">display</span> the counters exposed by this process<br>  -<span class="hljs-keyword">f</span>  <span class="hljs-keyword">read</span> <span class="hljs-built_in">and</span> <span class="hljs-keyword">execute</span> commands from the <span class="hljs-keyword">file</span><br>  -<span class="hljs-keyword">l</span>  <span class="hljs-keyword">list</span> JVM processes <span class="hljs-keyword">on</span> the local machine<br>  -? -h --<span class="hljs-keyword">help</span> <span class="hljs-keyword">print</span> this <span class="hljs-keyword">help</span> message<br>  <br>daiwei@daiweideMacBook-Pro ~ % jcmd <span class="hljs-number">34979</span><br><span class="hljs-number">34979</span>:<br>The following commands are available:<br>JFR.<span class="hljs-keyword">stop</span><br>JFR.start<br>JFR.dump<br>JFR.check<br>VM.native_memory<br>VM.check_commercial_features<br>VM.unlock_commercial_features<br>ManagementAgent.<span class="hljs-keyword">stop</span><br>ManagementAgent.start_local<br>ManagementAgent.start<br>VM.classloader_stats<br>GC.rotate_log<br>Thread.<span class="hljs-keyword">print</span><br>GC.class_stats<br>GC.class_histogram<br>GC.heap_dump<br>GC.finalizer_info<br>GC.heap_info<br>GC.run_finalization<br>GC.run<br>VM.uptime<br>VM.dynlibs<br>VM.flags<br>VM.system_properties<br>VM.command_line<br>VM.<span class="hljs-keyword">version</span><br><span class="hljs-keyword">help</span><br><br>For more information about <span class="hljs-keyword">a</span> specific <span class="hljs-keyword">command</span> use <span class="hljs-string">&#x27;help &lt;command&gt;&#x27;</span>.<br><br># <span class="hljs-keyword">help</span> å‘½ä»¤<br>daiwei@daiweideMacBook-Pro ~ % jcmd <span class="hljs-number">34979</span> <span class="hljs-keyword">help</span> GC.heap_info<br><span class="hljs-number">34979</span>:<br>GC.heap_info<br>Provide generic Java heap information.<br><br>Impac<span class="hljs-variable">t:</span> Medium<br><br>Permission: java.lang.management.ManagementPermission(monitor)<br><br>Syntax: GC.heap_info<br><br># cmd å‘½ä»¤ä½¿ç”¨ è¿™é‡Œå°±æ˜¯å‰é¢æåˆ°çš„ï¼Œjmap ä¸­ç§»é™¤çš„å‘½ä»¤ï¼Œè¾“å‡ºå †å†…å­˜ä¿¡æ¯ã€‚<br>daiwei@daiweideMacBook-Pro ~ % jcmd <span class="hljs-number">34979</span> GC.heap_info<br><span class="hljs-number">34979</span>:<br> PSYoungGen      total <span class="hljs-number">76288</span>K, used <span class="hljs-number">47314</span>K [<span class="hljs-number">0</span>x000000076ab00000, <span class="hljs-number">0</span>x0000000770000000, <span class="hljs-number">0</span>x00000007c0000000)<br>  eden space <span class="hljs-number">65536</span>K, <span class="hljs-number">55</span>% used [<span class="hljs-number">0</span>x000000076ab00000,<span class="hljs-number">0</span>x000000076cebc930,<span class="hljs-number">0</span>x000000076eb00000)<br>  from space <span class="hljs-number">10752</span>K, <span class="hljs-number">99</span>% used [<span class="hljs-number">0</span>x000000076eb00000,<span class="hljs-number">0</span>x000000076f578010,<span class="hljs-number">0</span>x000000076f580000)<br>  <span class="hljs-keyword">to</span>   space <span class="hljs-number">10752</span>K, <span class="hljs-number">0</span>% used [<span class="hljs-number">0</span>x000000076f580000,<span class="hljs-number">0</span>x000000076f580000,<span class="hljs-number">0</span>x0000000770000000)<br> ParOldGen       total <span class="hljs-number">175104</span>K, used <span class="hljs-number">4582</span>K [<span class="hljs-number">0</span>x00000006c0000000, <span class="hljs-number">0</span>x00000006cab00000, <span class="hljs-number">0</span>x000000076ab00000)<br>  object space <span class="hljs-number">175104</span>K, <span class="hljs-number">2</span>% used [<span class="hljs-number">0</span>x00000006c0000000,<span class="hljs-number">0</span>x00000006c0479a48,<span class="hljs-number">0</span>x00000006cab00000)<br> Metaspace       used <span class="hljs-number">7205</span>K, capacity <span class="hljs-number">7438</span>K, committed <span class="hljs-number">7552</span>K, reserved <span class="hljs-number">1056768</span>K<br>  class space    used <span class="hljs-number">759</span>K, capacity <span class="hljs-number">838</span>K, committed <span class="hljs-number">896</span>K, reserved <span class="hljs-number">1048576</span>K<br></code></pre></td></tr></table></figure><h3 id="å›¾å½¢åŒ–å·¥å…·"><a href="#å›¾å½¢åŒ–å·¥å…·" class="headerlink" title="å›¾å½¢åŒ–å·¥å…·"></a>å›¾å½¢åŒ–å·¥å…·</h3><p>å›¾å½¢åŒ–å·¥å…·å¯ä»¥ä»¥å›¾è¡¨çš„å½¢å¼æ›´ç›´è§‚çš„æŠŠç›‘æ§æ•°æ®å±•ç°å‡ºæ¥ï¼ŒJDKè‡ªå¸¦çš„å›¾å½¢åŒ–å·¥å…·ä¸»è¦åŒ…æ‹¬ <code>jconsole</code>ã€<code>jvisualvm</code>ã€<code>jmc</code>ã€‚è¿™äº›å·¥å…·éƒ½æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ–¹ä¾¿å¼€å‘è€…å¯¹ JVM è¿›è¡Œç›‘æ§ã€‚</p><blockquote><p>jmc åœ¨ JDK11 ä»¥ä¸Šç‰ˆè¢«è¢«ç§»é™¤ï¼Œç‹¬ç«‹ä½œä¸ºä¸€ä¸ªç¨‹åºåŒ…æä¾›ã€‚ JDK 11 ä¾æ—§æœ‰ jmc è¿™ä¸ªå‘½ä»¤ä½†æ˜¯æ‰“ä¸å¼€ã€‚ jmc æˆ‘ä»¬ä¸‹è½½äº†ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œè¿›è¡Œæ“ä½œã€‚åŒæ—¶ä¸‹é¢çš„æ‰€æœ‰æ —å­éƒ½åŸºäº jdk11 è¿›è¡Œæµ‹è¯•ã€‚</p></blockquote><h4 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h4><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥<code>jconsole</code>å³å¯æ‰“å¼€ï¼Œæ‰“å¼€åå¯ä»¥é€‰æ‹©æœ¬åœ° JVM ç›´æ¥è¿æ¥ä¹Ÿå¯ä»¥é€‰æ‹©ï¼ŒJMX çš„æ–¹å¼è¿œç¨‹è¿æ¥ JVMã€‚ä¸‹é¢è¿™å¼ å›¾å°±æ˜¯æ‰“å¼€æœ¬åœ° JVM ç›‘æ§çš„æ¦‚è§ˆé¡µé¢ï¼Œå…¶ä¸­å›¾ä¸­æœ‰6ä¸ª tab é¡µï¼Œåˆ†åˆ«æ˜¯<code>æ¦‚è§ˆ</code>ã€<code>å†…å­˜</code>ã€<code>çº¿ç¨‹</code>ã€<code>ç±»</code>ã€<code>VMæ¦‚è¦</code>ã€<code>Mbean</code>ï¼Œä»æ¦‚è¿°è¿™ä¸ªé¡µé¢ä¸Šèƒ½çœ‹åˆ°å †å†…å­˜ä½¿ç”¨é‡ã€çº¿ç¨‹ã€ç±»ã€CPU å ç”¨ç‡çš„ç³»ç»ŸæŒ‡æ ‡æ•°æ®ã€‚</p><ul><li><code>å †å†…å­˜ä½¿ç”¨é‡</code> è¿™é‡Œæ˜¯å‰é¢æåˆ°çš„ Java å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</li><li><code>çº¿ç¨‹</code> å½“å‰ JVM ä¸­æ´»è·ƒçš„çº¿ç¨‹æ•°ã€‚</li><li><code>ç±»</code> JVM åŠ è½½çš„ç±»çš„ä¸ªæ•°ã€‚</li><li><code>CPUå ç”¨ç‡</code> å½“å‰ç‰©ç†æœºçš„ CPU ä½¿ç”¨æƒ…å†µã€‚</li></ul><p>å›¾ä¸­è¿˜æœ‰å¤šä¸ªæ—¶é—´èŒƒå›´çš„é€‰é¡¹å¯ä»¥é€‰æ‹©ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº 1åˆ†é’Ÿã€5åˆ†é’Ÿã€10åˆ†é’Ÿã€30åˆ†é’Ÿã€1å°æ—¶ã€2å°æ—¶ â€¦â€¦ 1å¤©ã€7å¤© â€¦â€¦ 1ä¸ªæœˆ â€¦â€¦ 1å¹´ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210523105811.png"></p><p>ç¬¬äºŒä¸ªé¢æ¿æ˜¯<code>å†…å­˜</code> è¿™ä¸ªéƒ¨åˆ†æä¾›äº†å¾ˆå¤šçš„å›¾è¡¨ï¼Œå±•ç¤ºäº†å„ä¸ªå†…å­˜éƒ¨åˆ†çš„ä½¿ç”¨æƒ…å†µã€‚æˆ‘è¿™é‡Œè¢«ç›‘æ§åº”ç”¨ä½¿ç”¨çš„æ˜¯ jdk8 ï¼ŒGCæ˜¯é»˜è®¤çš„ parallelGC æ‰€ä»¥è¿™é‡Œå±•ç¤º PS XXX å†…å­˜å›¾è¡¨ï¼Œè¿˜æœ‰ä¸€äº› MetaSpaceã€CodeCacheã€CCS éå †éƒ¨åˆ†å†…å­˜ä½¿ç”¨é‡å›¾ ã€‚å³ä¸Šè§’æœ‰ä¸ª<code>æ‰§è¡ŒGC</code>çš„æŒ‰é’®ï¼Œè¿™ä¸ªæŒ‰é’®å¯ä»¥ç›´æ¥è§¦å‘ JVM çš„ <code>fullGC</code>ï¼Œå³ä¸‹çš„æ•°æ®å°±æ˜¯æ•´ä¸ªå †æŒ‰ç…§å †å’Œéå †é€»è¾‘åˆ’åˆ†åï¼Œå„ä¸ªéƒ¨åˆ†å†…å­˜ä½¿ç”¨æƒ…å†µçš„æŸ±çŠ¶å›¾ï¼Œæˆ‘ä»¬å †é€»è¾‘å†…å­˜åŒºçš„å‘½å<code>å †</code>ä¸<code>éå †</code>ä¹Ÿæ˜¯ä»è¿™æ¥çš„ã€‚å·¦ä¸‹çš„è¯¦ç»†ä¿¡æ¯åˆ™æ˜¯å †ç©ºé—´ GC çš„ç®€å•ç»Ÿè®¡ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210523110244.png"></p><p>ç¬¬ä¸‰ä¸ªé¢æ¿æ˜¯<code>çº¿ç¨‹æœ‰å…³</code>ä¿¡æ¯ï¼Œä¸ŠåŠéƒ¨åˆ†æ˜¯ä¸€ä¸ªæŠ˜çº¿å›¾ï¼Œå±•ç¤ºJVMä¸­æ´»è·ƒå’Œå³°å€¼çš„çº¿ç¨‹æ•°é‡ï¼Œä¸‹åŠéƒ¨åˆ†æ˜¯æ´»è·ƒçš„çŠ¶æ€ä»¥åŠå †æ ˆè¿½è¸ªã€‚å…¶ä¸­é¢æ¿çš„ä¸‹åŠéƒ¨åˆ†æœ‰ä¸ª<code>æ­»é”æ£€æµ‹</code>çš„æŒ‰é’®ï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹å½“å‰JVM ä¸­æ˜¯å¦å­˜åœ¨æ­»é”ã€‚</p><p>  <img src="https://gitee.com/realDaiwei/img/raw/master/20210524154459.png"></p><p>ç¬¬å››ä¸ªé¢æ¿æ˜¯<code>ç±»åŠ è½½</code>æƒ…å†µï¼Œä¸ŠåŠéƒ¨åˆ†æ˜¯ç±»åŠ è½½æ•°é‡çš„æŠ˜çº¿å›¾ï¼Œä¸‹åŠéƒ¨åˆ†æ˜¯è¯¦ç»†æ•°æ®çš„è¾“å‡ºã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524155552.png"></p><p><code>VMæ¦‚è¿°</code> è¿™ä¸ªéƒ¨åˆ†å±•ç¤ºè™šæ‹Ÿæœºå†…éƒ¨çš„ä¸€äº›æ¦‚è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬çº¿ç¨‹ã€å †æ ˆå†…å­˜ã€ç‰©ç†æœºçš„ä¸€äº›å’ŒJVMçš„å‚æ•°ç­‰ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524155942.png"></p><p>MBean çš„æ˜¯ä¸€äº› manage Bean çš„ä¸€äº›è¯¦æƒ…ä¿¡æ¯ã€‚</p><h4 id="jvisualvm"><a href="#jvisualvm" class="headerlink" title="jvisualvm"></a>jvisualvm</h4><p>jvisualvm å’Œ jconsole éƒ½æ˜¯ JDK æ‰“åŒ…çš„ç›‘æ§å›¾å½¢åŒ–å·¥å…·ã€‚è¿™ä¸ªç›‘æ§å·¥å…·æˆ‘æ„Ÿè§‰ç”¨ä¸‹æ¥æ¯” jconsole æ›´å‹å¥½ä¸€äº›ï¼Œjconsole æœ‰ä¸ªåŠŸèƒ½ä»–åŸºæœ¬éƒ½æœ‰ï¼Œå¹¶ä¸” jvisualvm è¿˜å¢åŠ äº†<code>æŠ½æ ·å™¨</code>å’Œ<code>VM dumpåˆ†æ</code>çš„åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥å¯¹è¿è¡Œçš„ JVM è¿›è¡Œå–æ ·åˆ†æã€‚jvisualvm çš„å·¦è¾¹éƒ¨åˆ†æ˜¯åº”ç”¨ç¨‹åºçš„èœå•æ ï¼Œé™¤äº†æœ¬åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ†æè¿œç¨‹çš„JVMï¼ŒVMæ ¸å¿ƒ dumpç­‰ï¼Œå¯ä»¥å¯¹æœ¬åœ°æˆ–è€…å–æ ·å‡ºçš„ JVM æ•°æ®è¿›è¡Œåˆ†æã€‚æˆ‘ä»¬è¿™é‡Œé€‰æ‹© TestCPULoadMain çš„ JVM å®ä¾‹è¿›è¡Œåˆ†æã€‚åœ¨å³è¾¹æ˜¯è¯¦æƒ…é¡µé¢ï¼Œä¸Šé¢æœ‰å‡ ä¸ªtabé¡µé¢ï¼Œæœ‰<code>æ¦‚è¿°</code>ã€<code>ç›‘æ§</code>ã€<code>çº¿ç¨‹</code>ã€<code>æŠ½æ ·å™¨</code>ã€<code>Profiler</code>ï¼Œå…¶ä¸­æŠ½æ ·å™¨æ˜¯ç”¨æ¥åšæŠ½æ ·åˆ†æï¼Œå¯ä»¥æŠ½æ ·å †ç©ºé—´æ•°æ®å’Œçº¿ç¨‹çš„æ•°æ®ï¼ŒProfiler ç”¨æ¥è¿›è¡Œæ€§èƒ½æŠ½æ ·åˆ†æã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524161742.png"></p><p>è¿™é‡Œå¾ˆç›´æ¥çš„æ„Ÿå—åˆ° jvisualvm çš„ä¸€ä¸ªä¼˜ç‚¹ï¼Œjvisualvm æ˜¯å½©è‰²çš„ï¼ï¼jvisualvmåœ¨ç›‘æ§é¡µé¢æŠŠ<code>CPU</code>ã€<code>å †/MetaSpace</code>ã€<code>ç±»</code>ã€<code>çº¿ç¨‹</code>è¿™å››ä¸ªçš„æŠ˜çº¿å›¾å…¨éƒ¨å±•ç¤ºå‡ºæ¥äº†ï¼Œè€Œä¸æ˜¯åƒ jconsole éœ€è¦ä¸€ä¸ªä¸ªé€‰æ‹©åˆ‡æ¢ã€‚å…¶ä¸­ç›‘æ§çš„é¡¹æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰å‹¾é€‰ã€‚è¿™é‡Œå¤„ç†åŸºæœ¬çš„ç›‘æ§æ•°æ®å±•ç¤ºï¼Œé¡µé¢ä¸Šè¿˜æœ‰ä¸¤ä¸ªæŒ‰é’®åˆ†åˆ«æ˜¯<code>æ‰§è¡Œåƒåœ¾å›æ”¶</code> å’Œ <code>å †Dump</code>ã€‚å’Œjconsoleä¸€æ ·ï¼Œæ‰§è¡Œåƒåœ¾å›æ”¶å¯ä»¥ç›´æ¥è§¦å‘ JVM çš„<code>fullGC</code>è€Œ<code>å †Dump</code>å¯ä»¥ç›´æ¥<code>dumpå½“å‰å †ç©ºé—´</code>ã€‚ç›¸æ¯”äº jconsole å‹å¥½å¤ªå¤šã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524162959.png"></p><p>åŒæ—¶ jvisualvm å¯¹äºçº¿ç¨‹çš„ç›‘æ§ä¹Ÿéå¸¸å‹å¥½ï¼Œä¹Ÿéƒ½æ˜¯å½©è‰²çš„ã€‚åŒæ—¶ä¹Ÿæä¾›äº†<code>çº¿ç¨‹Dump</code> çš„æŒ‰é’®ï¼Œç”¨äºdump å½“å‰çš„çº¿ç¨‹ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524163015.png"></p><p>ä¸Šé¢è¿™ä¸¤ä¸ªé¢æ¿éƒ½æœ‰ Dump æ“ä½œï¼Œç‚¹å‡» dump ä¹‹åå¯ä»¥ç›´æ¥è·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¢æ¿ç›´æ¥å±•ç¤º dump åçš„æ•°æ®ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524170053.png"></p><p>æŠ½æ ·å™¨çš„é¡¾åæ€ä¹‰ï¼Œåœ¨JVM è¿è¡ŒæœŸé—´ï¼Œå¯¹æŸä¸ªæ—¶é—´æ®µè¿›è¡ŒæŠ½æ ·ï¼ŒæŠ½æ ·ç›®æ ‡çš„æ•°æ®ä¿¡æ¯ï¼ŒæŠ½æ ·çš„å¯¹è±¡åŒ…æ‹¬<code>CPU</code>å’Œ<code>å†…å­˜</code>ï¼ŒæŠ½æ ·å®Œæˆåç‚¹å‡»<code>å¿«ç…§</code>å³å¯ç”Ÿæˆç”±æŠ½æ ·çš„æ•°æ®ç”Ÿæˆçš„åˆ†æå¿«ç…§ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œå¤šæ¬¡é‡‡æ ·æˆ–è€…å¢é‡é‡‡æ ·æ¥é€‚åº”ä¸åŒçš„æŠ½æ ·éœ€æ±‚ï¼ŒåŒæ—¶åœ¨æŠ½æ ·è¿‡ç¨‹ä¸­ä¹Ÿèƒ½è¿›è¡Œ GC æ“ä½œå’Œ Dump æ“ä½œã€‚æœ€åçš„ profiler å’Œ æŠ½æ ·å™¨åŠŸèƒ½ç±»ä¼¼ç”¨äº JVM æ€§èƒ½çš„æŠ½æ ·åˆ†æã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524171625.png"></p><h4 id="jmcï¼ˆjava-mission-controllerï¼‰"><a href="#jmcï¼ˆjava-mission-controllerï¼‰" class="headerlink" title="jmcï¼ˆjava mission controllerï¼‰"></a>jmcï¼ˆjava mission controllerï¼‰</h4><p>Oracle Java Mission Controlï¼ˆJMCï¼‰æ˜¯ä¸€ç»„åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥åœ¨Oracle JDKä¸Šè¿è¡Œå¹¶ä¸Oracle Java SE Embedded 8è™šæ‹Ÿæœºï¼ˆVMï¼‰è¿›è¡Œäº¤äº’ã€‚è¿™å¥—å·¥å…·æä¾›äº†å¯¹Java SE Embedded 8 VMçš„é«˜çº§ï¼Œç®€å•çš„Javaç›‘è§†å’Œç®¡ç†ï¼Œé€‚ç”¨äºå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒã€‚è¿™ä¸ªå·¥å…·ç›¸è¾ƒäºå‰é¢çš„ jvisualvm æ›´åŠ å¼ºå¤§ã€‚æœ‰æ›´å¤šçš„ç›‘æ§é¡¹ï¼Œåœ¨ jvisualvm æˆ‘ä»¬æåˆ°äº†ä¸€ä¸ªæŠ½æ ·çš„åŠŸèƒ½ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½åœ¨ jmc ç›´æ¥å‡çº§æˆäº† <code>javaé£è¡Œè®°å½•ï¼ˆJFRï¼‰</code> ã€‚JMC åœ¨ jdk 8 ä¹‹åçš„ç‰ˆæœ¬éƒ½æ˜¯ä»¥ç‹¬ç«‹è½¯ä»¶åŒ…çš„å½¢å¼æä¾›ï¼Œä¼ é€é—¨ ===&gt;<a href="http://jdk.java.net/jmc/8/">ä¸‹è½½åœ°å€</a>ã€‚</p><blockquote><p>jmc æˆ‘ä¹‹å‰æ€ä¹ˆå°è¯•éƒ½æ˜¯ç¿»è½¦éƒ½æ²¡æœ‰æˆåŠŸçš„æ‰“å¼€ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘æ‰“å¼€äº†ã€‚è®°å½•ä¸‹æˆ‘çš„ç¯å¢ƒ ï¼ˆmacos BigSur 11.3.1 (20E241) + jdk 1.8.0.231ï¼‰</p></blockquote><p>jms çš„Mbean æ¦‚è§ˆé¡µé¢æ˜¯ä¸‰ä¸ªä»ªè¡¨ç›˜ï¼Œåˆ†åˆ«æ˜¯å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œ CPU ä½¿ç”¨ç‡ï¼Œæœ€è¿‘ä¸€æ¬¡ youngGC å¯¹è±¡å­˜æ´»çš„æ¯”ä¾‹ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524185656.png"></p><p><code>JFR</code>JVM å†…ç½®çš„æ•°æ®æ”¶é›†å¼•æ“ï¼Œæ­£å¦‚è¿™ä¸ªåå­—ä¸€æ · JFRï¼ˆJava flight recoderï¼‰ ä¼šåœ¨è¿è¡ŒæœŸé—´æ”¶é›†JVMå’ŒJava åº”ç”¨çš„è¿è¡Œæ•°æ®ï¼Œå¸®åŠ©å¼€å‘è€…è¯Šæ–­åˆ†æ Java åº”ç”¨ã€‚ä½¿ç”¨ JFR è¦å…ˆè¿›è¡Œ jfr æ–‡ä»¶çš„å½•åˆ¶ï¼Œç„¶å jmc å¯¹ jfr æ–‡ä»¶è¿›è¡Œåˆ†æå¹¶ä»¥å›¾è¡¨çš„å½¢å¼å±•ç¤ºå‡ºæ¥ã€‚å…¶ä¸­å·¦è¾¹çš„åˆ†æç»“æœçš„èœå•æ ‘ï¼Œè€Œå³è¾¹åˆ™æ˜¯åˆ†æç»“æœçš„å›¾è¡¨å±•ç¤ºï¼Œå±•ç¤ºçš„æ•°æ®å†…å®¹éå¸¸çš„è¯¦ç»†ã€‚jfr ä¸ä»…å¯ä»¥é€šè¿‡ jmc è¿›è¡Œå½•åˆ¶ï¼Œè¿˜å¯ä»¥é€šè¿‡å‰é¢æåˆ°çš„<code>jcmd</code>å‘½ä»¤è¿›è¡Œå½•åˆ¶ã€‚å½•åˆ¶å®Œæˆä¹‹åå¯¼å…¥åˆ° jmc ä¸­è¿›è¡Œåˆ†æå³å¯ã€‚JFR å¯ä»¥åœ¨æµ‹è¯•ç¯å¢ƒå’Œä¸ªäººç”µè„‘ä¸Šå…è´¹ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœç”¨äºç”Ÿäº§æœåŠ¡å™¨éœ€è¦å•†ä¸šè®¸å¯è¯ï¼ŒJFRè™½ç„¶å¥½ï¼Œä½†æ˜¯å½•åˆ¶è¿‡ç¨‹å¯¹ä¸­å¯¹æ€§èƒ½è¿˜æ˜¯ä¼šæœ‰ä¸€å®šçš„å½±å“ï¼Œå¤§çº¦ 2% å·¦å³ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210524231602.png"></p><h2 id="å¯è§†åŒ–ç›‘æ§é›†æˆå·¥å…·"><a href="#å¯è§†åŒ–ç›‘æ§é›†æˆå·¥å…·" class="headerlink" title="å¯è§†åŒ–ç›‘æ§é›†æˆå·¥å…·"></a>å¯è§†åŒ–ç›‘æ§é›†æˆå·¥å…·</h2><p>å‰é¢ä»‹ç»äº†JDK è‡ªå¸¦çš„ä¸€äº›ç›‘æ§å·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬å‘½ä»¤è¡Œçš„å·¥å…·å’Œä¸€äº›å›¾å½¢åŒ–çš„å·¥å…·ï¼Œä¸Šé¢çš„é™¤äº† JFR æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ï¼Œå…¶ä»–çš„åŸºæœ¬ä¸Šéƒ½ç”¨ä¸ä¸Šã€‚å› ä¸ºç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨ä¸æ˜¯è°éƒ½èƒ½è¿ä¸Šçš„ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯è¿ç»´ç®¡ç†ï¼Œé‚£æˆ‘ä»¬è¿˜æœ‰å…¶ä»–çš„æ‰‹æ®µå»æ–¹ä¾¿åœ°ç›‘æ§å—ï¼Ÿæœ‰çš„ï¼Œæˆ‘ä»¬ç”Ÿäº§ä½¿ç”¨çš„æ˜¯ grafana + prometheus çš„ç»„åˆã€‚ä¸‹å›¾æ˜¯ç›‘æ§çš„ JVM dashbord æ˜¯å¯¹ JVM å †ç©ºé—´å’Œçº¿ç¨‹çš„ç›‘æ§ã€‚æœ€ä¸Šé¢çš„æ˜¯CPU ä½¿ç”¨ç‡ï¼Œç»¿è‰²è¡¨ç¤ºSystem CPU ä½¿ç”¨ç‡ï¼Œé»„è‰²è¡¨ç¤ºJVM çš„ CPU ä½¿ç”¨ç‡ã€‚ä¸‹é¢çš„ä¸¤ä¸ªå›¾è¡¨åˆ™è¡¨ç¤ºå †ç©ºé—´å’Œéå †éƒ¨åˆ†çš„ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525005416.png"></p><p>ä¸‹é¢è¿™å¼ å›¾ä¸»è¦å±•ç¤ºäº†çº¿ä¸ŠçœŸå®çš„JVM GCçš„æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°å †ç©ºé—´æ›²çº¿éšç€æ—¶é—´æ˜¯å‘ˆç°ä¸€ä¸ªé”¯é½¿çŠ¶çš„ã€‚è€Œéå †éƒ¨åˆ†åˆ™æ˜¯ä¸€ç›´éƒ½æ˜¯å¹³ç›´çš„ï¼Œè¿™æ˜¯åƒåœ¾å›æ”¶å™¨åœ¨å †ä¸­å·¥ä½œçš„ç»“æœã€‚ä¸‹é¢çš„ä¸¤ä¸ªæŠ˜çº¿å›¾åˆ™åˆ†åˆ«æ˜¯GCæ¬¡æ•°å’ŒGCæ—¶é•¿çš„ç»Ÿè®¡å›¾ï¼Œä½†çœ‹åˆ°è¿™ä¸ªå›¾çš„æ—¶å€™æˆ‘æœ‰ä¸€ç‚¹ç–‘æƒ‘çš„åœ°æ–¹ï¼Œå †ç©ºé—´èƒ½æ¸…æ¥šçš„çœ‹åˆ°æ¯æ¬¡åƒåœ¾çš„å›æ”¶äº§ç”Ÿçš„æ›²çº¿ä¸‹é™ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä»–ä¸‹é¢çš„è®°å½•GCæ¬¡æ•°çš„å›¾ä¸­å´æ²¡æœ‰å‘¢ï¼Ÿåæ¥æˆ‘æŸ¥äº†çº¿ä¸Šçš„çš„GCæ—¥å¿—ï¼Œç¡®è®¤æ˜¯GC countä¸­æ¼è®°äº†ã€‚æœ‰å“ªä½å¤§ç¥çŸ¥é“è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Œå¸®æˆ‘ç­”ç–‘è§£æƒ‘ä¸€ä¸‹ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯GC countå’ŒGC timeå›¾è¡¨ä¸‹é¢çš„<code>PS MarkSweep</code>å’Œ <code>PS Scavenge</code> ï¼Œè¿™åˆ†åˆ«ä»£è¡¨è¿™ Parallel GC çš„è€å¹´ä»£å›æ”¶å™¨å’Œæ–°ç”Ÿä»£å›æ”¶å™¨ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525005443.png"></p><p>JVM dashbord è¿˜æœ‰å¾ˆå¤šçš„å›¾è¡¨ï¼Œè¿™äº›éƒ½æ˜¯å¯ä»¥é…ç½®çš„ï¼Œä½†æ˜¯éƒ½æ˜¯å¯¹å †æ ˆçº¿ç¨‹çš„ç›‘æ§ã€‚å½“ç„¶ grafana è¿˜å¯ä»¥é›†æˆå…¶ä»–ç±»å‹çš„ç›‘æ§ï¼Œæ¯”å¦‚ä¸»æœºèµ„æºã€eså’Œhttpè¯·æ±‚ç­‰ç›‘æ§å†…å®¹éå¸¸ä¸°å¯Œã€‚ä½†æ˜¯grafana æˆ–è€… datadog è¿™ç§ç›‘æ§é›†æˆå·¥å…·ä¹Ÿå°±æ˜¯åªæœ‰å±•ç¤ºçš„åŠŸèƒ½ï¼Œå®ƒå¹¶ä¸å…·å¤‡åƒ JFR æˆ– jvisualvm æŠ½æ ·åˆ†æçš„åŠŸèƒ½ã€‚å¦‚æœçœŸçš„å‡ºç°äº†é—®é¢˜è¿˜æ˜¯è¦dumpå†…å­˜çº¿ç¨‹æˆ–è€…å¼€å¯JFRè¿›è¡Œæ’æŸ¥åˆ†æã€‚</p><h2 id="å†…å­˜æ³„æ¼åˆ†æå®ä¾‹"><a href="#å†…å­˜æ³„æ¼åˆ†æå®ä¾‹" class="headerlink" title="å†…å­˜æ³„æ¼åˆ†æå®ä¾‹"></a>å†…å­˜æ³„æ¼åˆ†æå®ä¾‹</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€æ®µä¼šä¸æ–­äº§ç”Ÿåƒåœ¾çš„ä»£ç ï¼Œç„¶åæˆ‘ä»¬è®¾ç½® JVM çš„å¯åŠ¨å‚æ•°ä¸º <code>-Xmx128m -Xms128m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=./heap.hprof</code> ï¼ˆjdk8ï¼‰ã€‚è¿™æ®µå‚æ•°é™åˆ¶çš„å †ç©ºé—´çš„å¤§å°ä¸º<code>128m</code>ï¼Œå¹¶ä¸”åœ¨å †ç©ºé—´æº¢å‡ºæ—¶dumpå †å†…å­˜åˆ°<code>./heap.hprof</code>ä¸­ã€‚åƒåœ¾ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> class GCLogAnalysis &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Random <span class="hljs-built_in">random</span> = <span class="hljs-keyword">new</span> Random();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        <span class="hljs-comment">// å½“å‰æ¯«ç§’æ—¶é—´æˆ³</span><br>        <span class="hljs-keyword">long</span> startMillis = System.currentTimeMillis();<br>        <span class="hljs-comment">// æŒç»­è¿è¡Œæ¯«ç§’æ•°; å¯æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹</span><br>        <span class="hljs-keyword">long</span> timeoutMillis = TimeUnit.SECONDS.toMillis(<span class="hljs-number">10</span>);<br>        <span class="hljs-comment">// ç»“æŸæ—¶é—´æˆ³</span><br>        <span class="hljs-keyword">long</span> endMillis = startMillis + timeoutMillis;<br>        LongAdder counter = <span class="hljs-keyword">new</span> LongAdder();<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;æ­£åœ¨æ‰§è¡Œ...&quot;</span>);<br>        <span class="hljs-comment">// ç¼“å­˜ä¸€éƒ¨åˆ†å¯¹è±¡; è¿›å…¥è€å¹´ä»£</span><br>        <span class="hljs-built_in">int</span> cacheSize = <span class="hljs-number">2000</span>;<br>        <span class="hljs-keyword">Object</span>[] cachedGarbage = <span class="hljs-keyword">new</span> <span class="hljs-keyword">Object</span>[cacheSize];<br>        <span class="hljs-comment">// åœ¨æ­¤æ—¶é—´èŒƒå›´å†…,æŒç»­å¾ªç¯</span><br>        <span class="hljs-keyword">while</span> (System.currentTimeMillis() &lt; endMillis) &#123;<br>            <span class="hljs-comment">// ç”Ÿæˆåƒåœ¾å¯¹è±¡</span><br>            <span class="hljs-keyword">Object</span> garbage = generateGarbage(<span class="hljs-number">100</span>*<span class="hljs-number">1024</span>);<br>            counter.increment();<br>            <span class="hljs-built_in">int</span> randomIndex = <span class="hljs-built_in">random</span>.nextInt(<span class="hljs-number">2</span> * cacheSize);<br>            <span class="hljs-keyword">if</span> (randomIndex &lt; cacheSize) &#123;<br>                cachedGarbage[randomIndex] = garbage;<br>            &#125;<br>        &#125;<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;æ‰§è¡Œç»“æŸ!å…±ç”Ÿæˆå¯¹è±¡æ¬¡æ•°:&quot;</span> + counter.longValue());<br>    &#125;<br><br>    <span class="hljs-comment">// ç”Ÿæˆå¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">Object</span> generateGarbage(<span class="hljs-built_in">int</span> <span class="hljs-built_in">max</span>) &#123;<br>        <span class="hljs-built_in">int</span> randomSize = <span class="hljs-built_in">random</span>.nextInt(<span class="hljs-built_in">max</span>);<br>        <span class="hljs-built_in">int</span> type = randomSize % <span class="hljs-number">4</span>;<br>        <span class="hljs-keyword">Object</span> result = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">switch</span> (type) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                result = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>[randomSize];<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                result = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[randomSize];<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                result = <span class="hljs-keyword">new</span> <span class="hljs-keyword">double</span>[randomSize];<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                StringBuilder builder = <span class="hljs-keyword">new</span> StringBuilder();<br>                <span class="hljs-keyword">String</span> randomString = <span class="hljs-string">&quot;randomString-Anything&quot;</span>;<br>                <span class="hljs-keyword">while</span> (builder.length() &lt; randomSize) &#123;<br>                    builder.<span class="hljs-built_in">append</span>(randomString);<br>                    builder.<span class="hljs-built_in">append</span>(<span class="hljs-built_in">max</span>);<br>                    builder.<span class="hljs-built_in">append</span>(randomSize);<br>                &#125;<br>                result = builder.toString();<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©å †ç©ºé—´æº¢å‡ºå°±å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª<code>heap.hprof</code>æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆ†æçš„ç›®æ ‡æ–‡ä»¶äº†ã€‚å‰é¢æˆ‘ä»¬æåˆ°çš„jmcå¯ä»¥ç”¨æ¥åˆ†æ<code>.hprof</code>æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>Eclipse MAT</code>è¿›è¡Œåˆ†æã€‚ä»¥æˆ‘ä»¬çš„ç»éªŒä¸€èˆ¬å †æ ˆæº¢å‡ºéƒ½æ˜¯å†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æ³„æ¼åˆ†ææŠ¥å‘Šã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525223345.png"></p><p>æ‰“å¼€åç›´æ¥å°±èƒ½çœ‹åˆ° MAT æ ¹æ®å†…å­˜æ•°æ®åˆ†ææ¨æµ‹å‡ºçš„å†…å­˜æ³„æ¼çš„åŸå› ï¼Œä¸‹å›¾å¯ä»¥çœ‹åˆ°<code>Problem Suspect 1</code>å åˆ°äº†<code>99.69%</code>çš„å†…å­˜ï¼Œè™½ç„¶è¿™é‡Œåªæ˜¯åˆšåˆšæ‰“å¼€.hprof æ–‡ä»¶ä½†åŸºæœ¬ä¸Šå¯ä»¥æ¨æµ‹å‡ºå†…å­˜æ³„æ¼çš„åŸå› äº†ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210526175246.png"></p><p>åœ¨ Suspect Report ä¸­æœ‰å¾ˆå¤šçš„é€‰é¡¹ï¼ŒåŒ…æ‹¬ä¸€äº›<code>çº¿ç¨‹</code>å’Œ<code>å †ç§¯å¯¹è±¡</code>ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªéƒ¨åˆ†åŸºæœ¬å¯ä»¥æ¨æ–­å‡ºç³»ç»Ÿå‘ç”Ÿå†…å­˜æº¢å‡ºçš„åŸå› äº†ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬åƒåœ¾ç”Ÿæˆç±»çš„ä¸»çº¿ç¨‹äº§ç”Ÿäº†å¤ªå¤šçš„åƒåœ¾ï¼Œå¯¼è‡´è¾ƒå°çš„å†…å­˜æº¢å‡ºäº†ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525224907.png"></p><p>å¦‚æœåˆ°è¿™é‡Œè¿˜æ˜¯ä¸èƒ½ç¡®å®šé—®é¢˜å‘ç”Ÿçš„æ ¹æºæ²¡å…³ç³»ã€‚MAT è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åˆ†ææ–¹å¼ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ MAT çš„é¦–é¡µä¿¡æ¯ã€‚é¦–å…ˆæœ€ä¸Šé¢æ˜¯ä¸€ä¸ªé¥¼çŠ¶å›¾ï¼Œç„¶åä¸‹é¢æœ‰å„ç§å„æ ·çš„æ“ä½œå’ŒæŠ¥å‘Šå¯ä»¥é€‰æ‹©ï¼Œè¿™é‡Œé¢åŒ…æ‹¬<code>å¯¹è±¡å®ä¾‹çš„æŸ±çŠ¶å›¾</code>ã€<code>å¯¹è±¡çš„æ ‘å½¢ç»“æ„</code>ã€<code>æ‰“å°å¼€é”€æœ€å¤§çš„å‡ ä¸ªå¯¹è±¡</code>å’Œ<code>é‡å¤ç±»åˆ†æ</code>ç­‰ï¼Œè¿˜æœ‰ä¸€äº›åˆ†ææŠ¥å‘Šå¯ä»¥é€‰æ‹©ã€‚åŠŸèƒ½æ–¹é¢è™½ç„¶åˆ†æçš„å†…å®¹æ²¡æœ‰ JFR å…¨é¢ï¼Œä½†æ˜¯é€šå¸¸æ¥è¯´è¿™ä¹ˆå¤šä¿¡æ¯å·²ç»è¶³å¤Ÿå¸®åŠ©æˆ‘ä»¬åˆ†æå‡ºå†…å­˜æ³„æ¼çš„æ ¹æºäº†ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525225515.png"></p><h2 id="çº¿ä¸Šåˆ†æå·¥å…·"><a href="#çº¿ä¸Šåˆ†æå·¥å…·" class="headerlink" title="çº¿ä¸Šåˆ†æå·¥å…·"></a>çº¿ä¸Šåˆ†æå·¥å…·</h2><h3 id="FastThread"><a href="#FastThread" class="headerlink" title="FastThread"></a>FastThread</h3><p>fastThread æ˜¯ä¸€ä¸ªä¼˜ç§€çš„Java dumpçº¿ç¨‹åˆ†æå·¥å…·ï¼Œåªè¦æŠŠçº¿ç¨‹ dump ä¸Šä¼ ï¼Œå³å¯è¿›è¡Œåœ¨çº¿åˆ†æï¼Œåˆ†æç»“æœéƒ½æ˜¯ä»¥å›¾è¡¨å±•ç¤ºï¼Œå¯å±•ç¤ºé¡¹éå¸¸å¤šå¹¶æ”¯æŒç»“æœ pdf å¯¼å‡ºï¼Œæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„åœ¨çº¿åˆ†æå·¥å…·ã€‚è¿™é‡Œå°±ä¸å…·ä½“å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±åŠ¨æ‰‹å®æ“è¯•è¯•ã€‚ä¼ é€é—¨ ==&gt; <a href="https://fastthread.io/">fastThread</a></p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525233153.png"></p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525233653.png"></p><h3 id="GCEasy"><a href="#GCEasy" class="headerlink" title="GCEasy"></a>GCEasy</h3><p>GCEasy æ˜¯ä¸€æ¬¾ä¼˜ç§€å¯è§†åŒ–çš„ GC æ—¥å¿—åˆ†æå·¥å…·ï¼Œä½¿ç”¨å‰éœ€è¦æŠŠæ—¥å¿—ä¿¡æ¯ä¸Šä¼ ç„¶åè¿›è¡Œåˆ†æï¼Œåˆ†æç»“æœä»¥å›¾è¡¨çš„æ–¹å¼å±•ç¤ºï¼ŒåŒæ ·ä¹Ÿæ”¯æŒç»“æœ pdf å¯¼å‡ºã€‚GCEasy å’Œ fastThread æ˜¯åŒä¸€å®¶çš„äº§å“ï¼Œä¸¤è€…å›¾è¡¨é£æ ¼æ˜¯ä¸€è‡´çš„ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åŠ¨æ‰‹å®æ“è¯•è¯•ï¼Œå¾ˆæœ‰æ„æ€ã€‚ä¼ é€é—¨ ==&gt; <a href="https://www.gceasy.io/">GCEasy</a></p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525235015.png"></p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210525235015.png"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä¹‹å‰éƒ½ä¸æ˜¯å¾ˆé‡è§† JVM çš„ç›‘æ§ï¼Œä½†æ˜¯é‚£æ¬¡çº¿ä¸Šäº‹æ•…ä¹‹åæˆ‘æ„è¯†åˆ°JVMç›‘æ§çš„é‡è¦æ€§ã€‚è¿™ä¸€å°èŠ‚æˆ‘ä»¬ä¸€èµ·ä»JDKè‡ªå¸¦çš„ç›‘æ§å·¥å…·å¼€å§‹æ¢³ç†ï¼Œå…¶ä¸­å‘½ä»¤è¡Œå·¥å…·åŒ…æ‹¬å¸¸ç”¨çš„ <code>jps</code>ã€<code>jstatck</code>ã€<code>jmap</code>ã€<code>jstat</code>ã€<code>jcmd</code> ç­‰ï¼Œå›¾å½¢åŒ–å·¥å…·åŒ…æ‹¬ <code>jconsole</code>ã€<code>jvisualvm</code>å’Œåæ¥ç‹¬ç«‹è½¯ä»¶åŒ…çš„<code>jmc</code>ï¼Œå…¶ä¸­jmcä¸­çš„<code>jfr</code>åŸºæœ¬å¯ä»¥æ»¡è¶³ç›‘æ§çš„éœ€æ±‚ã€‚jdk æä¾›çš„å·¥å…·åœ¨ç†æƒ³æƒ…å†µä¸‹æ˜¯èƒ½å¤Ÿæ­£å¸¸ç›‘æ§çš„ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æ˜¯æ— æ³•æ­£å¸¸ä½¿ç”¨äº†ï¼Œä¼šæŠ¥æ— æ³• attach çš„å¼‚å¸¸ï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹Ÿå¹³æ—¶ä¸ä¼šæœ‰ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨çš„æƒé™ã€‚æ‰€ä»¥ä»…ä»…ä½¿ç”¨ JDK è‡ªå¸¦çš„å·¥å…·è¿›è¡Œç›‘æ§æ˜¯ä¸å¤ªç°å®çš„ã€‚é‚£æˆ‘ä»¬è¦å¦‚ä½•è¿›è¡Œç›‘æ§å‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨å¯è§†åŒ–é›†æˆå·¥å…·ï¼Œæˆ‘ä»¬æ¼”ç¤ºçš„æ˜¯ <code>grafana</code> é€šè¿‡é›†æˆ <code>prometheus</code> å®ç°å¯¹ JVM åŸºæœ¬ä¿¡æ¯çš„ç›‘æ§ã€‚åŸºæœ¬å¯ä»¥æ»¡è¶³æˆ‘ä»¬å¯¹äºçº¿ä¸ŠæœåŠ¡å¤§ä½“è¿è¡Œæƒ…å†µçš„ç›‘æ§ã€‚å¦‚æœæˆ‘ä»¬çº¿ä¸Šé‡åˆ°äº†é—®é¢˜æˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿç´§æ¥ç€æˆ‘ä»¬æ¼”ç¤ºäº†ä¸€ä¸ªå†…å­˜æ³„æ¼çš„åˆ†ææ¡ˆä¾‹ï¼Œä½¿ç”¨<code>Eclipse MAT</code>å¯¹ä¸€ä¸ªå†…å­˜æº¢å‡ºçš„<code>.hprof</code>æ–‡ä»¶è¿›è¡Œç®€å•å®ä¾‹åˆ†æã€‚æœ€åæˆ‘ä»¬ç®€å•ä»‹ç»äº†ä¸¤ä¸ªåœ¨çº¿åˆ†æå·¥å…· fastThread å’Œ GCEasyã€‚JVM ç›‘æ§è¿˜æœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å¼€æºå·¥å…·<code>Arthas</code>ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åŠ¨æ‰‹å®è·µã€‚</p><p>è¿™ä¸€å°èŠ‚æœ‰å¤§é‡çš„åŠ¨æ‰‹å®è·µï¼Œå†åŠ ä¸Šæˆ‘æœ€è¿‘ä¹ŸæŒºå¿™çš„ï¼Œè¿™ä¸€å°èŠ‚æˆ‘å†™äº†å¥½ä¹…å¥½ä¹…ğŸ˜…ğŸ˜…ã€‚ç»ˆäºè¦è¿›å…¥ JVM å¾ˆç²¾å½©çš„GCæ¨¡å—äº†ï¼Œæ¢³ç†å®ŒGCæ¨¡å—ä»€ä¹ˆJVMè°ƒä¼˜ï¼ŒGCåˆ†æå°±éƒ½ä¸æ˜¯äº‹äº†ã€‚åŠ æ²¹ï¼Œä½ çš„åŠªåŠ›ç»ˆç©¶ä¼šç…§äº®ä½ çš„ç”Ÿæ´»ï¼Œæ™šå®‰ï½</p>]]></content>
    
    
    <categories>
      
      <category>Javaè™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>JavaçŸ¥è¯†ç»“æ„æ¢³ç†</tag>
      
      <tag>å­¦ä¹ æ€»ç»“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM å†…å­˜ç»“æ„ä¸å†…å­˜æ¨¡å‹åˆæ­¥</title>
    <link href="/2021/05/17/java-memory-structure-and-basic-model/"/>
    <url>/2021/05/17/java-memory-structure-and-basic-model/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å‰é¢çš„å°èŠ‚ä¸­ï¼Œæ€»ç»“æ¢³ç†äº† JVM åº•å±‚çš„ä¸€äº›åŸºç¡€çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬ JVM å­—èŠ‚ç æŠ€æœ¯ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼Œåå°„ï¼Œå¼‚å¸¸ç­‰æ–¹æ³•æµç¨‹ï¼ŒåŸºç¡€çš„æœ€åä¸€éƒ¨åˆ†æ¢³ç†äº†ç±»åŠ è½½æœºåˆ¶å’Œå¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‚æœ‰äº†è¿™ä¸€å¥—æœºåˆ¶ JVM èƒ½å¤Ÿé¡ºåˆ©çš„è¯»å–Javaæ–‡ä»¶ï¼Œå¹¶è¡Œæ‰§è¡Œé€»è¾‘ã€‚çœ‹èµ·æ¥éƒ½æœ‰äº†ï¼Œä½†æ˜¯å°‘äº†ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†æ²¡é”™ï¼Œå°±æ˜¯å†…å­˜ã€‚è¿™è®¡ç®—æœºçš„å†…å­˜è¿™ä¸ªéƒ¨åˆ†æ¥çš„åƒç†æ‰€å½“ç„¶ä¸€æ ·ã€‚å…¶å®æœ€åŸå§‹çš„è®¡ç®—æœºæ˜¯æ²¡æœ‰å†…å­˜è¿™ä¸ªæ¦‚å¿µçš„ï¼Œåæ¥å†¯è¯ºä¾æ›¼æå‡ºäº†å†¯è¯ºä¾æ›¼ç»“æ„ï¼Œå†¯è¯ºä¾æ›¼ç¡®å®šäº†è®¡ç®—æœºçš„ç»“æ„ï¼Œå³ç¡®å®šäº†è®¡ç®—æœºçš„ 5 å¤§éƒ¨ä»¶ï¼Œå³<code>è¿ç®—å™¨</code>ã€<code>æ§åˆ¶å™¨</code>ã€<code>å­˜å‚¨å™¨</code>ã€<code>è¾“å…¥è®¾å¤‡</code>å’Œ<code>è¾“å‡ºè®¾å¤‡</code>ã€‚ç°ä»£è®¡ç®—æœºçš„éƒ½æ˜¯éµå¾ªå†¯è¯ºä¾æ›¼ç»“æ„çš„ï¼Œå› æ­¤åˆç§°ä¸ºå†¯è¯ºä¾æ›¼æœºã€‚æ‰€ä»¥ä½œä¸ºè™šæ‹Ÿæœºæ€ä¹ˆèƒ½æ²¡æœ‰å†…å­˜å‘¢ï¼ŸJava å†…å­˜æ¨¡å‹è§„å®šäº† JVM åº”è¯¥å¦‚ä½•ä½¿ç”¨è®¡ç®—æœºå†…å­˜ï¼ˆRAMï¼‰ã€‚å¹¿ä¹‰ä¸Šæ¥è®²ï¼ŒJavaå†…å­˜æ¨¡å‹åˆ†åˆ«ä¸ºä¸¤ä¸ªéƒ¨åˆ† <code>JVMå†…å­˜ç»“æ„</code> å’Œ <code>JMMä¸çº¿ç¨‹è§„èŒƒ</code>ã€‚</p><h2 id="JVM-å†…å­˜ç»“æ„"><a href="#JVM-å†…å­˜ç»“æ„" class="headerlink" title="JVM å†…å­˜ç»“æ„"></a>JVM å†…å­˜ç»“æ„</h2><p>JVM å†…å­˜ç»“æ„æ˜¯ JVM çš„åº•å±‚çš„å®ç°ï¼Œå®ƒå†³å®šäº†è¿è¡Œæ—¶æ•°æ®çš„æ•°æ®åŒºåˆ’åˆ†ã€‚é‚£ä¹ˆå¦‚æœè®©ä½ ç»“åˆæˆ‘ä»¬å‰é¢çš„çŸ¥è¯†è®¾è®¡ä¸€ä¸ª JVM ç»“æ„æ¨¡å‹ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><h3 id="åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ª-JVM-å†…å­˜ç»“æ„"><a href="#åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ª-JVM-å†…å­˜ç»“æ„" class="headerlink" title="åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ª JVM å†…å­˜ç»“æ„"></a>åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ª JVM å†…å­˜ç»“æ„</h3><p>ä»æˆ‘ä»¬å‰é¢æ¢³ç†çš„ JVM æ–¹æ³•è°ƒç”¨å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ–¹æ³•è°ƒç”¨ä¼šç”¨åˆ°æ ˆï¼Œæ¯ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„çº¿ç¨‹æ ˆï¼Œçº¿ç¨‹æ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ã€‚åœ¨ç±»åŠ è½½é‚£ä¸€å°èŠ‚æˆ‘ä»¬çŸ¥é“äº†å¯¹è±¡å®ä¾‹å­˜åœ¨å †ä¸Šï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜åœ¨æ ˆä¸Šçš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å®ä¾‹å¯¹è±¡çš„åœ°å€ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå †ç©ºé—´ã€‚æ‰€ä»¥å†…å­˜ç©ºé—´æˆ‘ä»¬å¯ä»¥ç®€å•åˆ’åˆ†ä¸ºæ ˆï¼ˆstackï¼‰ + å †ï¼ˆheapï¼‰ çš„ç»“æ„ï¼ˆ1.0 ç‰ˆæœ¬ï¼‰ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210515190729.png"></p><p>çº¿ç¨‹æ ˆä¸Šæ˜¯æœ‰æ•°æ®çš„ï¼ŒåŒ…æ‹¬ä¸€äº›å±€éƒ¨æ–¹æ³•å†…éƒ¨çš„åŸºç¡€ç±»å‹å˜é‡å’Œä¸€äº›å¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å †ä¸­å®ä¾‹åœ°å€ã€‚ä¸Šé¢è¿™ä¸ªå›¾å¤ªè¿‡äºç²—ç•¥äº†æˆ‘ä»¬åŠ å…¥ä¸€ç‚¹ç‚¹ç»†èŠ‚ã€‚å°±åƒä¸‹å›¾é…±ç´«ï¼Œæ¯ä¸ªæ ˆæœ‰å±€éƒ¨å˜é‡å’Œå¯¹è±¡å¼•ç”¨ï¼Œå¯¹è±¡çš„å¼•ç”¨åœ°å€æŒ‡å‘å †ä¸­ã€‚ï¼ˆ2.0 ç‰ˆæœ¬ï¼‰</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210515192514.png"></p><p>ç»“åˆä¸‹æˆ‘ä»¬ä¹‹å‰æ¢³ç†çš„ç±»åˆå§‹åŒ–å’Œå®ä¾‹å¯¹è±¡æœ‰å…³å†…å­˜çš„éƒ¨åˆ†å†æ¬¡ç®€å•è¿‡ä¸€éã€‚ç±»åŠ è½½å™¨åŠ è½½ç±»å¹¶ä¸”è§£ææˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç ä¸­ä¼šæœ‰ä¼šæœ‰æµç¨‹æ§åˆ¶æ–¹æ³•å­—èŠ‚ç å’Œå¸¸é‡æ± ç­‰ä¿¡æ¯ã€‚å…¶ä¸­æ–¹æ³•åå’Œç±»åéƒ½ä¼šå…ˆç”¨å¸¸é‡ä»£æ›¿ï¼Œç„¶ååœ¨ç±»åŠ è½½çš„è§£æé˜¶æ®µæ›¿æ¢æˆå¼•ç”¨ã€‚æœ€åå®ä¾‹å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ç±»çš„ class çš„å¸¸é‡ä¿¡æ¯åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚å®ä¾‹å¯¹è±¡ä¸»è¦æœ‰ä¸‰ä¸ªéƒ¨åˆ†å¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¡«å……æ•°æ®ã€‚è¿™é‡Œé¢å¯¹è±¡å¤´é‡Œé¢åˆæœ‰ä¸€ä¸ª markWord å’Œ classPointerï¼ŒclassPointer æŒ‡å‘æ–¹æ³•åŒºä¸­å®ä¾‹çš„ class å¯¹è±¡ã€‚è¿™ä¸€è·¯æ¢³ç†ä¸‹æ¥ä¸éš¾å‘ç°ï¼Œæˆ‘ä»¬å°‘äº†ä¸€ä¸ªå¸¸é‡æ± å’Œä¸€ä¸ªæ–¹æ³•åŒºã€‚æˆ‘ä»¬å†åŠ å…¥ä¸€ç‚¹ç‚¹ç»†èŠ‚ã€‚ï¼ˆ3.0 ç‰ˆæœ¬ï¼‰</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210515195133.png"></p><p>ç»“åˆä¹‹å‰çš„çŸ¥è¯†æˆ‘è®¾è®¡çš„ä¸€ä¸ªç®€å•çš„ JVM å†…å­˜ç»“æ„å°±å‡ºæ¥äº†ï¼Œå¤§å®¶å¯ä»¥æŒ‰ç…§è‡ªå·±çš„ç†è§£åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ªå†…å­˜ç»“æ„ï¼Œä¸€å®šä¼šæœ‰ä¸ä¸€æ ·çš„æ”¶è·ã€‚ </p><h3 id="JVM-å†…å­˜ç»“æ„æ¦‚è¿°"><a href="#JVM-å†…å­˜ç»“æ„æ¦‚è¿°" class="headerlink" title="JVM å†…å­˜ç»“æ„æ¦‚è¿°"></a>JVM å†…å­˜ç»“æ„æ¦‚è¿°</h3><p> å‰é¢æ˜¯ç»“åˆ JVM çš„å­—èŠ‚ç ç±»åŠ è½½ç­‰æœºåˆ¶æ„æƒ³è®¾è®¡å‡ºæ¥çš„ JVM å†…å­˜ï¼ŒçœŸæ­£çš„ JVM å†…å­˜å¯èƒ½ä¸é•¿è¿™ä¸ªæ ·å­ï¼Œé‚£çœŸæ­£çš„ JVM å†…å­˜ç»“æ„é•¿ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿå› ä¸ºæˆ‘åœ¨ä¹‹å‰è¿˜æ˜¯æœ‰æ¥è§¦è¿‡ä¸€äº› JVM å†…å­˜ç»“æ„è¿™å—çš„çŸ¥è¯†ï¼Œä¹‹å‰çš„çŸ¥è¯†å·²ç»ç»™æˆ‘çš„è®¾è®¡æ‰“ä¸‹ä¸€ä¸ªå¤§è‡´çš„æ–¹å‘äº†ï¼Œæ‰€ä»¥æˆ‘ç”»å‡ºæ¥çš„ JVM çš„åŸºæœ¬é€»è¾‘ç»“æ„å’Œæˆ‘ä»¬è®¾è®¡çš„å¤§ä½“çš„æ–¹å‘ä¸Šè¿˜æ˜¯ä¸€è‡´çš„ã€‚JVM å†…å­˜ç»“æ„é€»è¾‘ä¸Šå¤§ä½“åˆ†ä¸ºï¼šçº¿ç¨‹æ ˆï¼ˆstackï¼‰å’Œ å †å†…å­˜ï¼ˆheapï¼‰ä¸¤ä¸ªéƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯ 1.0 ç‰ˆæœ¬ä¸€è‡´ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210515190729.png" alt="image.png"></p><p>JVM ä¸­ï¼ŒçœŸåœ¨è¿è¡Œçš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„çº¿ç¨‹æ ˆã€‚çº¿ç¨‹æ ˆä¸ŠåŒ…å«æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•é“¾/è°ƒç”¨é“¾ä¸Šçš„æ‰€æœ‰æ–¹æ³•çš„çŠ¶æ€ä¿¡æ¯ã€‚æ‰€æœ‰çº¿ç¨‹æ ˆåˆè¢«æˆä¸º<code>æ–¹æ³•æ ˆ</code>æˆ–<code>è°ƒç”¨æ ˆ</code>ï¼ˆcall stackï¼‰ã€‚çº¿ç¨‹åœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œè°ƒç”¨æ ˆä¸­çš„ä¿¡æ¯ä¼šä¸€ç›´å˜æ¢ã€‚æˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸æ—¶æ‰“å°å‡ºçš„å †æ ˆä¿¡æ¯ä¹Ÿå°±æ˜¯è¿™ä¸ªæ–¹æ³•è°ƒç”¨æ ˆã€‚</p><p>çº¿ç¨‹æ ˆä¸Šä¿å­˜äº†è°ƒç”¨é“¾ä¸Šçš„æ­£åœ¨æ‰§è¡Œçš„æ‰€æœ‰æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚</p><ul><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„çº¿ç¨‹æ ˆã€‚</li><li>æ¯ä¸ªçº¿ç¨‹æ ˆéƒ½ä¸èƒ½è®¿é—®ï¼ˆçœ‹ä¸è§ï¼‰å…¶ä»–çš„çº¿ç¨‹çš„å±€éƒ¨å˜é‡ã€‚</li></ul><p>å³æ—¶ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œå…¨ç›¸åŒçš„ä»£ç ï¼Œä»–ä»¬ä¹Ÿçœ‹ä¸åˆ°å½¼æ­¤çš„å±€éƒ¨å˜é‡ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåœ¨è‡ªå·±çš„çº¿ç¨‹<code>æ ˆå†…åˆ›å»º</code>ä»£ç ä¸­å¯¹åº”çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªçº¿ç¨‹æ ˆä¸­çš„æ•°æ®åªæ˜¯ä¸€ä¸ª<code>å‰¯æœ¬</code>ï¼Œçº¿ç¨‹ä¸çº¿ç¨‹ä¹‹é—´å¹¶ä¸å…±äº«ã€‚</p><ul><li>æ‰€æœ‰çš„åŸç”Ÿæ•°æ®å˜é‡éƒ½å­˜å‚¨åœ¨çº¿ç¨‹æ ˆä¸­ï¼Œå› æ­¤å¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§ã€‚</li><li>çº¿ç¨‹æ ˆå¯ä»¥å°†ä¸€ä¸ªåŸç”Ÿå˜é‡çš„å‰¯æœ¬ä¼ ç»™å¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†ä¸å…±äº«åŸç”Ÿå˜é‡å‰¯æœ¬æœ¬èº«ã€‚</li><li>å †ä¸­åŒ…å«äº†Java ä»£ç ä¸­åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ï¼Œä¸ç®¡æ˜¯å“ªä¸ªçº¿ç¨‹åˆ›å»ºçš„ï¼Œå…¶ä¸­ä¹Ÿæ¶µç›–äº†åŒ…è£…ç±»å‹ï¼ˆä¾‹å¦‚ Byteã€Integerã€Boolean ç­‰ï¼‰ã€‚</li><li>ä¸ç®¡æ˜¯åˆ›å»ºç»™å±€éƒ¨å˜é‡ï¼Œè¿˜æ˜¯åˆ›å»ºå¯¹è±¡èµ‹ç»™å±€éƒ¨å˜é‡ï¼Œåˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šä¿å­˜åœ¨å †ä¸­ã€‚</li></ul><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼ŒåŸç”Ÿæ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨åœ¨çº¿ç¨‹æ ˆä¸Šï¼Œå®ä¾‹å¯¹è±¡ï¼Œå¯¹è±¡æˆå‘˜æ¥ã€ç±»å®šä¹‰å’Œé™æ€å˜é‡éƒ½åœ¨å †ä¸Šã€‚çº¿ç¨‹æ ˆä¸Šçš„æ•°æ®æ˜¯å‰¯æœ¬ï¼Œæ‰€ä»¥çº¿ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»ã€‚</p></blockquote><p>å †å†…å­˜åˆç§°ä¸º<code>å…±äº«å †</code>ï¼Œ<code>å †ä¸­çš„æ‰€æœ‰å¯¹è±¡å¯ä»¥è¢«æ‰€æœ‰çš„çº¿ç¨‹è®¿é—®åˆ°</code>ï¼Œåªè¦ä»–ä»¬èƒ½æ‹¿åˆ°å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚</p><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®åˆ°æŸä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚</li><li>å¦‚æœä¸¤ä¸ªçº¿ç¨‹èƒ½åŒæ—¶è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œåˆ™å®ƒä»¬å®ƒä»¬éƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä½†æ¯ä¸ªçº¿ç¨‹çš„å±€éƒ¨å˜é‡å‰¯æœ¬éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚ï¼ˆæ–¹æ³•ä¼ å…¥åŒä¸€å¯¹è±¡ï¼Œåªè¦æ˜¯åŒä¸€å¼•ç”¨å°±éƒ½èƒ½çœ‹è§ã€‚ï¼‰</li></ul><p>æŠŠä¸Šé¢è¿™äº›ä¸œè¥¿è½å®åˆ°å›¾ä¸Šå°±æ˜¯æˆ‘ä»¬çš„ 2.0 ç‰ˆæœ¬ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210515192514.png"></p><blockquote><p>ç®€å•å°æ€»ç»“ä¸‹ï¼šè™½ç„¶å„ä¸ªçº¿ç¨‹è‡ªå·±ä½¿ç”¨çš„å±€éƒ¨å˜é‡éƒ½åœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆä¸Šï¼Œä½†æ˜¯å¤§å®¶å¯ä»¥å…±äº«å †ä¸Šçš„å¯¹è±¡ã€‚å¦‚æœä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹çš„åŸºç¡€ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå¹¶å¾€è‡ªå·±çš„çº¿ç¨‹æ ˆä¸Šèµ‹å€¼ï¼Œå®ä¾‹å¯¹è±¡ä¼šç»™çº¿ç¨‹ä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚</p></blockquote><h3 id="æ ˆå†…å­˜ç»“æ„"><a href="#æ ˆå†…å­˜ç»“æ„" class="headerlink" title="æ ˆå†…å­˜ç»“æ„"></a>æ ˆå†…å­˜ç»“æ„</h3><p>å‰é¢æˆ‘ä»¬è‡ªå·±å°è¯•è®¾è®¡çš„æ ˆç»“æ„éå¸¸çš„ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•æ ˆçš„æ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šå¹¶ä¸å®Œå…¨æ˜¯è¿™æ ·ã€‚ç»“åˆå‰é¢æ–¹æ³•è°ƒç”¨éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œæ ˆçš„é€»è¾‘åŒºåŸŸé‡Œåº”è¯¥æœ‰å¾ˆå¤šçš„çº¿ç¨‹æ ˆï¼Œæ¯•ç«Ÿä¸€ä¸ªçº¿ç¨‹å°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ ˆï¼ˆè°ƒç”¨ JNI æ–¹æ³•ä¼šä½¿ç”¨ Native æ ˆï¼‰ã€‚è€Œä¸”çº¿ç¨‹æ ˆé‡Œé¢åº”è¯¥ä¹Ÿä¼šæœ‰å¾ˆå¤šçš„æ ˆå¸§ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“æ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å°±ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œå°±ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªç»“æ„ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210516153009.png"></p><p>æˆ‘ä»¬çŸ¥é“è°ƒç”¨æ–¹æ³•å°±ä¼šåˆ›å»ºæ ˆå¸§ï¼Œæ ˆå¸§é‡Œé¢æœ‰<code>æ“ä½œæ•°æ ˆ</code>ï¼Œ<code>å±€éƒ¨å˜é‡è¡¨</code>å’Œä¸€ä¸ª<code>class/methodå¼•ç”¨</code>ï¼Œæœ‰äº†è¿™äº›è¿˜ä¸å¤Ÿè¿™äº›åªèƒ½ä¿è¯æ–¹æ³•çš„é¡ºåˆ©æ‰§è¡Œï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åè¿˜è¦è¿”å›ã€‚æ‰€ä»¥è¿˜æœ‰ä¸€ä¸ª<code>è¿”å›åœ°å€</code>ã€‚æ‰€ä»¥æ ˆå¸§å†…éƒ¨çš„å›¾å¤§è‡´æ˜¯è¿™æ ·çš„ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210516154106.png"></p><h3 id="å †å†…å­˜çš„ç»“æ„"><a href="#å †å†…å­˜çš„ç»“æ„" class="headerlink" title="å †å†…å­˜çš„ç»“æ„"></a>å †å†…å­˜çš„ç»“æ„</h3><p>åœ¨ä¸Šé¢çš„çº¿ç¨‹çš„åˆ†æå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ JVM è¿›ç¨‹é‡Œé¢æœ‰å †å†…å­˜å’Œéå †å†…å­˜ï¼Œè¿™ä¸ªéå †åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåˆ«ç€æ€¥æˆ‘ä»¬æ…¢æ…¢å¾€ä¸‹çœ‹ã€‚åœ¨å‰é¢çš„æ¦‚è¿°ä»‹ç»å †çš„æ—¶å€™è¯´å †æ˜¯å¯¹æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚å¤§å®¶éƒ½çŸ¥é“æˆ‘ä»¬ JVM æ˜¯ä¼šè‡ªåŠ¨GCçš„ï¼Œä¸ä¼šåœ¨è¢«å¼•ç”¨æˆ–è€…è¯´æ­»æ‰çš„å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯æ‰€æœ‰çš„å¯¹è±¡ä»–ä»¬å‘¢ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯ä¸€æ ·çš„å—ï¼Ÿä¼šä¸ä¼šå­˜åœ¨ä¸€äº›æ°¸è¿œä¸ä¼šè¢«å›æ”¶çš„å¯¹è±¡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å­˜åœ¨çš„ã€‚åœ¨å‰é¢çš„ç±»åŠ è½½çš„å°èŠ‚ä¸­æˆ‘ä»¬è¯´è¿‡ï¼ŒJVM ä¼šæŠŠç±»åŠ è½½è¿›å†…å­˜ï¼Œä¼šåˆ›å»º Class å¯¹è±¡å¹¶ä¸”ä¼šä¿å­˜ç±»å¸¸é‡æ± ä¸­çš„å¸¸é‡ã€‚å¦‚æœæˆ‘ä»¬è¿™éƒ¨åˆ†çš„æ•°æ®è¢« GC äº†ï¼Œé‚£æˆ‘ä»¬é‡åˆ°æ‰€æœ‰çš„éœ€è¦åŠ è½½ç±»çš„åœºæ™¯åˆå°†é‡æ–°åŠ è½½ã€‚è¿™å°†æå¤§å½±å“ JVM æ•´ä½“çš„æ€§èƒ½ã€‚æ‰€ä»¥è¿™é‡Œçš„å †ä¹Ÿè¢«ç§°ä¸ºï¼šGC ç®¡ç†çš„å †ï¼ˆGC Heapï¼‰ã€‚å¦‚æœå †å’Œæ ˆçš„é€»è¾‘åˆ’åˆ†æ˜¯å»ºç«‹åœ¨çº¿ç¨‹æ˜¯å¦å¯ä»¥å…±äº«çš„çº¬åº¦é€»è¾‘ä¸Šï¼Œé‚£ä¹ˆå †å’Œéå †çš„é€»è¾‘åˆ’åˆ†å°±æ˜¯å»ºç«‹å®ä¾‹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„çº¬åº¦ä¸Šçš„ã€‚</p><p>ä¸ºäº†æœ€é«˜åŒ–çš„æé«˜ GC çš„æ•ˆç‡ï¼Œå †ä¹Ÿåˆ’åˆ†é™¤äº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œå°±åƒè¿™ä¸ªå­—é¢æ„æ€ä¸€æ ·ï¼Œæ–°ç”Ÿä»£éƒ½æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åœ¨æ–°ç”Ÿä»£ç»å†å‡ æ¬¡GCï¼Œå¦‚æœä»–ä»¬è¿˜æ´»ç€é‚£ä¹ˆå®ƒä»¬å°†è¿›å…¥è€å¹´ä»£ã€‚ä½†è¿™ä¹Ÿä¸ç»å¯¹ï¼Œåœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹æ–°åˆ›å»ºçš„å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</p><p>éå †æœ¬è´¨ä¸Šè¿˜æ˜¯å †ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸å½’ GC ç®¡ç†ã€‚é‡Œé¢å¤§è‡´åˆ’åˆ†ä¸º3ä¸ªå†…å­˜æ± ã€‚</p><ul><li><code>Metaspace</code>, ä»¥å‰å«æŒä¹…ä»£(æ°¸ä¹…ä»£, Permanent generation), Java8æ¢äº†ä¸ªåå­—å« Metaspace.  Java8å°†æ–¹æ³•åŒºç§»åŠ¨åˆ°äº†MetaåŒºé‡Œé¢ï¼Œè€Œæ–¹æ³•åˆæ˜¯classçš„ä¸€éƒ¨åˆ†ã€‚ã€‚ã€‚å’ŒCCSäº¤å‰äº†? </li><li><code>CCS, Compressed Class Space,</code> å­˜æ”¾classä¿¡æ¯çš„ï¼Œå’Œ Metaspace æœ‰äº¤å‰ã€‚ </li><li><code>Code Cache</code>, å­˜æ”¾ JIT ç¼–è¯‘å™¨ç¼–è¯‘åçš„æœ¬åœ°æœºå™¨ä»£ç ã€‚ </li></ul><h3 id="å…¶ä»–éƒ¨åˆ†å’Œé¸Ÿç°-JVM-å†…å­˜"><a href="#å…¶ä»–éƒ¨åˆ†å’Œé¸Ÿç°-JVM-å†…å­˜" class="headerlink" title="å…¶ä»–éƒ¨åˆ†å’Œé¸Ÿç° JVM å†…å­˜"></a>å…¶ä»–éƒ¨åˆ†å’Œé¸Ÿç° JVM å†…å­˜</h3><p>é™¤äº†æ ˆå’Œå † JVM è¿˜æœ‰ä¸€ä¸ª <code>PC è®¡æ•°å™¨</code> è¿™ä¸ªè®¡æ•°å™¨ç±»ä¼¼äº CPU çš„å¯„å­˜å™¨ï¼Œ<code>ç”¨äºè®°å½•ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®</code>ã€‚åœ¨æ—©æœŸçš„CPU éƒ½æ˜¯å•æ ¸çš„ï¼Œé‚£å¦‚æœå®ç°å¤šçº¿ç¨‹å‘¢ï¼Ÿæ²¡é”™ï¼Œä½¿ç”¨åˆ‡æ¢æ‰§è¡Œä¸Šä¸‹æ–‡çš„æ–¹å¼ ã€‚æ‰€ä»¥ PC è®¡æ•°å™¨è®°å½•çš„å°±æ˜¯å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œè®© CPU åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚è¿˜æœ‰ä¸€ä¸ªéƒ¨åˆ†å°±æ˜¯ç›´æ¥å†…å­˜ã€‚ç›´æ¥å†…å­˜ä¸æ˜¯è¿è¡Œæ—¶æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ã€ŠJavaå†…å­˜è§„èŒƒã€‹ä¸­å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ JVM ç›´æ¥å‘å†…å­˜ç”³è¯·çš„ç©ºé—´ã€‚ä¸€èˆ¬ä¸ä¼šç›´æ¥æ“ä½œï¼Œä½†æ˜¯åœ¨Nettyä¸­æœ‰ç›¸å…³çš„é…ç½®å‚æ•°ã€‚ç»“åˆä¸Šé¢æ‰€æœ‰çš„æ¢³ç†çš„ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€ç”»å‡ºä¸€ä¸ªå¤§è‡´çš„ JVM å†…å­˜å›¾äº†ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210516164240.png"></p><h3 id="å†…å­˜æº¢å‡ºåˆ†æ"><a href="#å†…å­˜æº¢å‡ºåˆ†æ" class="headerlink" title="å†…å­˜æº¢å‡ºåˆ†æ"></a>å†…å­˜æº¢å‡ºåˆ†æ</h3><p>Java è™½ç„¶æœ‰å…¨è‡ªåŠ¨çš„ GCï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½é¿å…å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚é‚£å¦‚ä½•è§£å†³å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜å…ˆè¦ææ˜ç™½å†…å­˜æº¢å‡ºæ˜¯ä»€ä¹ˆï¼Ÿå†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æŒ‡çš„æ˜¯å½“ç¨‹åºéœ€è¦çš„å†…å­˜ä¸­å­˜åœ¨è¿‡å¤šæ— æ³•å›æ”¶çš„å†…å­˜ï¼Œæœ€ç»ˆä½¿å¾—<code>å†…å­˜éœ€è¦çš„ç©ºé—´å¤§äºç³»ç»Ÿèƒ½æä¾›çš„æœ€å¤§ç©ºé—´</code>ï¼Œè¿™æ—¶å€™ä¸€èˆ¬ç³»ç»Ÿä¼šæŠ›å‡º OOM å¼‚å¸¸ã€‚</p><blockquote><p>è¿™ä¸ªç±»ä¼¼äºå¾ˆæ—©ä¹‹å‰æˆ‘ä»¬å†…å­˜å¾ˆå°çš„æ‰‹æœºåŒæ—¶æ‰“å¼€äº†å¾ˆå¤šçš„åå°åº”ç”¨ï¼Œè¿™ä¸ªæ—¶å€™ä½ åˆæ‰“å¼€äº†ä¸€ä¸ªå¾ˆåƒå†…å­˜çš„æ¸¸æˆï¼Œç„¶åè¿™ä¸ªæ¸¸æˆçªç„¶é—ªé€€äº†ã€‚ã€‚ã€‚è¿™ä¸ªæ—¶å€™å¾€å¾€é€šè¿‡æ‰‹åŠ¨æ¸…ç†åå°æˆ–è€…é‡å¯æ‰‹æœºä¹‹åå†æ¬¡æ‰“å¼€çš„æ–¹å¼è§£å†³ã€‚</p></blockquote><p>å‰æ®µæ—¶é—´çœ‹åˆ°ä¸€ä¸ªé—®é¢˜å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å†…å­˜æ³„æ¼è¿™ä¸€å¬å°±çŸ¥é“ä¸æ˜¯ä¸€ä¸ªå¥½è¯ï¼Œå†…å­˜æ³„æ¼<code>å¾€å¾€æŒ‡çš„æ˜¯ç”³è¯·äº†å†…å­˜èµ„æºä¹‹åç”±äºæŸäº›åŸå› è¿Ÿè¿Ÿä¸èƒ½é‡Šæ”¾</code>ã€‚é€ æˆç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œå‡æ…¢ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå†…å­˜æº¢å‡ºæ‹–å®æ•´ä¸ªç³»ç»Ÿã€‚æ‰€ä»¥å†…å­˜æ³„æ¼æ›´å¤šçš„åå‘æ˜¯ä»£ç å±‚é¢é€ æˆçš„èµ„æºæµªè´¹ï¼Œå†…å­˜æ³„æ¼æœ‰å¯èƒ½ä¼šå¯¼è‡´OOMã€‚</p><blockquote><p>ä¸¤è€…å…³ç³» å†…å­˜æ³„æ¼å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œå†…å­˜æº¢å‡ºä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå†…å­˜æ³„æ¼ä¸ä¼šï¼Œå¹¶ä¸”å¤§å¤šæ•°æ—¶å€™ç³»ç»Ÿçœ‹ä¸Šå»åƒæ˜¯æ­£å¸¸è¿è¡Œçš„ã€‚</p></blockquote><p>æ‰€ä»¥å“ªäº› JVM é‡Œé¢å“ªäº›åŒºåŸŸä¼šå†…å­˜æ³„æ¼å‘¢ï¼Ÿåœ¨é‚£äº›åŒºåŸŸä¸ä¼šå†…å­˜æº¢å‡ºå‘¢ï¼Ÿåœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­åªå®šä¹‰ä¸€ä¸ªåœ°æ–¹ä¸ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºã€‚é‚£å°±æ˜¯ PC è®¡æ•°å™¨ï¼Œå› ä¸º PC è®°å½•å™¨è®°å½•çš„å°±æ˜¯å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œæ‰€ä»¥ PC è®¡æ•°å™¨ä¸­åªä¿å­˜ä¸€ä¸ªæ•°ã€‚è¿™ä¸ªå†…å­˜å¤§å°ä¸ä¼šéšç€ç¨‹åºçš„æ‰§è¡Œè€Œå¢åŠ ã€‚æ¯ç”³è¯·ä¸€ä¸ªçº¿ç¨‹å°±ä¼šåˆ›å»ºä¸€ä¸ª PC è®¡æ•°å™¨ã€‚å…¶ä»–çš„å†…å­˜åŒºåŸŸéšç€ç©ºé—´çš„åˆ†é…éƒ½å¯èƒ½å­˜åœ¨ OOMã€‚</p><h2 id="JMM-å†…å­˜æ¨¡å‹ä»‹ç»"><a href="#JMM-å†…å­˜æ¨¡å‹ä»‹ç»" class="headerlink" title="JMM å†…å­˜æ¨¡å‹ä»‹ç»"></a>JMM å†…å­˜æ¨¡å‹ä»‹ç»</h2><h3 id="CPU-æŒ‡ä»¤ä¸ä¹±åºæ‰§è¡Œ"><a href="#CPU-æŒ‡ä»¤ä¸ä¹±åºæ‰§è¡Œ" class="headerlink" title="CPU æŒ‡ä»¤ä¸ä¹±åºæ‰§è¡Œ"></a>CPU æŒ‡ä»¤ä¸ä¹±åºæ‰§è¡Œ</h3><p>å­¦è®¡ç®—æœºçš„éƒ½çŸ¥é“ï¼ŒåŸºæœ¬ä¸Šè®¡ç®—æœºçš„æŒ‡ä»¤é›†åˆ†ä¸ºä¸¤ç§ï¼Œç²¾ç®€æŒ‡ä»¤é›†å’Œå¤æ‚æŒ‡ä»¤é›†åˆï¼Œå…¶ä¸­ç²¾ç®€æŒ‡ä»¤é›†æ˜¯ä»¥ ARM æ¶æ„ä¸ºä¸»ï¼Œç°åœ¨çš„æ‰‹æœºèŠ¯ç‰‡å’Œè‹¹æœçš„ m1 éƒ½æ˜¯åŸºäº ARM æ¶æ„çš„ï¼Œå…¶ç‰¹ç‚¹å°±æ˜¯åŠŸè€—ä½ä½†æ˜¯æ€§èƒ½è¾ƒå¼±ï¼Œä½†æ˜¯éšç€è¿™å‡ å¹´çš„èŠ¯ç‰‡æŠ€æœ¯çš„æå‡ï¼ŒARM æ¶æ„èŠ¯ç‰‡çš„æ€§èƒ½ä¹Ÿåœ¨é€æ­¥æé«˜ï¼Œä¾‹å¦‚è‹¹æœçš„M1èŠ¯ç‰‡ä¹Ÿå¯ä»¥åŠæ‰“ Intel çš„CPUã€‚å¤æ‚æŒ‡ä»¤é›†çš„ä»£è¡¨å°±æ˜¯ Intel å’Œ AMD çš„ x86 æ¶æ„çš„èŠ¯ç‰‡ï¼ŒåŸºäºå¤æ‚æŒ‡ä»¤é›†çš„ç‰¹ç‚¹å°±æ˜¯åŠŸè€—æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯æ€§èƒ½å¼ºã€‚æˆ‘ä»¬éƒ½çŸ¥é“ CPU æœ‰å¾ˆå¤šçš„æŒ‡ä»¤ï¼Œå®ç°ä¸€ä¸ªæ“ä½œæœ‰å¾ˆå¤šçš„æ–¹å¼ï¼Œå¤æ‚æŒ‡ä»¤é›†æŠŠè¿™äº›æ“ä½œå°æˆä¸€ä¸ªå¤æ‚æŒ‡ä»¤ï¼Œè€ŒåŸºäºç®€å•æŒ‡ä»¤é›†çš„CPUæŠŠè¿™ä¸ªå¤æ‚æ“ä½œæ‹†åˆ†å¤šä¸ªç®€å•æŒ‡ä»¤å»å®Œæˆã€‚ä¸¤è€…éƒ½å¯ä»¥å®Œæˆè¿™ä¸ªæ“ä½œï¼Œä½†æ˜¯ï¼Œå°±æ•ˆç‡è€Œè¨€è¿˜æ˜¯å¤æ‚æŒ‡ä»¤é›†æ›´é«˜ã€‚</p><p>ä¸ç®¡æ˜¯å“ªä¸€ç§æŒ‡ä»¤é›†ï¼ŒCPU çš„æµæ°´çº¿å·¥ä½œæ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœä¸€ä¸ªæ“ä½œçš„æ‰€æœ‰çš„æŒ‡ä»¤éƒ½æ”¾åœ¨ä¸€ä¸ªæµæ°´çº¿ä¸Šï¼Œè¿™æ ·å¾ˆå¤šçš„æµæ°´çº¿å°±æ˜¯é—²ç½®çš„ï¼Œæ‰€ä»¥èªæ˜çš„å¼€å‘è€…æƒ³åˆ°ä¸€ä¸ªåŠæ³•å°±æ˜¯ï¼Œåªè¦ä¿è¯æœ€åçš„æ‰§è¡Œç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä¹±åºæ‰§è¡Œä¹Ÿæ²¡å…³ç³»ã€‚æ‰€ä»¥CPUå®Œå…¨å¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡å†…éƒ¨è°ƒåº¦æŠŠè¿™äº›æŒ‡ä»¤æ‰“ä¹±äº†æ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨æµæ°´çº¿èµ„æºï¼Œåªè¦æœ€ç»ˆç»“æœæ˜¯ç­‰ä»·çš„é‚£ä¹ˆç¨‹åºçš„æ­£ç¡®æ€§å°±æ²¡æœ‰é—®é¢˜ã€‚ä½†è¿™åœ¨å¦‚ä»Šå¤šCPUå†…æ ¸çš„æ—¶ä»£ï¼Œéšç€å¤æ‚åº¦çš„æå‡ï¼Œå¹¶å‘æ‰§è¡Œçš„ç¨‹åºé¢ä¸´äº†å¾ˆå¤šé—®é¢˜ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210517004750.png"></p><h3 id="JMM-æ¦‚è¿°"><a href="#JMM-æ¦‚è¿°" class="headerlink" title="JMM æ¦‚è¿°"></a>JMM æ¦‚è¿°</h3><p>éšç€å¤šæ ¸æ—¶ä»£çš„åˆ°æ¥å’Œ JVM å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼ŒJVMåœ¨ä¸åŒç¯å¢ƒä¸‹ä¿è¯ç¨‹åºæ‰§è¡Œç»“æœæ­£ç¡®æ€§å˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚å› æ­¤ JVM æ¨å‡ºä¸€å¥— Java  å†…å­˜æ¨¡å‹æ¥ç»Ÿä¸€çº¦æŸçº¿ç¨‹ä¹‹é—´å¯è§æ€§ç­‰ä¸€ç³»åˆ—è§„åˆ™ï¼Œæ¥ä¿è¯æœ€ç»ˆæ‰§è¡Œç»“æœçš„æ­£ç¡®æ€§ã€‚JMMè§„èŒƒæ˜ç¡®å®šä¹‰äº†ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ï¼Œé€šè¿‡å“ªäº›æ–¹å¼ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™å¯ä»¥çœ‹è§å…¶ä»–çº¿ç¨‹ä¿å­˜åˆ°å…±äº«å˜é‡ä¸­çš„å€¼ï¼›ä»¥åŠåœ¨å¿…æ—¶å¦‚ä½•å¯¹å…±äº«å˜é‡çš„è®¿é—®è¿›è¡ŒåŒæ­¥ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å±è”½å„ç§ç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿä¹‹é—´çš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œå®ç°äº†Javaå¹¶å‘ç¨‹åºçœŸæ­£çš„è·¨å¹³å°ã€‚ å…¶ä¸­å¹¶å‘ä¸­çš„å¾ˆå¤šçš„å…³é”®å­—åŒ…æ‹¬ synchronziedï¼Œvolatile éƒ½æ˜¯ JMM å®šä¹‰çš„ã€‚è¿™äº›å†…å®¹æˆ‘ä»¬å°†æ”¾åˆ°å¤šçº¿ç¨‹å®æˆ˜éƒ¨åˆ†è¿›è¡Œæ¢³ç†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸€å°èŠ‚æˆ‘ä»¬æ‰¿æ¥ä¹‹å‰çš„å­¦çš„å…³äºJavaè¿è¡Œæ—¶æ•°æ®çš„ä¸€äº›çŸ¥è¯†ï¼Œå°è¯•åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ªç®€å•çš„ Java å†…å­˜ç»“æ„ã€‚Java å†…å­˜ç»“æ„åŒ…æ‹¬ å †ã€æ ˆã€PC è®¡æ•°å™¨ï¼Œå…¶ä¸­æ ˆï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ ˆï¼Œæ ˆä¹Ÿåˆ†æ–¹æ³•æ ˆå’Œ Native æ ˆï¼Œçº¿ç¨‹æ ˆå†…åˆåŒ…æ‹¬å¾ˆå¤šçš„æ ˆå¸§ç”¨äºå­˜å‚¨å½“å‰çº¿ç¨‹æ–¹æ³•è°ƒç”¨çš„æ•°æ®ã€‚å †çš„é€»è¾‘å†…å­˜åŒºä¹Ÿåˆ†å †å’Œéå †ï¼Œå †ä¹Ÿç§°ä¸º GC ç®¡ç†çš„å †ï¼Œå› ä¸ºå †æ˜¯ GC å·¥ä½œçš„åŒºåŸŸï¼Œå †é‡Œé¢ä¹Ÿåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚éå †ä¸­ä¸»è¦åŒ…æ‹¬å…ƒæ•°æ®åŒºã€Compressed class space å’Œ code cache ï¼Œå…¶ä¸­å…ƒæ•°æ®åŒºåŸŸä¸»è¦åŒ…æ‹¬æ–¹æ³•åŒºå’Œå¸¸é‡æ± ï¼ŒCCS ä¿å­˜çš„ Class ä¿¡æ¯ï¼ŒCode cache å­˜å‚¨ JIT ç¼–è¯‘åçš„æœºå™¨ç ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ PC è®¡æ•°å™¨ï¼ŒPC è®¡æ•°å™¨è´Ÿè´£è®°å½•å½“å‰ç¨‹åºæ‰§è¡Œçš„ä½ç½®ï¼Œæ–¹ä¾¿ CPU è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢å›æ¥ä¹‹åèƒ½è·³åˆ°æ­£ç¡®çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚åœ¨è¿™äº›åŒºåŸŸä¸­ï¼Œé™¤äº†äº†PC è®¡æ•°å™¨æ‰€æœ‰çš„å†…å­˜åŒºåŸŸéƒ½ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºã€‚æœ€åæˆ‘ä»¬ç®€å•è¿‡äº†ä¸‹ JMM ä¹Ÿå°±æ˜¯ Java å†…å­˜æ¨¡å‹ï¼ŒJMMè§„èŒƒæ˜ç¡®å®šä¹‰äº†ä¸åŒçš„çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§å’Œè®¿é—®åŒæ­¥ï¼Œä¿è¯ JVM åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹éƒ½èƒ½å¾—åˆ°ä¸€è‡´ä¸”æ­£ç¡®çš„ç»“æœã€‚å…·ä½“çš„ JMM çš„ç»†èŠ‚æˆ‘ä»¬æ”¾åœ¨å¹¶å‘ç¼–ç¨‹æ¨¡å—å†æ¥ç»†ç»†çš„æ¢³ç†ã€‚åŠ æ²¹ï¼Œæ™šå®‰ï¼</p><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/136748306">ä¸‰åˆ†é’Ÿå¸¦ä½ äº†è§£å†¯.è¯ºä¾æ›¼ç»“æ„</a></li><li>Javaå†…å­˜æ¨¡å‹ï¼šæµ·ä¸è¾æ°´ï¼Œæ•…èƒ½æˆå…¶æ·± </li></ul>]]></content>
    
    
    <categories>
      
      <category>Javaè™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>JavaçŸ¥è¯†ç»“æ„æ¢³ç†</tag>
      
      <tag>å­¦ä¹ æ€»ç»“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM åŸºç¡€ â€” ç±»åŠ è½½æœºåˆ¶å’Œå¯¹è±¡å†…å­˜å¸ƒå±€</title>
    <link href="/2021/05/14/class-load-and-jol/"/>
    <url>/2021/05/14/class-load-and-jol/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å‰é¢ä¸€ç¯‡ä¸­æåˆ°äº†æ–¹æ³•çš„è°ƒç”¨ï¼Œæ–¹æ³•åœ¨ç±»åŠ è½½é˜¶æ®µä¼šç”±ç¬¦å·å¼•ç”¨æ›¿æ¢å®é™…å¼•ç”¨æˆ–è€…æ–¹æ³•è¡¨çš„ç´¢å¼•ã€‚Java çš„ç±»åŠ è½½æœºåˆ¶åˆæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿè¿™é‡ŒèŠä¸€ä¸ªå°æ’æ›²ï¼Œæˆ‘è®°å¾—æˆ‘åˆšæ¯•ä¸šé‚£ä¼šå»é¢ä¸­å…´ï¼ŒåŸºç¡€çš„é—®é¢˜éƒ½å›ç­”çš„æŒºå¥½çš„ä½†æ˜¯æœ€åé¢è¯•å®˜é—®äº†æˆ‘è¿™ä¸ªé—®é¢˜ï¼ŒJava è™šæ‹Ÿæœºæ˜¯æ€ä¹ˆåŠ è½½ä¸€ä¸ªç±»çš„ï¼Ÿæˆ‘å½“æ—¶è„‘å­æ‡µäº†ï¼Œå¯¹è±¡æ€ä¹ˆåŠ è½½åˆ°å†…å­˜ï¼Ÿå¯¹è±¡æ˜¯ new å‡ºæ¥çš„çš„å•Šï¼Œè¿˜è¦åŠ è½½ï¼Ÿæˆ‘ä¹Ÿå¯¹è¿™å—ä¸å¤ªäº†è§£ï¼Œç„¶åé¢è¯•å®˜ä¹Ÿå°±æ²¡æ·±äº†é—®ã€‚ä½†æ˜¯ç°åœ¨çœ‹æ¥ï¼Œå¦‚æœæ˜¯è¿›é˜¶ Java çš„è¯è¿™æ˜¯ä¸€ä¸ªåŸºç¡€ä¸èƒ½åœ¨åŸºç¡€çš„é—®é¢˜äº†ã€‚ç±»åŠ è½½äº†è¿™è¿˜ä¸ç®—å®Œï¼ŒJava çš„ç±»æ˜¯æ€ä¹ˆä¿å­˜çš„ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šæœ‹å‹ä¼šå›ç­”å­˜æ”¾åœ¨å †é‡Œï¼Œé‚£å…¶ä»–ç‰¹æ®Šçš„ç±»å‹å‘¢ ä¾‹å¦‚ String ç±»å‹åˆæ˜¯æ€ä¹ˆå­˜å‚¨çš„å‘¢ï¼Ÿæˆ‘ä»¬åœ¨å†…å­˜æº¢å‡ºçš„æ—¶å€™ï¼Œå¯¹è±¡æ€ä¹ˆå°±æŠŠæˆ‘ä»¬çš„å †ç»™å †æ»¡äº†ï¼Œæ¯ä¸ªå¯¹è±¡å äº†å¤šå¤§çš„ç©ºé—´å‘¢ï¼Ÿè¯·æœ‹å‹ä»¬æ…¢æ…¢å¾€ä¸‹çœ‹ã€‚</p><h2 id="ç±»åŠ è½½æœºåˆ¶"><a href="#ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶"></a>ç±»åŠ è½½æœºåˆ¶</h2><p>æƒ³è¦çŸ¥é“ä¸€å¤„çš„ç»†èŠ‚ä¸å¦‚å…ˆé¸Ÿç°å…¨å±€ï¼Œå…ˆäº†è§£ç±»çš„å£°æ˜å‘¨æœŸæ˜¯ä»€ä¹ˆæ ·çš„å…ˆæœ‰ä¸ªå¤§ä½“çš„æ¦‚å¿µã€‚åœ¨äº†è§£çš„ç±»çš„å£°æ˜å‘¨æœŸä¹‹åæ‰èƒ½æ›´å¥½çš„ç†è§£ JVM æ˜¯å¦‚ä½•åŠ è½½ä¸€ä¸ªç±»çš„</p><h3 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210511003453.png"></p><p>ä¸Šé¢è¿™å¼ å›¾æ˜¯éå¸¸ç»å…¸çš„ä¸€å¼ å›¾ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸæœ‰7ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯ <code>åŠ è½½ï¼ˆLoadingï¼‰</code>ã€ <code>éªŒè¯ï¼ˆVerificationï¼‰</code>ã€<code>å‡†å¤‡ï¼ˆPreparationï¼‰</code>ã€<code>è§£æï¼ˆResolutionï¼‰</code>ã€<code>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</code>ã€<code>ä½¿ç”¨ï¼ˆUsingï¼‰</code>ã€<code>å¸è½½ï¼ˆUnloadingï¼‰</code>ã€‚å…¶ä¸­å‰äº”ä¸ªéƒ¨åˆ†ï¼ˆåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ï¼‰ç»Ÿç§°ä¸ºç±»åŠ è½½ã€‚</p><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><p>åŠ è½½é˜¶æ®µä¹Ÿç§°ä½œâ€è£…è½½â€é˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦çš„æ“ä½œæ˜¯ï¼Œæ›´å…·æ˜ç¡®çŸ¥é“çš„ class å®Œå…¨é™å®šåï¼Œæ¥è·å–ç±»çš„äºŒè¿›åˆ¶çš„ .class æ–‡ä»¶</p><p>ç®€å•æ¥è¯´å°±æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿ/jaråŒ…ä¸­/æˆ–è€…ç½‘è·¯ä¸­ï¼Œä»»ä½•åœ°æ–¹å­˜åœ¨çš„<code>classæ–‡ä»¶</code>ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ä¼šæŠ›å‡º <code>NoClassDefFound</code> é”™è¯¯ã€‚åŠ è½½é˜¶æ®µä¸ä¼šæ£€æŸ¥ classfile çš„æ ¼å¼å’Œè¯­æ³•é—®é¢˜ï¼Œåªæ˜¯å•çº¯çš„åŠ è½½æ–‡ä»¶ã€‚ç±»åŠ è½½çš„æ•´ä¸ªé˜¶æ®µç”± JVM å’Œç±»åŠ è½½å™¨ï¼ˆæŸä¸€ä¸ªï¼‰å…±åŒåä½œå®Œæˆã€‚</p><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p>éªŒè¯é˜¶æ®µä¹Ÿæ˜¯é“¾æ¥è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„æ“ä½œé€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµæ•°æ®æ˜¯ç¬¦åˆè™šæ‹Ÿæœºè¦æ±‚çš„ä¸ä¼šå±å®³åˆ°è™šæ‹Ÿæœºçš„å®‰å…¨ã€‚ç®€å•æ¥è¯´å°±æ˜¯ä¸€äº›æ ¼å¼å’Œè¯­æ³•çš„æ ¡éªŒï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæŠ›å‡º <code>VerifyError</code>ï¼Œ<code>ClassFormatError</code> æˆ– <code>UnsupportedClassVersionError</code>ï¼Œæ³¨æ„è¿™é‡Œæ’é™¤çš„ Error é”™è¯¯ï¼ŒError åªæœ‰è™šæ‹Ÿæœºæ— æ³•æ­£å¸¸æ‰§è¡Œäº†æ‰ä¼šæŠ›å‡ºçš„å¼‚å¸¸ã€‚</p><p>éªŒè¯ä¹Ÿæ˜¯é“¾æ¥çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ† JVM å¿…é¡»åŠ è½½æ‰€æœ‰çš„è¶…ç±»å’Œæ¥å£ã€‚å¦‚æœå‘ç°ç±»çš„å±‚æ¬¡ç»“æ„æœ‰é—®é¢˜ JVM ä¼šæŠ›å‡º <code>ClassCircularityError</code>ã€‚è€Œå¦‚æœå®ç°æ¥å£ä¸æ˜¯ä¸€ä¸ª interfaceï¼Œæˆ–è€…å£°æ˜çš„è¶…ç±»ä¸æ˜¯ä¸€ä¸ª interface ä¹Ÿä¼šæŠ›å‡º IncompatibleClassChangeErrorã€‚</p><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p>åœ¨è¿™ä¸ªé˜¶æ®µä¼šåˆ›å»ºé™æ€å­—æ®µå¹¶ä¸ºå…¶åˆå§‹åŒ–æ ‡å‡†é»˜è®¤å€¼ï¼ˆæ¯”å¦‚ <code>null</code> æˆ–è€… 0ï¼‰ï¼Œå¹¶åˆ†é…æ–¹æ³•è¡¨ï¼ŒåŠåœ¨æ–¹æ³•åŒºä¸­åˆ†é…è¿™äº›æ–¹æ³•çš„ä½¿ç”¨çš„<code>å†…å­˜ç©ºé—´</code>ã€‚âš ï¸ è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µæ²¡æœ‰æ‰§è¡Œä»»ä½•çš„ Java ä»£ç ã€‚</p><h4 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h4><p>ç„¶åJVM ä¼šè¿›å…¥å¯é€‰çš„è§£æç¬¦å·å¼•ç”¨é˜¶æ®µã€‚ä¹Ÿå°±æ˜¯è§£æç±»æ–‡ä»¶é‡Œé¢çš„å¸¸é‡æ± ï¼Œä¸»è¦æœ‰ä¸‹é¢å››ç§ï¼šç±»æˆ–æ¥å£çš„è§£æã€å­—æ®µè§£æã€ç±»æ–¹æ³•è§£æã€æ¥å£æ–¹æ³•è§£æã€‚åœ¨è§£æé˜¶æ®µè¦åšçš„æ˜¯å°±æ˜¯æŠŠç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨ï¼ˆç›¸å½“äºç›´æ¥æŒ‡å‘äº†å®é™…çš„å¯¹è±¡ï¼‰ï¼Œå¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸€å®šåœ¨å †ä¸­ã€‚</p><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>å¦‚æœç›´æ¥èµ‹å€¼çš„é™æ€å­—æ®µè¢« final æ‰€ä¿®é¥°ï¼Œå¹¶ä¸”å®ƒçš„ç±»å‹æ˜¯åŸºæœ¬ç±»å‹æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œé‚£ä¹ˆè¯¥å­—æ®µä¾¿ä¼šè¢« Java ç¼–è¯‘å™¨æ ‡è®°æˆå¸¸é‡å€¼ï¼ˆConstantValueï¼‰ï¼Œå…¶åˆå§‹åŒ–ç›´æ¥ç”± Java è™šæ‹Ÿæœºå®Œæˆã€‚é™¤æ­¤ä¹‹å¤–çš„ç›´æ¥èµ‹å€¼æ“ä½œï¼Œä»¥åŠæ‰€æœ‰é™æ€ä»£ç å—ä¸­çš„ä»£ç åˆ™ä¼šè¢« Java ç¼–è¯‘å™¨ç½®äºåŒä¸€æ–¹æ³•ä¸­ï¼Œå¹¶æŠŠå®ƒå‘½åä¸º<code>&lt;clinit&gt;</code>ã€‚</p><p>ç±»åªæœ‰åœ¨é¦–æ¬¡ â€œä¸»åŠ¨ä½¿ç”¨â€ æ‰èƒ½æ‰§è¡Œç±»çš„åˆå§‹åŒ–ã€‚æ˜¯ <clinit> æ–¹æ³•ä¸æ˜¯æ„é€ å™¨ï¼Œåªæœ‰ä¸»åŠ¨ä½¿ç”¨æ‰ä¼šè°ƒç”¨æ„é€ å™¨æ–¹æ³•ã€‚</p><p>ç±»åŠ è½½çš„æœ€åä¸€æ­¥æ˜¯åˆå§‹åŒ–ï¼Œä¾¿æ˜¯ä¸ºæ ‡è®°ä¸ºå¸¸é‡å€¼çš„å­—æ®µèµ‹å€¼ï¼Œä»¥åŠæ‰§è¡Œ &lt; clinit &gt; æ–¹æ³•çš„è¿‡ç¨‹ã€‚Java è™šæ‹Ÿæœºä¼šé€šè¿‡åŠ é”æ¥ç¡®ä¿ç±»çš„ &lt; clinit &gt; æ–¹æ³•ä»…è¢«æ‰§è¡Œä¸€æ¬¡ã€‚</p><blockquote><p>è¿™ä¸ªæµç¨‹åº”è¯¥æ˜¯æ¯ä¸ªJava ç¨‹åºå‘˜éƒ½åº”è¯¥ç†Ÿè®°äºèƒ¸çš„ï¼Œä¸€å¼€å§‹æˆ‘è®°å¿†è¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ç¡¬ç€å¤´çš®è®°ï¼Œä¹Ÿå¾ˆå®¹æ˜“å¿˜ã€‚å¶ç„¶æœ‰ä¸€å¤©æˆ‘åœ¨é¥­ï¼Œçªç„¶å‘ç°è¿™ä¸ªç±»åŠ è½½æœºåˆ¶åƒåšé¥­çš„è¿‡ç¨‹ã€‚åŠ è½½è¿‡ç¨‹å°±åƒæ˜¯ä¹°èœï¼Œç±»åŠ è½½è¿›å…¥JVM å°±åƒæŠŠèœä¹°å›å®¶ã€‚ç„¶åèœä¹°å›æ¥ä¹‹åå‘¢ï¼Œè¦æ£€æŸ¥æ£€æŸ¥ï¼Œç¡®è®¤ä¹°çš„èœéƒ½æ˜¯å¯¹çš„ï¼Œä¸ç„¶ä¹°é”™äº†æˆ–è€…ä»€ä¹ˆæ¼ä¹°äº†å°±å¾ˆå°´å°¬äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹å‘¢å°±åƒç±»åŠ è½½æµç¨‹é‡Œé¢çš„éªŒè¯ï¼Œè¦æ£€æŸ¥å­—èŠ‚ç æ–‡ä»¶ç¬¦åˆè™šæ‹Ÿæœºè¦æ±‚ä¸ä¼šå±å®³åˆ°è™šæ‹Ÿæœºå®‰å…¨ã€‚åšé¥­ä¹Ÿè¦éœ€è¦å‡†å¤‡ï¼Œè¦æ´—èœæ‹©èœï¼Œå°±åƒæˆ‘ä»¬çš„å‡†å¤‡é˜¶æ®µä¸ºç±»å‡†å¤‡åˆ†é…å†…å­˜ç©ºé—´ã€‚è¿™éƒ¨åˆ†ç»“æŸäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥çƒ­é”…å¼€å§‹åšèœäº†ã€‚è¿™ä¸ªéƒ¨åˆ†æŒ‰ç…§èœè°±åŠ å…¥å„ç§è°ƒå‘³æ–™ï¼ŒæŠŠå„ä¸ªé£Ÿææ··åˆåœ¨ä¸€èµ·ï¼Œå°±åƒè§£æï¼ŒæŠŠå„ä¸ªç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œè®©å„ä¸ªéƒ¨åˆ†å…³è”èµ·æ¥ã€‚ç„¶åæˆ‘ä»¬èœå°±åšå¥½äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥è£…ç›˜å‡ºé”…äº†ã€‚è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯ç±»çš„åˆå§‹åŒ–ï¼Œç»è¿‡è¿™ä¸ªéƒ¨åˆ†ä¹‹åï¼Œä¸€ä¸ªç±»å°±å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒé¥­äº†ï¼Œæœ€åç±»ä½¿ç”¨å®Œä¹‹åå¸è½½ï¼Œæˆ‘ä»¬åƒå®Œäº†ä¹Ÿå°±è¦æ´—ç¢—äº†ã€‚å“ˆå“ˆæ˜¯ä¸æ˜¯å¾ˆåƒã€‚</p><p>åŠ è½½ -&gt; éªŒè¯ -&gt; å‡†å¤‡ -&gt; è§£æ -&gt; åˆå§‹åŒ– -&gt; ä½¿ç”¨ -&gt; å¸è½½ã€‚</p><p>ä¹°èœ -&gt; æ£€æŸ¥èœ -&gt; æ´—èœ -&gt; ç‚’èœ -&gt; è£…ç›˜ -&gt; åƒé¥­ -&gt; æ´—ç¢—ã€‚ </p></blockquote><h3 id="ç±»çš„åŠ è½½æ—¶æœº"><a href="#ç±»çš„åŠ è½½æ—¶æœº" class="headerlink" title="ç±»çš„åŠ è½½æ—¶æœº"></a>ç±»çš„åŠ è½½æ—¶æœº</h3><p>ç±»å¹¶ä¸æ˜¯åœ¨è™šæ‹Ÿæœºä¸€å¯åŠ¨å°±ä¼šå…¨éƒ¨åŠ è½½è¿›æ¥ï¼Œè€Œæ˜¯ä¼š<code>æŒ‰éœ€åŠ è½½</code>ï¼Œé‚£åœ¨ä»€ä¹ˆæ—¶å€™æ‰ä¼šåŠ è½½ç›®æ ‡ç±»å‘¢ï¼Ÿ</p><ol><li>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–ç”¨æˆ·æŒ‡å®šçš„ä¸»ç±»ã€‚</li><li>å½“é‡åˆ°ç”¨ä»¥æ–°å»ºç›®æ ‡ç±»å®ä¾‹çš„ new æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ– new æŒ‡ä»¤çš„ç›®æ ‡ç±»ã€‚</li><li>å½“é‡åˆ°è°ƒç”¨é™æ€æ–¹æ³•çš„æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–è¯¥é™æ€æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚</li><li>å½“é‡åˆ°è®¿é—®é™æ€å­—æ®µçš„æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–è¯¥é™æ€å­—æ®µæ‰€åœ¨çš„ç±»ã€‚</li><li>å­ç±»çš„åˆå§‹åŒ–ä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</li><li>å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† deault æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥å®ç°å¶ç€é—´æ¥å®ç°è¯¥æ¥å£çš„ç±»åˆå§‹åŒ–ï¼Œä¼šè§¦å‘è¯¥æ¥å£çš„åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨åå°„ API å¯¹æŸä¸ªç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶ï¼Œåˆå§‹åŒ–è¿™ä¸ªç±»ã€‚</li><li>å½“åˆæ¬¡è°ƒç”¨ MethodHandler å®ä¾‹ï¼Œåˆå§‹è¯¥ MethodHandler æŒ‡å‘çš„æ–¹æ³•æ‰€åœ¨ç±»ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyHolder</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Singleton INSTANCE = <span class="hljs-keyword">new</span> Singleton();<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> LazyHolder.INSTANCE;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯åœ¨è‘—åçš„å•ä¾‹å»¶è¿Ÿåˆå§‹åŒ–ï¼Œåªæœ‰å½“è°ƒç”¨ Singleton.getInstance æ—¶ï¼Œç¨‹åºæ‰ä¼šè®¿é—® LazyHolder.INSTANCEï¼Œæ‰ä¼šè§¦å‘å¯¹ LazyHolder çš„åˆå§‹åŒ–ï¼ˆå¯¹åº”ç¬¬ 4 ç§æƒ…å†µï¼‰ï¼Œç»§è€Œæ–°å»ºä¸€ä¸ª Singleton çš„å®ä¾‹ã€‚</p><h3 id="ç±»åŠ è½½å™¨æœºåˆ¶"><a href="#ç±»åŠ è½½å™¨æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½å™¨æœºåˆ¶"></a>ç±»åŠ è½½å™¨æœºåˆ¶</h3><p>ç±»çš„åŠ è½½è¿‡ç¨‹å¯ä»¥æè¿°ä¸ºâ€é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šå a.b.c.xxx.XXClass æ¥è·å–æ­¤ç±»çš„ Class å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œå­ç±»åŠ è½½å™¨å¯ä»¥å¤ç”¨çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»ã€‚ç³»ç»Ÿè‡ªå¸¦çš„åŠ è½½å™¨åˆ†ä¸ºä¸‰ç§ï¼š</p><ul><li><code>å¯åŠ¨ç±»åŠ è½½å™¨</code>ï¼ˆBootstrapClassLoaderï¼‰</li><li><code>æ‰©å±•ç±»åŠ è½½å™¨</code>ï¼ˆExtClassLoaderï¼‰</li><li><code>åº”ç”¨ç±»åŠ è½½å™¨</code>ï¼ˆAppClassLoaderï¼‰</li></ul><p>ä¸€èˆ¬å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ç”± JVM å†…éƒ¨å®ç°çš„ï¼Œåœ¨ Java çš„ API é‡Œé¢æ˜¯æ— æ³•æ‹¿åˆ°äº†ï¼Œæ˜¯ç”¨ C++ å®ç°çš„ï¼Œåé¢ä¸¤ç§åœ¨ Oracle Hotspot JVM ä¸­ï¼Œéƒ½åœ¨ sun.misc.Lanucher å®šä¹‰çš„ï¼Œæ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç±»åŠ è½½å™¨ä¸€èˆ¬éƒ½ç»§æ‰¿è‡ª <code>URLClassLoader</code> ç±»ï¼Œè¿™ä¸ªç±»ä¹Ÿé»˜å®ç°äº†ä»ä¸åŒçš„æºæ¥åŠ è½½ class å­—èŠ‚ç æ¢æˆçš„ Class çš„æ–¹æ³•ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210512000947.png"></p><ol><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»ï¼Œç”¨åŸç”Ÿçš„ C++ å®ç°å¹¶ä¸ç»§æ‰¿è‡ª java.lang.Classloaderã€‚è´Ÿè´£åŠ è½½ JDK ä¸­ <code>jre/lib/rt.jar</code> ä¸­çš„æ‰€æœ‰ classã€‚å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ JVM è‡ªå¸¦çš„ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæ— æ³•è·å–å®ƒçš„å¼•ç”¨ã€‚</li><li>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆextensions class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ <code>lib/ext</code> æˆ–è€…ç”±ç³»ç»Ÿè·¯å¾„ <code>java.ext.dirs</code> æŒ‡å®šçš„ç›®å½•ä¸­çš„ Jar åŒ…ä¸­çš„ç±»ã€‚</li><li>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆapplication class loaderï¼‰ï¼šå®ƒè´Ÿè´£åœ¨ JVM å¯åŠ¨æ—¶åŠ è½½æ¥è‡ª <code>Java å‘½ä»¤ -classpath</code> æˆ–è€… <code>-cp</code> æˆ–è€…æŒ‡å®šç³»ç»Ÿè·¯å¾„ <code>java.class.path</code> ç³»ç»Ÿå±æ€§æŒ‡å®šçš„ jar åŒ…å’Œç±»è·¯å¾„ã€‚ å¯ä»¥é€šè¿‡ <code>ClassLoader.getSystemClassLoader()</code> æ¥è·å–ç±»åº”ç”¨åŠ è½½å™¨ã€‚</li></ol><p>ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå¦‚æœè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„åº”è¯¥ä»¥åº”ç”¨åŠ è½½å™¨ä½œä¸ºçˆ¶ç±»ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªè‡ªå®šç±»åŠ è½½å™¨ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> HelloXlassLoader extends ClassLoader &#123;<br><br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Object hello = <span class="hljs-keyword">new</span> <span class="hljs-constructor">HelloXlassLoader()</span>.find<span class="hljs-constructor">Class(<span class="hljs-string">&quot;Hello&quot;</span>)</span>.<span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span>;<br>            Method <span class="hljs-keyword">method</span> = hello.get<span class="hljs-constructor">Class()</span>.get<span class="hljs-constructor">Method(<span class="hljs-string">&quot;hello&quot;</span>)</span>;<br>            <span class="hljs-keyword">method</span>.invoke(hello);<br>        &#125; catch (Exception e) &#123;<br>            e.print<span class="hljs-constructor">StackTrace()</span>;<br>        &#125;<br>    &#125;<br><br>    @Override<br>    protected Class&lt;?&gt; find<span class="hljs-constructor">Class(String <span class="hljs-params">name</span>)</span> throws ClassNotFoundException &#123;<br>        byte<span class="hljs-literal">[]</span> <span class="hljs-built_in">bytes</span> = get<span class="hljs-constructor">BytesFromXXX()</span>;<br>        handle<span class="hljs-constructor">Bytes(<span class="hljs-params">bytes</span>)</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">bytes</span>.length<span class="hljs-operator"> == </span><span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;file load error&quot;</span>);<br>        &#125;<br>        return define<span class="hljs-constructor">Class(<span class="hljs-params">name</span>, <span class="hljs-params">bytes</span>, 0, <span class="hljs-params">bytes</span>.<span class="hljs-params">length</span>)</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç±»åŠ è½½å™¨æœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p><ol><li><code>åŒäº²å§”æ´¾</code>ï¼šå¤§åé¼é¼çš„åŒäº²å§”æ´¾å…¶å®å¾ˆç®€å•ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ‰€è°“çš„åŒäº²ï¼Œå°±æ˜¯ä¼˜å…ˆç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½ä¸äº†å†è‡ªå·±æ¥åŠ è½½ã€‚ä¾‹å¦‚ String ç±»å‹ï¼ŒappClassLoader çœ‹åˆ°äº†ä¸åŠ è½½ï¼Œç»™ extClassLoaderï¼ŒextClassLoader ä¹Ÿä¸åŠ è½½ï¼Œç»™bootstrapClassLoader åŠ è½½ï¼ŒbootstrapClassLoader ä¸€çœ‹ java.lang.String æ˜¯åœ¨ rt åŒ…é‡Œçš„å°±ç»™åŠ è½½äº†ã€‚è¿™ä¹Ÿä¸æ˜¯è¯´åŠ è½½å™¨æ‡’ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ï¼Œ<code>æŸä¸€ä¸ªç±»æ¯æ¬¡éƒ½èƒ½è¢«ç‰¹å®šçš„æŸä¸ªåŠ è½½å™¨åŠ è½½ã€‚</code></li><li><code>è´Ÿè´£ä¾èµ–</code>ï¼šå¦‚æœä¸€ä¸ªåŠ è½½å™¨åœ¨åŠ è½½æŸä¸ªç±»çš„æ—¶å€™ï¼Œå‘ç°è¿™ä¸ªç±»ä¾èµ–çš„å¦å¤–å‡ ä¸ªç±»æˆ–è€…æ¥å£ï¼Œä¹Ÿä¼šå»æ˜¯è¿™å°è¯•åŠ è½½è¿™äº›ä¾èµ–ã€‚</li><li><code>ç¼“å­˜åŠ è½½</code>ï¼šä¸ºäº†æé«˜æ•ˆç‡é¿å…é‡å¤åŠ è½½ï¼Œä¸€æ—¦æŸä¸ªç±»è¢«ä¸€ä¸ªåŠ è½½å™¨åŠ è½½ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šç¼“å­˜è¿™ä¸ªåŠ è½½ç»“æœï¼Œä¸ä¼šé‡å¤åŠ è½½ã€‚è¿™ä¹Ÿæ˜¯åŒäº²å§”æ´¾çš„ç›®çš„ã€‚</li></ol><h2 id="å¯¹è±¡å†…å­˜å¸ƒå±€"><a href="#å¯¹è±¡å†…å­˜å¸ƒå±€" class="headerlink" title="å¯¹è±¡å†…å­˜å¸ƒå±€"></a>å¯¹è±¡å†…å­˜å¸ƒå±€</h2><p>å‰é¢çš„éƒ¨åˆ†æˆ‘ä»¬èŠåˆ°äº†ï¼ŒJava å¯¹è±¡æ˜¯å¦‚ä½•åŠ è½½ä¸€ä¸ªç±»çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çœŸæ­£çš„ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ ¹æ®æˆ‘ä»¬åŠ è½½çš„ç±»å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚é‚£åˆ›å»ºçš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><h3 id="å¯¹è±¡åˆ›å»º"><a href="#å¯¹è±¡åˆ›å»º" class="headerlink" title="å¯¹è±¡åˆ›å»º"></a>å¯¹è±¡åˆ›å»º</h3><p>æˆ‘æƒ³èµ·æ¥ä¸€ä¸ªæ®µå­ï¼ŒæŠŠå¤§è±¡æ”¾è¿›å†°ç®±éœ€è¦å‡ æ­¥ï¼Ÿéœ€è¦ä¸‰æ­¥ï¼æ‰“å¼€å†°ç®±é—¨ï¼ŒæŠŠå¤§è±¡æ”¾è¿›å†°ç®±ï¼ŒæŠŠé—¨å…³ä¸Šã€‚å…¶å®æˆ‘ä»¬çš„ Java åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ä¹Ÿå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼Œç”³è¯·å†…å­˜ â€”&gt; åˆå§‹åŒ–æ•°æ®ï¼ˆä»£ç å—å’Œæ„é€ ï¼‰-&gt; å…³è”å¼•ç”¨ã€‚</p><ol><li><code>æ„å»ºå¯¹è±¡</code>ï¼ˆç”³è¯·ç©ºé—´ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹é¦–å…ˆçº¿ç¨‹ä¼šç”³è¯·ä¸€ä¸ªæ ˆç©ºé—´ï¼Œå¹¶ä¸”ç”Ÿæˆæ ˆå¸§ç„¶åæ‰§è¡Œ new æ“ä½œã€‚çº¿ç¨‹ä¼šæ ¹æ®åŠ è½½çš„ç±»ä¿¡æ¯ç”³è¯·ä¸€å—å†…å­˜æ„å»ºå¯¹è±¡ï¼Œå¹¶ä¸”ä¸ºæˆå‘˜å˜é‡èµ‹é»˜è®¤å€¼ã€‚</li><li><code>å¯¹è±¡åˆå§‹åŒ–</code>ï¼Œè¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æ‰§è¡Œ {} ä»£ç å—å’Œæ„é€ æ–¹æ³•äº†ã€‚</li><li><code>å…³è”å¼•ç”¨</code>ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡çš„å¼•ç”¨æ˜¯åœ¨æ ˆä¸Šé¢ï¼Œç„¶è€Œæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡æ˜¯åœ¨å †ä¸­ï¼Œæœ€åä¸€æ­¥å°±æ˜¯æŠŠæ ˆä¸Šçš„å¯¹è±¡å¼•ç”¨æŒ‡å‘å †ä¸­çš„åœ°å€ã€‚</li></ol><blockquote><p>æ‰“å¼€å†°ç®± = ç”³è¯·ç©ºé—´ï¼Œæ”¾å…¥å¤§è±¡ = å¯¹è±¡åˆå§‹åŒ–ï¼Œ å…³è”å¼•ç”¨ = å…³ä¸Šå†°ç®±é—¨ </p></blockquote><h3 id="å¯¹è±¡åœ¨å†…å­˜çš„å¸ƒå±€"><a href="#å¯¹è±¡åœ¨å†…å­˜çš„å¸ƒå±€" class="headerlink" title="å¯¹è±¡åœ¨å†…å­˜çš„å¸ƒå±€"></a>å¯¹è±¡åœ¨å†…å­˜çš„å¸ƒå±€</h3><p>æˆ‘ä»¬ç°åœ¨åˆ›å»ºå¥½äº†ä¸€ä¸ªå¯¹è±¡ï¼Œéš¾é“ä¸€ä¸ªå¯¹è±¡åœ¨å †ä¸­å­˜çš„å°±çœŸçš„æ˜¯ä¸€å †å˜é‡æ•°æ®å°±æ²¡æœ‰å…¶ä»–çš„ä¸œè¥¿å—ï¼Ÿ</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210513231532.png"></p><p>å¯¹è±¡åœ¨å†…å­˜çš„ä¸­å¹¶ä¸åªæœ‰å®ä¾‹çš„æ•°æ®ï¼Œè€Œæ˜¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼Œ<code>å¯¹è±¡å¤´</code>ã€<code>å®ä¾‹æ•°æ®</code>ã€<code>å†…å­˜å¡«å……</code>ã€‚</p><ul><li>å¯¹è±¡å¤´ï¼šæŒ‰ç…§å®ä¾‹å¯¹è±¡çš„ä¸åŒï¼Œå¯¹è±¡å¤´ä¹Ÿæœ‰ä¸åŒï¼Œä¸»è¦çš„å°±æ˜¯åŒ…å«<code>Mark word</code>ï¼Œ<code>class pointer</code>ï¼Œæ•°ç»„å¯¹è±¡è¿˜åŒ…æ‹¬æ•°ç»„é•¿åº¦ã€‚MarkWord é‡Œé¢åŒ…å«æœ‰å¯¹è±¡çš„å“ˆå¸Œç ï¼Œé”ä¿¡æ¯ï¼ŒGC ç­‰ä¿¡æ¯ã€‚ClassPointer è¿™ä¸ªå¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ–¹æ³•åŒºçš„ Class å¯¹è±¡ ï¼Œåœ¨æ•°ç»„å®ä¾‹ä¸­è¿˜è¦è®°å½•æ•°ç»„çš„é•¿åº¦ï¼Œåœ¨ 64 ä½çš„ç³»ç»Ÿä¸­markWordå <code>8</code>ä¸ªå­—èŠ‚ï¼Œå¦‚æœå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼Œè¿™ä¸ªå¤§å°å¯ä»¥å‹ç¼©åˆ° <code>4</code>ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä¸å¼€å¯æŒ‡é’ˆå‹ç¼©çš„è¯ï¼Œå†åŠ ä¸Š class pointer 4 ä¸ªå­—èŠ‚ï¼Œå®ä¾‹å¯¹è±¡å¤´ 12 ä¸ªå­—èŠ‚ï¼Œæ•°ç»„å¯¹è±¡å¤´å  16 ä¸ªå­—èŠ‚ï¼Œå¼€å¯æŒ‡é’ˆå‹ç¼©åï¼Œå®ä¾‹å¯¹è±¡ å¯¹è±¡å¤´8ä¸ªå­—èŠ‚ï¼Œæ•°ç»„å¯¹è±¡å¯¹è±¡å¤´ 12 ä¸ªå­—èŠ‚ã€‚</li></ul><blockquote><p>å¯¹è±¡å¤´ ä¸å¼€å¯æŒ‡é’ˆå‹ç¼© å®ä¾‹ 12 å­—èŠ‚ï¼Œæ•°ç»„ 16 å­—èŠ‚ï¼Œå¼€å¯æŒ‡é’ˆå‹ç¼© å®ä¾‹ 8 å­—èŠ‚ï¼Œæ•°ç»„ 12 å­—èŠ‚ã€‚</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">-XX:+UseCompressedOops  <span class="hljs-regexp">//</span> å¼€å¯æŒ‡é’ˆå‹ç¼©<br>-XX:-UseCompressedOops  <span class="hljs-regexp">//</span> å…³é—­æŒ‡é’ˆå‹ç¼©<br></code></pre></td></tr></table></figure><ul><li>å®ä¾‹æ•°æ®ï¼šè¿™ä¸ªå¾ˆå¥½ç†è§£å°±æ˜¯ç±»å®ä¾‹ä¸­çš„æ•°æ®ã€‚</li><li>å†…å­˜å¯¹é½ï¼šæˆ‘ä»¬çš„ CPU å¯„å­˜å™¨çš„ä½æ•°éƒ½æ˜¯ 8 çš„å€æ•°ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ CPU å¯„å­˜å™¨é«˜æ•ˆå¯»å€ï¼Œ64 ä½ JVM è¦æ±‚ Java å¯¹è±¡åœ°å€è¦æŒ‰ç…§ 8 å­—èŠ‚å¯¹é½ã€‚è¿™ä¸ªéƒ¨åˆ†åšæ•°æ®å¡«å……ä¿è¯ 8 å­—èŠ‚å¯¹é½ã€‚</li></ul><blockquote><p>âš ï¸è¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ç‚¹ï¼ŒJava å®ä¾‹è¢« GC ä¹‹åï¼Œå¯¹è±¡çš„ Hash ç ä¼šå˜ç ï¼Ÿé‚£æ ˆä¸­çš„å¼•ç”¨åœ°å€ä¼šå˜åŒ–å—ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“ Java å¯¹è±¡çš„ Hash ç å’Œå¯¹è±¡åœ°å€æœ‰å…³ç³»ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡è¢« GC è¿‡åè¿˜å­˜æ´»çš„è¯ï¼Œå¦‚æœåœ¨ young åŒºï¼Œé‚£åœ°å€å¤§æ¦‚ç‡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé‚£Hash ç æ˜¯ä¸æ˜¯ä¹Ÿä¸ä¸€æ ·å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡å®éªŒå¯ä»¥å¾ˆå®¹æ˜“éªŒè¯è¿™ä¸ªé—®é¢˜ï¼ŒHash ç ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯åœ°å€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿæ¥ï¼ŒæŠ¬å¤´å¾€ä¸Šçœ‹ï¼Œå¯¹è±¡å¤´ä¸­æ˜¯ä¸æ˜¯æœ‰ä¸ªå“ˆå¸Œç ä¿¡æ¯ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å¯¹è±¡ hashCode æ–¹æ³•ï¼Œå°±ä¼šæŠŠ hashCode å­˜åœ¨è¿™é‡Œï¼Œåé¢çš„ hashCode ç›´æ¥æ¥è¿™é‡Œå–å°±å¥½äº†ã€‚ </p></blockquote><p>æ•´ä½“çš„å¤§è‡´çš„å¯¹è±¡å­˜å‚¨å¸ƒå±€å°±æ˜¯é…±å©¶å„¿çš„ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210513235300.png"></p><h3 id="JOL-å®è·µ"><a href="#JOL-å®è·µ" class="headerlink" title="JOL å®è·µ"></a>JOL å®è·µ</h3><p>ä»€ä¹ˆæ˜¯ JOL ï¼ŸJOL ï¼ˆJava object layoutï¼‰Java å¯¹è±¡å†…å­˜å¸ƒå±€ï¼Œæ˜¯ openjdk ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå·¥å…·åŒ…ï¼Œå¯ä»¥ç”¨æ¥è·å–å¯¹è±¡çš„ä¿¡æ¯å’Œè™šæ‹Ÿæœºçš„ä¿¡æ¯ ã€‚æˆ‘ä»¬æ¥å¼•å…¥ä¸‹ jol-core çš„ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openjdk.jol<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jol-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸»è¦ä¼šç”¨åˆ°çš„æ–¹æ³•ï¼š</p><ul><li><code>ClassLayout.parseInstance(object).toPrintable()</code>ï¼šæŸ¥çœ‹å¯¹è±¡å†…éƒ¨ä¿¡æ¯ã€‚</li><li><code>GraphLayout.parseInstance(object).toPrintable()</code>ï¼šæŸ¥çœ‹å¯¹è±¡å¤–éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li><code>GraphLayout.parseInstance(object).totalSize()</code>ï¼šæŸ¥çœ‹å¯¹è±¡æ€»å¤§å°ã€‚</li></ul><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œç©ºå¯¹è±¡å¼€å¼€èƒƒã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">A</span> &#123;&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå¯¹è±¡ä¸€ä¸ªæˆå‘˜å˜é‡éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆä¸€ä¸ª A å®ä¾‹å ç”¨å‡ ä¸ªå­—èŠ‚å‘¢ï¼Ÿæˆ‘ä»¬æ²¡æœ‰å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼ŒmarkWord 8 ä¸ªå­—èŠ‚ï¼Œ class pointer 4 ä¸ªå­—èŠ‚ï¼Œ8 + 4 = 12 ç„¶å 8 ä¸ªå­—èŠ‚å¯¹é½ ä¹Ÿå°±æ˜¯ 16 ä¸ªå­—èŠ‚ã€‚æˆ‘ä»¬ä½¿ç”¨ JOL æ‰“å°å‡ºæ¥çœ‹çœ‹ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> static <span class="hljs-built_in">void</span> main(String[] args) &#123;<br>    A a = new A();<br>    System.<span class="hljs-keyword">out</span>.println(ClassLayout.parseInstance(a).toPrintable());<br>&#125;<br><br><span class="hljs-comment">// consoleï½</span><br>io.daiwei.jvm.jol.A object <span class="hljs-built_in">int</span>ernals:<br>OFF  SZ   TYPE DESCRIPTION               VALUE<br>  <span class="hljs-number">0</span>   <span class="hljs-number">8</span>        (object header: mark)     <span class="hljs-number">0x0000000000000001</span> (non-biasable; age: <span class="hljs-number">0</span>)<br>  <span class="hljs-number">8</span>   <span class="hljs-number">4</span>        (object header: <span class="hljs-keyword">class</span>)    <span class="hljs-symbol">0xf800c182</span><br> <span class="hljs-symbol">12</span>   <span class="hljs-symbol">4</span>        (<span class="hljs-symbol">object</span> <span class="hljs-symbol">alignment</span> <span class="hljs-symbol">gap</span>)    <br><span class="hljs-symbol">Instance</span> <span class="hljs-symbol">size: <span class="hljs-symbol">16</span></span> <span class="hljs-symbol">bytes</span><br><span class="hljs-symbol">Space</span> <span class="hljs-symbol">losses: <span class="hljs-symbol">0</span></span> <span class="hljs-symbol">bytes</span> <span class="hljs-symbol">internal</span> + <span class="hljs-symbol">4</span> <span class="hljs-symbol">bytes</span> <span class="hljs-symbol">external</span> = <span class="hljs-symbol">4</span> <span class="hljs-symbol">bytes</span> <span class="hljs-symbol">total</span><br></code></pre></td></tr></table></figure><p> é‚£ä¹ˆä¸€ä¸ªæ•°ç»„å¯¹è±¡å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢æåˆ°æ•°ç»„å¯¹è±¡å®ä¾‹å¯¹è±¡å¤´ä¸­ä¼šå¤šä¸€ä¸ª<code>length field</code>ç”¨æ¥å­˜æ•°ç»„çš„é•¿åº¦ã€‚æŒ‰ç…§æˆ‘ä»¬çš„è®¡ç®—é€»è¾‘ï¼Œæˆ‘ä»¬æ²¡å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼ŒmarkWord å ç”¨ 8 ä¸ªå­—èŠ‚ï¼ŒclassPonter å  4 ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæ•°æ•°ç»„å¯¹è±¡å¤šä¸€ä¸ª lengthField 4 ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯ 4 + 4 + 8 = 16ï¼Œåˆšå¥½å¯¹é½ 16 ä¸ªå­—èŠ‚ã€‚çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿæ²¡è½ä¸‹ä»€ä¹ˆå—ï¼Ÿ</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tap">public static void main(String[] args) &#123;<br>    int[] nums = new int[10];<br>    System.out.println(ClassLayout.parseInstance(nums).toPrintable());<br>&#125;<br><br>// consoleï½<br>[I object internals:<br>OFF  SZ   TYPE DESCRIPTION               VALUE<br> <span class="hljs-number"> 0 </span> <span class="hljs-number"> 8 </span>       (object header: mark)     0x0000000000000001 (non-biasable; age: 0)<br> <span class="hljs-number"> 8 </span> <span class="hljs-number"> 4 </span>       (object header: class)    0xf800016d<br><span class="hljs-number"> 12 </span> <span class="hljs-number"> 4 </span>       (array length)            10<br><span class="hljs-number"> 12 </span> <span class="hljs-number"> 4 </span>       (alignment/padding gap)   <br><span class="hljs-number"> 16 </span><span class="hljs-number"> 40 </span>   int [I.&lt;elements&gt;             N/A<br>Instance size:<span class="hljs-number"> 56 </span>bytes<br>Space losses:<span class="hljs-number"> 4 </span>bytes internal +<span class="hljs-number"> 0 </span>bytes external =<span class="hljs-number"> 4 </span>bytes total<br></code></pre></td></tr></table></figure><p> å®é™…çš„å®ä¾‹çš„å¤§å°æ˜¯56ï¼Œä»”ç»†çœ‹ï¼Œæ‰“å°ç»“æœçš„ç¬¬13è¡Œï¼Œå¤šäº† 40 ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯å•¥å‘¢ï¼Ÿæ²¡é”™æ˜¯æˆ‘ä»¬é•¿åº¦ä¸º10çš„æ•°ç»„å†…å®¹ï¼Œä¸€ä¸ª int ç±»å‹å››ä¸ªå­—èŠ‚å°±æ˜¯ 40 ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥æœ€ç»ˆçš„å¤§å°å°±æ˜¯ 16 + 40 = 56 åˆšå¥½ä¹Ÿä¸ç”¨å¯¹é½ï½ã€‚ </p><p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç¨å¾®æ­£å¸¸ç‚¹çš„å¯¹è±¡ Bã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">B</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String hello;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> a;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span>ean b;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>B å¯¹è±¡åŒ…å«ï¼Œä¸€ä¸ª Stringï¼Œä¸€ä¸ªint å’Œä¸€ä¸ª booleanï¼Œæˆ‘ä»¬æ ¹æ®ä¹‹å‰çš„ç»éªŒå¯ä»¥æ¨å‡º æ²¡æœ‰å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼Œå¯¹è±¡å¤´12ä¸ªå­—èŠ‚ï¼ŒString æ˜¯ä¸€ä¸ªå¼•ç”¨4ä¸ªå­—èŠ‚ï¼Œint  4 ä¸ªå­—èŠ‚ï¼Œboolean ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ 12 + 4 + 4 + 1 =  21 ä¸ªå­—èŠ‚ï¼Œç„¶åå†…å­˜å¯¹é½ï¼Œå®ä¾‹å¤§å° 24 ä¸ªå­—èŠ‚ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>    B b = <span class="hljs-keyword">new</span> <span class="hljs-constructor">B()</span>;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassLayout</span>.</span></span>parse<span class="hljs-constructor">Instance(<span class="hljs-params">b</span>)</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">Printable()</span>);<br>&#125;<br><br><span class="hljs-comment">// consoleï½</span><br>io.daiwei.jvm.jol.B <span class="hljs-keyword">object</span> internals:<br>OFF  SZ               TYPE DESCRIPTION               VALUE<br>  <span class="hljs-number">0</span>   <span class="hljs-number">8</span>                    (<span class="hljs-keyword">object</span> header: mark)     <span class="hljs-number">0x0000000000000001</span> (non-biasable; age: <span class="hljs-number">0</span>)<br>  <span class="hljs-number">8</span>   <span class="hljs-number">4</span>                    (<span class="hljs-keyword">object</span> header: <span class="hljs-keyword">class</span>)    <span class="hljs-number">0xf800c143</span><br> <span class="hljs-number">12</span>   <span class="hljs-number">4</span>                <span class="hljs-built_in">int</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>a                       <span class="hljs-number">0</span><br> <span class="hljs-number">16</span>   <span class="hljs-number">1</span>            boolean <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>b                       <span class="hljs-literal">false</span><br> <span class="hljs-number">17</span>   <span class="hljs-number">3</span>                    (alignment/padding gap)   <br> <span class="hljs-number">20</span>   <span class="hljs-number">4</span>   java.lang.String <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>hello                   null<br>Instance size: <span class="hljs-number">24</span> <span class="hljs-built_in">bytes</span><br>Space losses: <span class="hljs-number">3</span> <span class="hljs-built_in">bytes</span> internal + <span class="hljs-number">0</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">external</span> = <span class="hljs-number">3</span> <span class="hljs-built_in">bytes</span> total<br></code></pre></td></tr></table></figure><p>æ²¡æ¯›ç—…ï¼Œæœ€ç»ˆå®ä¾‹å¤§å° 24 ä¸ªå­—èŠ‚ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸€å°èŠ‚å‘¢ï¼Œæˆ‘ä»¬ä»ç±»çš„ç”Ÿå‘½å‘¨æœŸå…¥æ‰‹æ·±å…¥äº†è§£äº†ç±»çš„åŠ è½½è¿‡ç¨‹å’Œå®ä¾‹åœ¨å†…å­˜ä¸­çš„å¯¹è±¡å¸ƒå±€ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º åŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–ï¼Œä½¿ç”¨ã€å¸è½½ã€‚è¿‡ç¨‹å¯ä»¥ç±»æ¯”åšèœçš„è¿‡ç¨‹ã€‚å…¶ä¸­ç±»å¹¶ä¸æ˜¯åœ¨ JVM å¯åŠ¨æ—¶å…¨éƒ¨åŠ è½½è€Œæ˜¯æŒ‰éœ€åŠ è½½çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»äº†ç±»åŠ è½½å™¨ï¼Œæœ‰å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œæ‹“å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç±»åŠ è½½å™¨ã€‚ä»–ä»¬é‡‡ç”¨åŒäº²å§”æ´¾çš„æ–¹å¼ï¼Œæ‰€è°“çš„åŒäº²å§”æ´¾å°±æ˜¯å…ˆç”±çˆ¶ç±»åŠ è½½ï¼Œçˆ¶ç±»å¦‚æœåŠ è½½åœ¨ä¸äº†å†ç”±å­ç±»åŠ è½½ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ªç±»æ¯æ¬¡éƒ½ç”±æŸä¸ªç‰¹å®šçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å®ç°åŠ è½½é€»è¾‘çš„è‡ªå®šä¹‰åŒ–ï¼Œè¿™ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»æ˜¯åº”ç”¨ç±»åŠ è½½å™¨ã€‚èŠå®Œç±»çš„åŠ è½½ï¼Œæˆ‘ä»¬æ¢è®¨äº†å®ä¾‹çš„å†…å­˜å¸ƒå±€ï¼Œä¸€ä¸ªå®ä¾‹åˆ†ä¸ºå¯¹è±¡å¤´ï¼Œå®ä¾‹æ•°æ®å’Œå¡«å……æ•°æ®è¿™ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­å¯¹è±¡å¤´åˆåŒ…æ‹¬ markWordã€klassPointerå’Œæ•°ç»„å¯¹è±¡ç‰¹æœ‰çš„ lengthFieldï¼Œå¯¹è±¡å¤´çš„å¤§å°å—æ˜¯å¦å¼€å¯æŒ‡é’ˆå‹ç¼©æœ‰å…³ã€‚æœ€åæˆ‘ä»¬ä½¿ç”¨ openJDK æä¾›çš„JOLå·¥å…·éªŒè¯äº†æˆ‘ä»¬çš„ç†è®ºå¯¹è±¡å¸ƒå±€ç†è®ºã€‚è¿™æ˜¯JVMåŸºç¡€æ­£å¼ç¯‡çš„æœ€åä¸€å°èŠ‚ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä¸€èµ·æ¢è®¨ JVM çš„å†…å­˜ï¼ŒGC å’Œ é«˜æ•ˆç¼–è¯‘çš„éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥çš„ JVM ä¼šæ›´åŠ ç²¾å½©ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ï¼Œæœ‰äº†è¿™äº›ä¸œè¥¿ JVM ä¼šç©å‡ºäº›å•¥ä¸ä¸€æ ·çš„ã€‚å“ˆå“ˆï¼Œæ™šå®‰ï½</p><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/142614439">JVMåŸºç¡€ï¼ˆä¸‰ï¼‰ä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</a></li><li><a href="https://www.cnblogs.com/jajian/p/13681781.html">Java å¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li><li>Javaç±»åŠ è½½å™¨ï¼šå±±ä¸è¾åœŸï¼Œæ•…èƒ½æˆå…¶é«˜ </li></ul>]]></content>
    
    
    <categories>
      
      <category>Javaè™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>JavaçŸ¥è¯†ç»“æ„æ¢³ç†</tag>
      
      <tag>å­¦ä¹ æ€»ç»“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM åŸºç¡€ â€” Java æ–¹æ³•è°ƒç”¨ã€åå°„è°ƒç”¨ä¸å¼‚å¸¸</title>
    <link href="/2021/05/09/java-method-invoke/"/>
    <url>/2021/05/09/java-method-invoke/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å‰ä¸€ç¯‡ä¸­ç®€å•ä»‹ç»äº†Java å­—èŠ‚ç ä¸­æœ‰å…³æ–¹æ³•è°ƒç”¨çš„ä¸€äº›æ“ä½œç ï¼Œä½†æ˜¯ java æ–¹æ³•çš„è°ƒç”¨å¾€æ·±äº†è®²åˆæœ‰å¾ˆå¤šçš„é—¨é“ï¼Œç®€å•çš„æœ‰æ–¹æ³•çš„é‡å†™å’Œé‡è½½ï¼Œæ·±å…¥ä¹Ÿæœ‰æ–¹æ³•çš„åŠ¨æ€ç»‘å®šå’Œé™æ€ç»‘å®šï¼Œé‚£JVMæ˜¯å¦‚æœè¯†åˆ«å’Œé€‰å®šæ–¹æ³•çš„å‘¢ï¼Ÿè¿˜æœ‰æœ‰äº›æ—¶å€™æˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥è°ƒç”¨æŸä¸ªç›®æ ‡æ–¹æ³•ï¼Œè€Œæ˜¯è¦ä½¿ç”¨ä¸€äº›ç‰¹åˆ«çš„æ‰‹æ®µå»è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šç»å¸¸ç”¨åˆ°çš„åå°„ï¼Œåå°„ä¸åŒäºå¸¸è§„çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™è´§ä¸€ä¸Šæ¥å°±ä¸èµ°å¯»å¸¸è·¯ï¼Œä¸€èˆ¬æ–¹æ³•è°ƒç”¨éƒ½æ˜¯å…ˆ new ä¸€ä¸ªå¯¹è±¡ï¼Œå°±åƒæ˜¯æœ‹å‹æ¥å®¶é‡Œåšå®¢ä»æ­£é—¨è¿›æ¥ï¼Œåå°„æ˜¯å…ˆé€šè¿‡ class å¯¹è±¡æ‰¾åˆ°ç›®æ ‡æ–¹æ³•ç„¶åä¼ å…¥è°ƒç”¨å®ä¾‹ï¼Œè¿™æ›´åƒæ˜¯ç¿»å¢™è¿›æ¥ã€‚é‚£è¿™ä¸ªç¿»å¢™è¿›æ¥çš„å®ƒèƒŒåçš„åŸç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿå‡å¦‚è¿™ä¸ªä¸–ç•Œæ˜¯ç¾å¥½çš„ï¼Œä½†ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œå¯èƒ½æ²¡é‚£ä¹ˆé¡ºåˆ©ï¼Œä¸‡ä¸€å‘ç”Ÿäº†å¼‚å¸¸è¿™ä¸ªå¼‚å¸¸åˆæ˜¯æ€ä¹ˆæ•è·çš„å‘¢ï¼Ÿ</p><h2 id="Java-æ–¹æ³•è°ƒç”¨åŸç†"><a href="#Java-æ–¹æ³•è°ƒç”¨åŸç†" class="headerlink" title="Java æ–¹æ³•è°ƒç”¨åŸç†"></a>Java æ–¹æ³•è°ƒç”¨åŸç†</h2><h3 id="é‡å†™ä¸é‡è½½"><a href="#é‡å†™ä¸é‡è½½" class="headerlink" title="é‡å†™ä¸é‡è½½"></a>é‡å†™ä¸é‡è½½</h3><p>åœ¨ Java ç¨‹åºé‡Œå¦‚æœä¸€ä¸ªç±»å‡ºç°äº†å¤šä¸ªåå­—ç›¸åŒä¸”å‚æ•°ç±»å‹ç›¸åŒçš„æ–¹æ³•ï¼Œé‚£ä¹ˆä»–ä»¬æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šå‡ºç°æ–¹æ³•åç›¸åŒä½†æ˜¯æ–¹æ³•å‚æ•°ç±»å‹ä¸ç›¸åŒã€‚è¿™ç§æƒ…å†µç§°ä¹‹ä¸º<code>é‡è½½</code>ã€‚</p><p>é‡è½½çš„æ–¹æ³•åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å³å¯å®Œæˆæ–¹æ³•çš„è¯†åˆ«ã€‚Java ç¼–è¯‘å™¨ä¼šæ ¹æ®æ–¹æ³•åå’Œä¼ å…¥çš„å‚æ•°çš„<code>å£°æ˜ç±»å‹</code>é€‰å–é‡è½½æ–¹æ³•ã€‚é€‰å–çš„è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>åœ¨ä¸è€ƒè™‘å¯¹åŸºæœ¬ç±»å‹è‡ªåŠ¨è£…æ‹†ç®±ï¼ˆauto-boxingï¼Œ auto-unboxingï¼‰ï¼Œå·²ç»å¯å˜é•¿å‚æ•°çš„æƒ…å†µä¸‹é€‰å–é‡è½½æ–¹æ³•ã€‚ï¼ˆ<code>ä¸è€ƒè™‘è‡ªåŠ¨è£…æ‹†ç®±ï¼Œä¸è€ƒè™‘å˜é•¿å‚æ•°</code>ï¼‰</li><li>å¦‚æœåœ¨ç¬¬ 1 ä¸ªé˜¶æ®µä¸­æ²¡æœ‰æ‰¾åˆ°é€‚é…çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å…è®¸è‡ªåŠ¨è£…æ‹†ç®±ï¼Œä½†æ˜¯ä¸å…è®¸å¯å˜é•¿å‚æ•°çš„æƒ…å†µä¸‹é€‰å–é‡è½½æ–¹æ³•ã€‚ï¼ˆ<code>è€ƒè™‘è‡ªåŠ¨è£…æ‹†ç®±ï¼Œä¸è€ƒè™‘å˜é•¿å‚æ•°</code>ï¼‰</li><li>å¦‚æœåœ¨ç¬¬ 2 ä¸ªé˜¶æ®µä¸­æ²¡æœ‰æ‰¾åˆ°é€‚é…æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å…è®¸è‡ªåŠ¨è£…æ‹†ç®±ä»¥åŠå˜é•¿å‚æ•°çš„æƒ…å†µä¸‹é€‰å–é‡è½½æ–¹æ³•ã€‚ï¼ˆ<code>è€ƒè™‘è‡ªåŠ¨è£…æ‹†ç®±ï¼Œè€ƒè™‘å˜é•¿å‚æ•°</code>ï¼‰</li></ol><p>å¦‚æœ Java ç¼–è¯‘å™¨åœ¨åŒä¸€é˜¶æ®µæ‰¾åˆ°å¤šä¸ªé€‚é…æ–¹æ³•ï¼Œå®ƒä¼šåœ¨å…¶ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€ä¸ºè´´åˆ‡çš„ã€‚è€Œå†³å®šè´´åˆ‡ç¨‹åº¦çš„ä¸€ä¸ªå…³é”®å°±æ˜¯å½¢å¼å‚æ•°ç±»å‹çš„ç»§æ‰¿å…³ç³»ã€‚é‡è½½ä¹Ÿé€‚ç”¨å­ç±»ä»çˆ¶ç±»ä¸­ç»§æ‰¿æ¥çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå­ç±»ä¸­å®šä¹‰äº†å’Œçˆ¶ç±»éç§æœ‰æ–¹æ³•ä¸­æ–¹æ³•åç›¸åŒä¸”æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸åŒçš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å­ç±»ä¸­è¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿæ„æˆäº†é‡è½½ã€‚</p><p>Java æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå…¶ä¸­æœ‰ä¸ªé‡è¦çš„ç‰¹æ€§å°±æ˜¯å¤šæ€ã€‚è€Œæ–¹æ³•çš„é‡å†™å°±æ˜¯å¤šæ€çš„æœ€é‡è¦çš„ä¸€ç§ä½“ç°å½¢å¼ã€‚é€šè¿‡å¯¹æ–¹æ³•çš„é‡å†™ï¼Œå…è®¸å­ç±»å¯¹äºä¸åŒçš„åŠ¨ä½œæœ‰è‡ªå·±ç‹¬ç‰¹çš„è¡Œä¸ºã€‚ åœ¨è°ƒç”¨é‡å†™çš„æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šæ›´å…·å…·ä½“çš„ç±»å‹è°ƒç”¨ç›®æ ‡å®é™…çš„æ–¹æ³•ã€‚</p><h3 id="JVM-çš„é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®š"><a href="#JVM-çš„é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®š" class="headerlink" title="JVM çš„é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®š"></a>JVM çš„é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®š</h3><p>å‰é¢è¯´åˆ° Java ç¼–è¯‘å™¨é€šè¿‡æ–¹æ³•åå’Œæ–¹æ³•å‚æ•°ç±»å‹è¯†åˆ«æ–¹æ³•ï¼ŒJVM æ˜¯é€šè¿‡æ–¹æ³•åå’Œæ–¹æ³•æè¿°ç¬¦å»è¯†åˆ«æ–¹æ³•çš„ï¼Œ<code>æ–¹æ³•æè¿°ç¬¦</code>åŒ…æ‹¬<code>æ–¹æ³•å‚æ•°ç±»å‹</code>å’Œ<code>è¿”å›å€¼</code>ï¼Œæ³¨æ„åœ¨JVMçš„æ–¹æ³•æè¿°ç¬¦ä¸­æ˜¯åŒ…æ‹¬æ–¹æ³•çš„è¿”å›å€¼çš„ã€‚æ‰€ä»¥åœ¨ä¸€ä¸ªç±»ä¸­å¦‚æœå‡ºç°å¤šä¸ªæ–¹æ³•åå’Œæ–¹æ³•æè¿°ç¬¦çš„JVMåœ¨ç±»åŠ è½½çš„éªŒè¯é˜¶æ®µå°±ä¼šæŠ¥é”™ã€‚</p><p>ç”±äºé‡è½½æ–¹æ³•åœ¨ç¼–è¯‘æœŸå·²ç»ç¡®å®šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤å®šï¼Œåœ¨ JVM å±‚é¢ä¸å­˜åœ¨é‡è½½è¿™ä¸€æ¦‚å¿µã€‚å› ä¸ºå¯¹äº JVMæ¥è¯´è¿™å°±æ˜¯ä¸¤ä¸ªæ–¹æ³•ã€‚æ‰€ä»¥é’ˆå¯¹JVMæ¥è¯´åœ¨<code>ç¼–è¯‘æœŸå¯ä»¥ç›´æ¥è§£æ</code>è¯†åˆ«çš„ç›®æ ‡æ–¹æ³•å°±æ˜¯<code>é™æ€ç»‘å®šï¼ˆstatic bindingï¼‰</code>ï¼Œè€Œ<code>åŠ¨æ€ç»‘å®šï¼ˆdynamic bindingï¼‰</code>æŒ‡çš„æ˜¯éœ€è¦åœ¨<code>è¿è¡ŒæœŸé—´æ ¹æ®è°ƒç”¨è€…çš„ç±»å‹æ¥è¯†åˆ«ç›®æ ‡æ–¹æ³•</code>çš„æƒ…å†µã€‚æ‰€ä»¥ Java ç¼–è¯‘å™¨ä¼šå°†æ‰€æœ‰å¯¹éç§æœ‰çš„å®ä¾‹æ–¹æ³•è§£æä¸ºéœ€è¦åŠ¨æ€ç»‘å®šçš„ç±»å‹ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡å­—èŠ‚ç ä¸­æåˆ°äº†äº”ç§å…³äºæ–¹æ³•è°ƒç”¨æ“ä½œç </p><ol><li>invokestaticï¼šç”¨äºè°ƒç”¨é™æ€æ–¹æ³•ã€‚</li><li>invokespecialï¼šç”¨äºè°ƒç”¨ç§æœ‰å®ä¾‹æ–¹æ³•ã€æ„é€ å™¨ï¼Œä»¥åŠä½¿ç”¨ super å…³é”®å­—è°ƒç”¨çˆ¶ç±»çš„å®ä¾‹æ–¹æ³•æˆ–æ„é€ å™¨ï¼Œå’Œæ‰€å®ç°æ¥å£çš„é»˜è®¤æ–¹æ³•ã€‚</li><li>invokevirtualï¼šç”¨äºè°ƒç”¨éç§æœ‰å®ä¾‹æ–¹æ³•ã€‚</li><li>invokeinterfaceï¼šç”¨äºè°ƒç”¨æ¥å£æ–¹æ³•ï¼ˆç”¨æ¥å£çš„å»è°ƒç”¨ï¼‰ã€‚</li><li>invokedynamicï¼šç”¨äºè°ƒç”¨åŠ¨æ€æ–¹æ³•ã€‚</li></ol><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> TestMain &#123;<br><br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        HiClass hiClass = <span class="hljs-keyword">new</span> <span class="hljs-constructor">HiClass()</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hiClass.hi<span class="hljs-constructor">You(<span class="hljs-string">&quot;daiwei&quot;</span>)</span>);<br>        GoodNight goodNight = (GoodNight) hiClass;<br>        goodNight.good<span class="hljs-constructor">Night(<span class="hljs-string">&quot;daiwei&quot;</span>)</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span>stream(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span><span class="hljs-literal">[]</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;).reduce(<span class="hljs-number">0</span>, Integer::sum));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„å­—èŠ‚ç å¦‚ä¸‹ï¼ˆåªæˆªå–æ–¹æ³•éƒ¨åˆ†ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">public</span> <span class="hljs-string">static</span> <span class="hljs-string">void</span> <span class="hljs-string">main(java.lang.String[]);</span><br>    <span class="hljs-attr">descriptor:</span> <span class="hljs-string">([Ljava/lang/String;)V</span><br>    <span class="hljs-attr">flags:</span> <span class="hljs-string">ACC_PUBLIC,</span> <span class="hljs-string">ACC_STATIC</span><br>    <span class="hljs-attr">Code:</span><br>      <span class="hljs-string">stack=5,</span> <span class="hljs-string">locals=3,</span> <span class="hljs-string">args_size=1</span><br>         <span class="hljs-attr">0:</span> <span class="hljs-string">new</span>           <span class="hljs-comment">#2                  // class io/daiwei/jvm/HiClass</span><br>         <span class="hljs-attr">3:</span> <span class="hljs-string">dup</span><br>         <span class="hljs-attr">4:</span> <span class="hljs-string">invokespecial</span> <span class="hljs-comment">#3                  // Method io/daiwei/jvm/HiClass.&quot;&lt;init&gt;&quot;:()V</span><br>         <span class="hljs-attr">7:</span> <span class="hljs-string">astore_1</span><br>         <span class="hljs-attr">8:</span> <span class="hljs-string">getstatic</span>     <span class="hljs-comment">#4                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br>        <span class="hljs-attr">11:</span> <span class="hljs-string">aload_1</span><br>        <span class="hljs-attr">12:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#5                  // String daiwei</span><br>        <span class="hljs-attr">14:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#6                  // Method io/daiwei/jvm/HiClass.hiYou:(Ljava/lang/String;)Ljava/lang/String;</span><br>        <span class="hljs-attr">17:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#7                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br>        <span class="hljs-attr">20:</span> <span class="hljs-string">aload_1</span><br>        <span class="hljs-attr">21:</span> <span class="hljs-string">astore_2</span><br>        <span class="hljs-attr">22:</span> <span class="hljs-string">aload_2</span><br>        <span class="hljs-attr">23:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#5                  // String daiwei</span><br>        <span class="hljs-attr">25:</span> <span class="hljs-string">invokeinterface</span> <span class="hljs-comment">#8,  2            // InterfaceMethod io/daiwei/jvm/GoodNight.goodNight:(Ljava/lang/String;)V</span><br>        <span class="hljs-attr">30:</span> <span class="hljs-string">getstatic</span>     <span class="hljs-comment">#4                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br>        <span class="hljs-attr">33:</span> <span class="hljs-string">iconst_3</span><br>        <span class="hljs-attr">34:</span> <span class="hljs-string">newarray</span>       <span class="hljs-string">int</span><br>        <span class="hljs-attr">36:</span> <span class="hljs-string">dup</span><br>        <span class="hljs-attr">37:</span> <span class="hljs-string">iconst_0</span><br>        <span class="hljs-attr">38:</span> <span class="hljs-string">iconst_1</span><br>        <span class="hljs-attr">39:</span> <span class="hljs-string">iastore</span><br>        <span class="hljs-attr">40:</span> <span class="hljs-string">dup</span><br>        <span class="hljs-attr">41:</span> <span class="hljs-string">iconst_1</span><br>        <span class="hljs-attr">42:</span> <span class="hljs-string">iconst_2</span><br>        <span class="hljs-attr">43:</span> <span class="hljs-string">iastore</span><br>        <span class="hljs-attr">44:</span> <span class="hljs-string">dup</span><br>        <span class="hljs-attr">45:</span> <span class="hljs-string">iconst_2</span><br>        <span class="hljs-attr">46:</span> <span class="hljs-string">iconst_3</span><br>        <span class="hljs-attr">47:</span> <span class="hljs-string">iastore</span><br>        <span class="hljs-attr">48:</span> <span class="hljs-string">invokestatic</span>  <span class="hljs-comment">#9                  // Method java/util/Arrays.stream:([I)Ljava/util/stream/IntStream;</span><br>        <span class="hljs-attr">51:</span> <span class="hljs-string">iconst_0</span><br>        <span class="hljs-attr">52:</span> <span class="hljs-string">invokedynamic</span> <span class="hljs-comment">#10,  0             // InvokeDynamic #0:applyAsInt:()Ljava/util/function/IntBinaryOperator;</span><br>        <span class="hljs-attr">57:</span> <span class="hljs-string">invokeinterface</span> <span class="hljs-comment">#11,  3           // InterfaceMethod java/util/stream/IntStream.reduce:(ILjava/util/function/IntBinaryOperator;)I</span><br>        <span class="hljs-attr">62:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#12                 // Method java/io/PrintStream.println:(I)V</span><br>        <span class="hljs-attr">65:</span> <span class="hljs-string">return</span><br></code></pre></td></tr></table></figure><p>ç»“åˆä¸Šä¸€ç¯‡å­—èŠ‚ç çš„çŸ¥è¯†ï¼Œè¿™é‡Œçš„å­—èŠ‚ç ä¸éš¾åˆ†æï¼Œ<code>4: invokespecial</code> è¿™é‡Œæ˜¯è°ƒç”¨æ„é€ å‡½æ•°ï¼Œ<code>14: invokevirtual #6 // Method io/daiwei/jvm/HiClass.hiYou</code> è¿™é‡Œæ˜¯ä½¿ç”¨ <code>invokevirutal</code> è°ƒç”¨ hiYou æ–¹æ³•ã€‚<code>invokeinterface #8,  2 // InterfaceMethod io/daiwei/jvm/GoodNight.goodNight:(Ljava/lang/String;)V</code> ä½¿ç”¨ <code>invokeinterface</code> è°ƒç”¨æ¥å£æ–¹æ³•ã€‚<code>52: invokedynamic #10,  0</code> è¿™é‡Œåˆ™æ˜¯ lambda è¡¨è¾¾å¼çš„ <code>invokedynamic</code>ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ <code>invokesepcial</code> å’Œ <code>invokespeical</code>ï¼ŒJVM èƒ½ç›´æ¥è¯†åˆ«å‡ºç›®æ ‡æ–¹æ³•ï¼ˆé™æ€ç»‘å®šï¼‰ï¼Œè€Œ <code>invokevirutal</code> å’Œ <code>invokeinterface</code> åˆ™éœ€è¦åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åˆ¤å®šç›®æ ‡ç±»å‹ä»è€Œç¡®å®šç›®æ ‡æ–¹æ³•ï¼ˆåŠ¨æ€ç»‘å®šï¼‰ã€‚å¯¹äº final æ–¹æ³•å¯ä»¥ç›´æ¥ç¡®å®šç›®æ ‡æ–¹æ³•ã€‚</p><h3 id="è°ƒç”¨æŒ‡ä»¤çš„ç¬¦å·å¼•ç”¨"><a href="#è°ƒç”¨æŒ‡ä»¤çš„ç¬¦å·å¼•ç”¨" class="headerlink" title="è°ƒç”¨æŒ‡ä»¤çš„ç¬¦å·å¼•ç”¨"></a>è°ƒç”¨æŒ‡ä»¤çš„ç¬¦å·å¼•ç”¨</h3><p>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„å†…å­˜åœ°å€ã€‚ç¼–è¯‘å™¨ä¼šæš‚æ—¶ç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä»£æ›¿ç›®æ ‡æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ–¹æ³•æ–¹æ³•åå’Œæ–¹æ³•æè¿°ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ª <code>io/daiwei/jvm/HiClass.hiYou:(Ljava/lang/String;)Ljava/lang/String;</code></p><ul><li><code>io/daiwei/jvm/HiClass.hiYou</code> ç›®æ ‡ç±»åæ–¹æ³•åã€‚</li><li><code>(Ljava/lang/String;)</code> å‚æ•°ç±»å‹ï¼ŒLä»£è¡¨å¼•ç”¨ç±»å‹ ï¼Œè¿™é‡Œæ˜¯å¼•ç”¨ç±»å‹ Stringã€‚</li><li><code>Ljava/lang/String;</code> è¿”å›ç±»å‹ï¼Œå¼•ç”¨ç±»å‹ Stringã€‚</li></ul><p>è¿™äº›æ–¹æ³•æè¿°ç¬¦ä½œä¸ºå¸¸é‡ä¿¡æ¯å­˜åœ¨ç±»çš„<code>å¸¸é‡æ± </code>ä¸­ã€‚åœ¨ä½¿ç”¨è¿™äº›ç¬¦å·å¼•ç”¨å­—èŠ‚ç ä¹‹å‰ï¼ŒJVM ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæŠŠå®ƒæ›¿æ¢ä¸ºçœŸæ­£çš„å¼•ç”¨ã€‚</p><p>å¯¹äº<code>éæ¥å£</code>ç¬¦å·å¼•ç”¨ï¼Œå‡å®šè¯¥ç¬¦å·å¼•ç”¨æŒ‡å‘ç±»Cï¼Œåˆ™ Java è™šæ‹Ÿæœºä¼šæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æŸ¥æ‰¾ã€‚ï¼ˆC -&gt; C çˆ¶ç±» -&gt; C é—´æ¥å®ç°æ¥å£ï¼‰</p><ol><li>åœ¨ C ä¸­æŸ¥æ‰¾ç¬¦åˆåå­—åŠæè¿°ç¬¦çš„æ–¹æ³•ã€‚</li><li>å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåœ¨ C çš„çˆ¶äº²ç±»ä¸­ç»§ç»­æœç´¢ï¼Œç›´è‡³ Object ç±»ã€‚</li><li>å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåœ¨ C ç›´æ¥æˆ–è€…é—´æ¥å®ç°çš„æ¥å£ä¸­æœç´¢ã€‚è¿™ä¸€æ­¥æœç´¢çš„æ–¹æ³•å¿…é¡»æ˜¯ éç§æœ‰ï¼Œéé™æ€çš„ã€‚</li></ol><p>è°ƒç”¨<code>æ¥å£</code>ç¬¦å·å¼•ç”¨ï¼Œå‡å®šè¯¥ç¬¦å·å¼•ç”¨æŒ‡å‘ I ï¼Œåˆ™ Java è™šæ‹Ÿæœºä¼šæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><ol><li>åœ¨ I ä¸­æŸ¥æ‰¾ç¬¦åˆåå­—åŠæè¿°ç¬¦çš„æ–¹æ³•ã€‚ï¼ˆI -&gt; Object -&gt;I è¶…ç±»æ¥å£ï¼‰</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåœ¨ Object ç±»ä¸­çš„å…¬æœ‰å®ä¾‹æ–¹æ³•ä¸­æœç´¢ã€‚</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åœ¨ I çš„è¶…æ¥å£ä¸­æœç´¢ã€‚è¿™ä¸€æ­¥çš„æœç´¢ç»“æœçš„è¦æ±‚ä¸éæ¥å£ç¬¦å·å¼•ç”¨æ­¥éª¤ 3 çš„è¦æ±‚ä¸€è‡´ã€‚</li></ol><p>ç»è¿‡ä¸Šè¿°çš„è§£æä¹‹åï¼Œé™æ€æ–¹æ³•ä¼šè¢«è§£ææˆä¸€ä¸ªæ–¹æ³•çš„æŒ‡é’ˆï¼Œè€Œéœ€è¦åŠ¨æ€ç»‘å®šçš„æ–¹æ³•åˆ™ä¼šè¢«è§£ææˆä¸€ä¸ªæ–¹æ³•è¡¨çš„ç´¢å¼•ã€‚</p><h3 id="æ–¹æ³•è¡¨"><a href="#æ–¹æ³•è¡¨" class="headerlink" title="æ–¹æ³•è¡¨"></a>æ–¹æ³•è¡¨</h3><p>Java è™šæ‹Ÿæœºé€šè¿‡ä¸€ç§ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ–¹æ³•æ¥å®ç°åŠ¨æ€ç»‘å®šã€‚åœ¨ç±»åŠ è½½çš„å‡†å¤‡é˜¶æ®µï¼Œä¸ä»…ä¼šä¸ºé™æ€å­—æ®µåˆ†é…å†…å­˜ï¼Œè¿˜ä¼šç”Ÿæˆç±»çš„æ–¹æ³•è¡¨ã€‚æ–¹æ³•è¡¨çš„æ˜¯ä¸€ä¸ªæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªæ•°æ®å°±æ˜¯åŠ¨æ€ç»‘å®šå®ç°çš„å…³é”®ï¼Œè°ƒç”¨ <code>invokevirutal</code> æœ‰ <code>è™šæ–¹æ³•è¡¨ï¼ˆvirtual method tableï¼Œvtableï¼‰</code></p><p>è°ƒç”¨ <code>invokeinterface</code> æœ‰<code>æ¥å£æ–¹æ³•è¡¨ï¼ˆinterface method tableï¼Œ itableï¼‰</code>ï¼Œitable ä¼šç¨å¾®å¤æ‚äº›ï¼Œä½†æ˜¯åŸç†æ˜¯ä¸€è‡´çš„ã€‚åœ¨è¿™ä¸ªæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½æŒ‡å‘ä¸€ä¸ªå½“å‰ç±»æˆ–è€…çˆ¶ç±»ä¸­çš„ä¸€ä¸ªéç§æœ‰çš„å®ä¾‹æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥æ˜¯å…·ä½“çš„å¯æ‰§è¡Œçš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡çš„æ²¡æœ‰æ–¹æ³•ä½“çš„æŠ½è±¡æ–¹æ³•ã€‚æ–¹æ³•è¡¨æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªå…³é”®çš„ç‰¹è´¨ï¼š</p><ul><li>å­ç±»æ–¹æ³•è¡¨ä¸­åŒ…å«æ‰€æœ‰çš„çˆ¶ç±»æ–¹æ³•è¡¨çš„ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚</li><li>å­ç±»æ–¹æ³•è¡¨ä¸­çš„ç´¢å¼•å€¼ä¸ä»–é‡å†™çˆ¶ç±»æ–¹æ³•åœ¨æ–¹æ³•è¡¨ä¸­çš„ç´¢å¼•å€¼ç›¸åŒã€‚</li></ul><table><thead><tr><th>Personæ–¹æ³•è¡¨</th><th>walk()</th><th>share()</th><th>talk()</th><th></th></tr></thead><tbody><tr><td>Chineseæ–¹æ³•è¡¨</td><td>walk()</td><td>share()</td><td>talk()</td><td>chineseDo()</td></tr></tbody></table><p>åœ¨ä¸Šé¢è¿™ä¸ªè¡¨ä¸­ Chinese ç±»æ˜¯ Person çš„å­ç±»ï¼Œåœ¨ç±»åŠ è½½é˜¶æ®µç”Ÿæˆæ–¹æ³•è¡¨ï¼Œé™æ€æ–¹æ³•è§£ææ–¹æ³•å¼•ç”¨çš„æ—¶å€™å°†å…·ä½“çš„æ–¹æ³•æ›¿æ¢å…·ä½“æ–¹æ³•çš„æŒ‡é’ˆï¼Œå¯¹äºåŠ¨æ€ç»‘å®šçš„æ–¹æ³•è€Œè¨€ï¼Œæ›¿æ¢çš„å¼•ç”¨åˆ™æ˜¯æ–¹æ³•è¡¨ä¸­çš„ç´¢å¼•å€¼ï¼ˆå®é™…ä¸Šå¹¶ä¸åªæ˜¯ç´¢å¼•å€¼ï¼‰ã€‚è¿™æ ·çš„è¯ï¼Œåœ¨æ–¹æ³•è¿è¡Œé˜¶æ®µåªè¦æ‹¿åˆ°è¿è¡Œæ—¶çš„å¯¹è±¡ï¼Œæ ¹æ®å®ƒçš„æ–¹æ³•è¡¨æ‹¿åˆ°å…·ä½“çš„è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¾¿æ˜¯åŠ¨æ€ç»‘å®šã€‚</p><p>æœ‰äº†é¢å¤–çš„æ“ä½œï¼Œå°±ä¼šæœ‰é¢å¤–çš„æ€§èƒ½æ¶ˆè€—ï¼Œä½†æ˜¯åœ¨ç±»åŠ è½½é˜¶æ®µç”Ÿæˆæ–¹æ³•è¡¨ï¼Œè§£ææ–¹æ³•æ›¿æ¢æˆç´¢å¼•ï¼Œæ‰§è¡Œé˜¶æ®µæŸ¥è¯¢ç›®æ ‡æ–¹æ³•ï¼Œè™½ç„¶è¿™ä¸ªè¿‡ç¨‹çš„å¾ˆç®€å•ï¼Œæ˜¯å¦å¯ä»¥çœ‹ä½œå¯¹JVM æ²¡æœ‰å¤ªå¤§çš„å½±å“å‘¢ï¼Ÿæ˜¾ç„¶æ˜¯ä¸èƒ½çš„ã€‚æ‰€ä»¥é’ˆå¯¹è¿™ä¸ªæƒ…å†µç¼–è¯‘å™¨æœ‰ä¸¤ä¸ªä¼˜åŒ–æ‰‹æ®µå†…è”ç¼“å­˜ï¼ˆinline cacheï¼‰å’Œæ–¹æ³•å†…è”ï¼ˆmethod inlineï¼‰ã€‚</p><h3 id="å†…è”ç¼“å­˜å’Œæ–¹æ³•å†…è”"><a href="#å†…è”ç¼“å­˜å’Œæ–¹æ³•å†…è”" class="headerlink" title="å†…è”ç¼“å­˜å’Œæ–¹æ³•å†…è”"></a>å†…è”ç¼“å­˜å’Œæ–¹æ³•å†…è”</h3><p>å†…è”ç¼“å­˜æ˜¯ä¸€ç§åŠ å¿«ç»‘å®šçš„æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿç¼“å­˜åŠ¨æ€è°ƒç”¨çš„ç±»å‹ä»¥åŠè¯¥ç±»å‹å¯¹åº”çš„ç›®æ ‡æ–¹æ³•ï¼Œå¦‚æœåœ¨åé¢çš„è°ƒç”¨ä¸­å‡»ä¸­å·²ç¼“å­˜ç±»å‹ï¼Œä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç›®æ ‡æ–¹æ³•æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰å‘½ä¸­è°ƒç”¨ç±»å‹ï¼Œåˆ™é€€åŒ–ä¸ºæ–¹æ³•è¡¨åŠ¨æ€ç»‘å®šã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”¨ç©ºé—´æ¢æ¢æ—¶é—´çš„æ“ä½œã€‚</p><p>è¿˜æœ‰ä¸€ç§ä¼˜åŒ–æ‰‹æ®µé‚£ä¾¿æ˜¯æ–¹æ³•å†…è”ï¼Œç®€å•ä¸”é«˜é¢‘çš„æ–¹æ³•ä¾‹å¦‚ä¸€äº› get/set æ–¹æ³•ï¼ŒJava çš„å³æ—¶ç¼–è¯‘å™¨ä¼šç›´æ¥è¿›è¡Œæ–¹æ³•å†…è”ä¹Ÿå°±æ˜¯ç›´æ¥æŠŠè°ƒç”¨çš„æ–¹æ³•å’Œå¤–é¢çš„è°ƒç”¨ä¼˜åŒ–æˆä¸€ä¸ªå®Œæ•´çš„æ–¹æ³•æœºå™¨ç å­˜å‚¨èµ·æ¥ã€‚ç”¨è¿™ç§æ–¹æ³•æ¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚è¿™é‡Œè¦æ³¨æ„æ–¹æ³•å†…è”æ˜¯çœŸå†…è”ï¼Œè€Œå†…è”ç¼“å­˜é™„å¸¦å†…è”äºŒå­—ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰å†…è”ç›®æ ‡æ–¹æ³•ã€‚è¿™é‡Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨é™¤éè¢«å†…è”ï¼Œå¦åˆ™éƒ½ä¼šæœ‰å›ºå®šå¼€é”€ã€‚è¿™äº›å¼€é”€æ¥æºäºä¿å­˜ç¨‹åºåœ¨è¯¥æ–¹æ³•ä¸­çš„æ‰§è¡Œä½ç½®ï¼Œä»¥åŠæ–°å»ºã€å‹å…¥å’Œå¼¹å‡ºæ–°æ–¹æ³•æ‰€ä½¿ç”¨çš„æ ˆå¸§ï¼Œä¹Ÿå°±æ˜¯å†…è”ç¼“å­˜æ˜¯å‡å†…è”ã€‚</p><h2 id="Java-åå°„è°ƒç”¨æœºåˆ¶"><a href="#Java-åå°„è°ƒç”¨æœºåˆ¶" class="headerlink" title="Java åå°„è°ƒç”¨æœºåˆ¶"></a>Java åå°„è°ƒç”¨æœºåˆ¶</h2><p>Java çš„åå°„æœºåˆ¶å¯ä»¥è®©ä»£ç åœ¨è¿è¡Œé˜¶æ®µè‡ªçœï¼Œå¯ä»¥è®©ä»£ç çŸ¥é“è¿è¡Œé˜¶æ®µçš„æŸä¸ªå¯¹è±¡çš„æŸäº›å­—æ®µå’Œæ–¹æ³•ï¼Œå¹¶è¿›è¡Œè°ƒç”¨ï¼Œé‚£ Java çš„æ–¹æ³•åå°„è°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@CallerSensitive<br>public Object invoke(Object obj, Object... args)<br>    throws IllegalAccessException, IllegalArgumentException,<br>       InvocationTargetException<br>&#123;<br>    <span class="hljs-keyword">if</span> (!override) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Reflection</span>.</span></span>quick<span class="hljs-constructor">CheckMemberAccess(<span class="hljs-params">clazz</span>, <span class="hljs-params">modifiers</span>)</span>) &#123;<br>            Class&lt;?&gt; caller = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Reflection</span>.</span></span>get<span class="hljs-constructor">CallerClass()</span>;<br>            check<span class="hljs-constructor">Access(<span class="hljs-params">caller</span>, <span class="hljs-params">clazz</span>, <span class="hljs-params">obj</span>, <span class="hljs-params">modifiers</span>)</span>;<br>        &#125;<br>    &#125;<br>    MethodAccessor ma = methodAccessor;             <span class="hljs-comment">// read volatile</span><br>    <span class="hljs-keyword">if</span> (ma<span class="hljs-operator"> == </span>null) &#123;<br>        ma = acquire<span class="hljs-constructor">MethodAccessor()</span>;<br>    &#125;<br>    return ma.invoke(obj, args);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° invoke æ–¹æ³•çš„æºç ï¼Œmethod.invoke()ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨ <code>MethodAccessor.invoke()</code>ï¼Œè€ŒMethodAccessor åˆæœ‰ä¸¤ä¸ªå®ç°ç±» <code>DeleagetingMethodAccessor</code> å’Œ <code>NativeMethodAccessor</code> ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨äº†å§”æ´¾æ¨¡å¼å®ç°è°ƒç”¨ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯é€šè¿‡ Native æ–¹æ³•å®ç°åå°„è°ƒç”¨ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210509204937.png"></p><p>åœ¨æ‰§è¡Œåå°„çš„æ—¶å€™ä¼šä¼˜å…ˆä½¿ç”¨<code>NativeMethodAccessor</code> ç›´æ¥è°ƒç”¨ Native æ–¹æ³•ï¼Œä½†æ˜¯è°ƒç”¨ Native æ–¹æ³•è¦åˆ‡æ¢æˆ C++ æ‰§è¡Œæ–¹æ³•ï¼Œè¿™ä¸ªæˆæœ¬æ˜¯å¤§äºä¸€èˆ¬çš„æ–¹æ³•è°ƒç”¨ã€‚é‚£æˆ‘ä»¬ç”Ÿæˆä»£ç†æ¯æ¬¡åå°„è°ƒç”¨æˆ‘ä»¬å°±å»è°ƒç”¨æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±å¯ä»¥æ›´å¿«äº†å‘¢ï¼Ÿè¿™æ ·åªæ˜¯æ–¹æ³•è°ƒç”¨å˜å¿«äº†ï¼Œä½†æ˜¯ç”Ÿæˆä»£ç†å¯¹è±¡æ˜¯å¾ˆæ…¢çš„ï¼Œé‚£ç”Ÿæˆä»£ç†å¯¹è±¡çš„æ—¶é—´æˆæœ¬åˆæ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿæ‰€ä»¥ JVM é‡‡ç”¨äº†æŠ˜ä¸­çš„åŠæ³•ï¼Œ<code>è®¾ç½®é˜ˆå€¼</code>ï¼Œå½“è°ƒç”¨æ¬¡æ•°è¶…è¿‡<code>é»˜è®¤çš„15</code>æ¬¡JVM ä¸ºå…¶ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç”± Native æ–¹æ³•è°ƒç”¨åˆ‡æ¢ä¸º Delegate æ–¹æ³•è°ƒç”¨ï¼Œæ¥æé«˜æ•´ä½“çš„æ‰§è¡Œæ€§èƒ½ã€‚ä»¥ä¸ºä¸€åˆ‡éƒ½å¾ˆç¾å¥½äº†ï¼Œçªç„¶æˆ‘ä»¬çš„ä»£ç å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¸€èµ·çœ‹çœ‹å¼‚å¸¸æ˜¯æ€ä¹ˆJVMå¼‚å¸¸æ˜¯æ€ä¹ˆå¤„ç†å§ã€‚</p><h2 id="Java-å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#Java-å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="Java å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>Java å¼‚å¸¸å¤„ç†æœºåˆ¶</h2><h3 id="Java-å¼‚å¸¸"><a href="#Java-å¼‚å¸¸" class="headerlink" title="Java å¼‚å¸¸"></a>Java å¼‚å¸¸</h3><p>å¼‚å¸¸å¤„ç†ä¸­ä¸»è¦ç»„æˆè¦ç´ ï¼šæŠ›å‡ºå¼‚å¸¸å’Œæ•è·å¼‚å¸¸ã€‚ç”±äº Java ä¸­æ²¡æœ‰ gotoï¼Œæ‰€ä»¥è¿™ä¸¤å¤§è¦ç´ é…ç½®å…±åŒå®ç°ç¨‹åºæµç¨‹çš„éæ­£å¸¸è½¬ç§»ã€‚æŠ›å‡ºå¼‚å¸¸å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>æ˜¾å¼æŠ›å‡º</code>å¦å¤–ä¸€ç§æ˜¯å¦å¤–ä¸€ç§æ˜¯<code>éšå¼æŠ›å‡º</code>ã€‚æ˜¾å¼æŠ›å‡ºæŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨ç¨‹åºä¸­ä½¿ç”¨ new threw çš„æ–¹å¼æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œéšå¼æŠ›å‡ºåˆ™æ˜¯ Java è™šæ‹Ÿæœºæ‰§è¡Œåˆ°å¼‚å¸¸æƒ…å†µï¼Œæ— æ³•ç»§ç»­æŠ›å‡ºçš„å¼‚å¸¸ã€‚ä¾‹å¦‚æ•°ç»„è¶Šç•Œï¼Œé™¤0ç­‰ã€‚å¼‚å¸¸æ“ä½œé€šå¸¸åˆ†æˆä¸‹é¢ä¸‰å—ï¼š</p><ul><li>try ä»£ç å—ï¼šç”¨æ¥æ ‡è®°éœ€è¦å¼‚å¸¸ç›‘æµ‹çš„ä»£ç ã€‚</li><li>catch ä»£ç å—ï¼šåœ¨å¼‚å¸¸å‘ç”Ÿåæ‰§è¡Œçš„åç»­é€»è¾‘å—ã€‚åœ¨ Java ä¸­ä¸€ä¸ª try å—åé¢å¯ä»¥è·Ÿå¤šä¸ª catch ä»£ç å—ï¼Œç”¨æ¥æ•æ‰ä¸åŒçš„å¼‚å¸¸ï¼Œå‘ç”Ÿå¼‚å¸¸å JVM ä¼šä»ä¸Šåˆ°ä¸‹ä¾æ¬¡åŒ¹é…å¼‚å¸¸å¤„ç†ä»£ç ï¼Œå› æ­¤å‰é¢çš„ catch å—ä¸èƒ½è¦†ç›–åé¢çš„ catch å—ã€‚</li><li>finally ä»£ç å—ï¼šåœ¨ try å’Œ catch åé¢çš„ä»£ç å—ï¼Œç”¨æ¥å£°æ˜ä¸€æ®µå¿…ä¼šæ‰§è¡Œçš„é€»è¾‘ï¼Œå®ƒçš„è®¾è®¡åˆè¡·æ˜¯ç”¨æ¥é¿å…å› ä¸ºå¼‚å¸¸è·³è¿‡çš„æ²¡æœ‰æ‰§è¡Œçš„ä¸€äº›æ¸…ç†é€»è¾‘ã€‚</li></ul><p>æ‰€ä»¥æ­£å¸¸æµç¨‹ä¸‹æ¥ï¼Œå¦‚æœ try ä¸­çš„å¼‚å¸¸æ²¡æœ‰è¢«æ•è·ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸å¹¶æ‰§è¡Œ finally ã€‚å¦‚æœæ­£å¸¸æµç¨‹ä¸‹æ¥ï¼Œtry ä¸­æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œè€Œæ˜¯ finally ä»£ç ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œé‚£ finally åªèƒ½ä¸­æ–­å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="Java-è™šæ‹Ÿæœºæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ"><a href="#Java-è™šæ‹Ÿæœºæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ" class="headerlink" title="Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ"></a>Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</h3><p>åœ¨ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ä¸­ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½ä¼šå¸¦æœ‰ä¸€ä¸ªå¼‚å¸¸è¡¨ï¼Œå¼‚å¸¸è¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ä»£è¡¨ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œå¹¶ä¸”ç”± from æŒ‡é’ˆã€to æŒ‡é’ˆã€target æ‰§æ”¿ä»¥åŠæ‰€æ•è·çš„ç±»å‹ã€‚æŒ‡é’ˆçš„å€¼æ˜¯<code>å­—èŠ‚ç ç´¢å¼•</code>ï¼ˆbytecode indexï¼Œbciï¼‰ï¼Œå·²ç»å®šä½å­—èŠ‚ç ã€‚å…¶ä¸­ from æŒ‡é’ˆå’Œ to æŒ‡é’ˆæ ‡å¿—äº†è¯¥å¼‚å¸¸å¤„ç†å™¨çš„ç›‘æ§èŒƒå›´ï¼Œä¾‹å¦‚ try ä»£ç æ‰€è¦†ç›–çš„èŒƒå›´ã€‚target æŒ‡é’ˆåˆ™æŒ‡å‘å¼‚å¸¸å¤„ç†å™¨çš„èµ·å§‹ä½ç½®ï¼Œä¾‹å¦‚ catch ä»£ç å—çš„èµ·å§‹ä½ç½®ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-keyword">String</span>[] args) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&quot;test&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e) &#123;<br>        e.printStackTrace();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;finally!&quot;</span>);<br>    &#125;<br>&#125;<br><br>java codeï½ï½ï½<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-keyword">void</span> main(java.lang.<span class="hljs-keyword">String</span>[]);<br>    descriptor: ([Ljava/lang/<span class="hljs-keyword">String</span>;)V<br>    flags: ACC_PUBLIC, ACC_STATIC<br>    Code:<br>      stack=<span class="hljs-number">3</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">1</span><br>         <span class="hljs-number">0</span>: <span class="hljs-keyword">new</span>           <span class="hljs-comment">#2                  // class java/lang/RuntimeException</span><br>         <span class="hljs-number">3</span>: dup<br>         <span class="hljs-number">4</span>: ldc           <span class="hljs-comment">#3                  // String test</span><br>         <span class="hljs-number">6</span>: invokespecial <span class="hljs-comment">#4                  // Method java/lang/RuntimeException.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span><br>         <span class="hljs-number">9</span>: athrow<br>        <span class="hljs-number">10</span>: astore_1<br>        <span class="hljs-number">11</span>: aload_1<br>        <span class="hljs-number">12</span>: invokevirtual <span class="hljs-comment">#6                  // Method java/lang/Exception.printStackTrace:()V</span><br>        <span class="hljs-number">15</span>: getstatic     <span class="hljs-comment">#7                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br>        <span class="hljs-number">18</span>: ldc           <span class="hljs-comment">#8                  // String finally!</span><br>        <span class="hljs-number">20</span>: invokevirtual <span class="hljs-comment">#9                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br>        <span class="hljs-number">23</span>: <span class="hljs-keyword">goto</span>          <span class="hljs-number">37</span><br>        <span class="hljs-number">26</span>: astore_2<br>        <span class="hljs-number">27</span>: getstatic     <span class="hljs-comment">#7                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br>        <span class="hljs-number">30</span>: ldc           <span class="hljs-comment">#8                  // String finally!</span><br>        <span class="hljs-number">32</span>: invokevirtual <span class="hljs-comment">#9                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br>        <span class="hljs-number">35</span>: aload_2<br>        <span class="hljs-number">36</span>: athrow<br>        <span class="hljs-number">37</span>: <span class="hljs-keyword">return</span><br>      <span class="hljs-built_in">Exception</span> table:<br>         <span class="hljs-keyword">from</span>    to  target type<br>             <span class="hljs-number">0</span>    <span class="hljs-number">10</span>    <span class="hljs-number">10</span>   <span class="hljs-class"><span class="hljs-keyword">Class</span> <span class="hljs-title">java</span>/<span class="hljs-title">lang</span>/<span class="hljs-title">Exception</span></span><br><span class="hljs-class">             0    15    26   <span class="hljs-title">any</span></span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„<code>Exception table</code>å°±æ˜¯å¼‚å¸¸è¡¨ï¼Œå¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ä¼šä»å¼‚å¸¸è¡¨ä¸­æ‹›å½“å‰ä½ç½®æ˜¯åœ¨é‚£ä¸ªå¼‚å¸¸çš„è¿”å›ï¼Œå¦‚æœåŒ¹é…åˆ°å¤šä¸ªåˆ™ä»ä¸Šåˆ°ä¸‹ä¸€ä¸ªä¸ªåŒ¹é…ï¼Œå¹¶è·³è½¬åˆ°å¯¹åº”çš„ target çš„ä½ç½®å¾€ä¸‹æ‰§è¡Œï¼Œå‰é¢æåˆ°äº† target çš„ä½ç½®æ˜¯ catch å—ï¼ˆå¼‚å¸¸å¤„ç†å™¨ï¼‰å¼€å§‹çš„ä½ç½®ã€‚åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>0 15 26 any</code> çš„å¼‚å¸¸è®°å½•ã€‚çœ‹åˆ°è¿™ä¸ªæˆ‘ä»¬å¯èƒ½ä¼šç–‘æƒ‘ï¼Œæ–¹æ³•ä¸­æ˜æ˜åªæœ‰ä¸€ä¸ªtry catch å—ï¼Œä¸ºä»€ä¹ˆå¼‚å¸¸è¡¨ä¸­ä¼šæœ‰ä¸¤æ¡è®°å½•ï¼Œè€Œä¸”æœ€åä¸€ä¸ªå¼‚å¸¸ç±»å‹æ˜¯ anyã€‚å…¶å®è¿™é‡Œçš„è®°å½•çš„æ˜¯ finallyå—ï¼Œä»target å­—èŠ‚ç å¯¹æ•ˆåº”çš„ä»£è¡¨æ‰§è¡Œçš„å¼€å§‹ä½ç½®ä¸éš¾å‘ç°è¿™æ˜¯ finlly å—çš„ä½ç½®ã€‚</p><p>ä»ä¸Šé¢çš„å­—èŠ‚ç è¿˜èƒ½çœ‹åˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯ finally å—çš„ä»£ç é‡å¤äº†ä¸¤æ¬¡ã€‚finally ä»£ç å—ç¼–è¯‘æ¯”è¾ƒå¤æ‚ï¼Œå½“å‰ç‰ˆæœ¬çš„åšæ³•å°±æ˜¯åœ¨åˆ†åˆ«åœ¨ try å’Œ catch çš„ä»£ç å‡ºå£æ·»åŠ ä¸€æ®µ finally çš„å†…å®¹ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210509205200.png"></p><p>é‚£å¦‚æœåœ¨ catch ä»£ç å—ä¸­è¿˜æ˜¯å‡ºç°äº†å¼‚å¸¸çš„åœºæ™¯ï¼Œå¼‚å¸¸å‘ç”Ÿçš„è¡Œæ•°è¿˜æ˜¯åœ¨ <code>0 15 26 any</code> çš„å¼‚å¸¸è®°å½•èŒƒå›´ï¼ŒåŒæ ·ä¼šåŒ¹é…åˆ° any ä¹Ÿå°±æ˜¯ finally çš„ä»£ç å—ï¼Œè¿™æ ·å°±ä¿è¯äº†ä¸ç®¡åœ¨ä»€ä¹ˆåœºæ™¯å‘ç”Ÿäº†å¼‚å¸¸éƒ½èƒ½æ‰§è¡Œ finally çš„å†…å®¹äº†ï¼Œä½†æ˜¯å¦‚æœ finally é‡Œé¢å‘ç”Ÿäº†å¼‚å¸¸å‘¢ï¼Ÿé‚£å°±æ²¡æœ‰åŠæ³•äº†ã€‚finally ä¼šä¸­æ­¢ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä»å­—èŠ‚ç åˆ†æçš„è§’åº¦ä¹Ÿç¬¦åˆæˆ‘ä»¬å‰é¢çš„ç»“è®ºã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¥ç€ä¸Šä¸€ç¯‡çš„ Java å­—èŠ‚ç æŠ€æœ¯ï¼Œè¿™ä¸€å°èŠ‚æˆ‘ä»¬é€šè¿‡è¿ç”¨å­—èŠ‚ç æŠ€æœ¯ï¼Œåˆ†ææ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»¥åŠæ–¹æ³•çš„é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®šã€‚ä»¥åŠä»ç®—æ³•å±‚é¢æ¢ç´¢äº†åŠ¨æ€ç»‘å®šçš„å®ç°åŸç†ä¹Ÿå°±æ˜¯æ–¹æ³•è¡¨ï¼Œä»¥åŠæ–¹æ³•è¡¨çš„ä¼˜åŒ–æ–¹æ¡ˆå†…è”ç¼“å­˜ã€‚å½“ç„¶é™¤äº†æ­£å¸¸çš„è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨åå°„çš„æ–¹å¼å»è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸€å°èŠ‚è¿˜é€šè¿‡æºç åˆ†æçš„æ–¹å¼æ·±å…¥äº†åå°„çš„å®ç°ç»†èŠ‚ã€‚æœ€åæˆ‘ä»¬ä¸€èµ·çœ‹äº†å¼‚å¸¸è¿™ä¸ªè®©ç¨‹åºå‘˜å–œå¿§å‚åŠçš„æœºåˆ¶ï¼Œé€šè¿‡åˆ›å»ºå¼‚å¸¸è¡¨æ¥å¯¹å¼‚å¸¸çš„æ‰§è¡Œè·¯å¾„è¿›è¡Œç´¢å¼•ï¼Œæ¥ä¿è¯ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚æˆ‘å‘ç°åœ¨æ–¹æ³•è¿™å—JVM å¾ˆå–œæ¬¢ç”¨â€è¡¨â€å»è§£å†³ä¸€äº›é—®é¢˜, æ–¹æ³•è¡¨ï¼Œå¼‚å¸¸è¡¨â€¦</p><p>æ˜¨å¤©å’Œä¸€ä¸ªæœ‹å‹èŠå¤©ï¼ŒèŠåˆ°æ‰€æœ‰ä¸äº†è§£çš„ä¸œè¥¿éƒ½ä¼šè‡ªå¸¦ä¸€å±‚ç¥ç§˜æ„Ÿï¼Œä½†æ˜¯æˆ‘ä»¬çœŸæ­£å»äº†è§£å®ƒä¹‹åä¼šå‘ç°å…¶å®ä¹Ÿå°±é‚£æ ·ï¼Œéƒ½æ˜¯äººèƒ½æƒ³å‡ºæ¥çš„ç‚¹å­ã€‚çœŸæ­£è¦åšçš„æ˜¯ç§¯ç´¯ï¼ŒæŒæ¡å‘ä¸Šçš„åŠæ³•ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½è§æ‹›æ‹†æ‹›å¹¶åˆ›é€ å±äºæˆ‘ä»¬çš„æœªæ¥ã€‚</p><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li>æå®¢æ—¶é—´ä¸“æ ã€Šæ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœºã€‹JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸Šï¼‰</li><li>æå®¢æ—¶é—´ä¸“æ ã€Šæ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœºã€‹JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸‹ï¼‰</li><li>æå®¢æ—¶é—´ä¸“æ ã€Šæ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœºã€‹JVMæ˜¯å¦‚ä½•å®ç°åå°„çš„ï¼Ÿ</li><li>æå®¢æ—¶é—´ä¸“æ ã€Šæ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœºã€‹JVMæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</li></ul>]]></content>
    
    
    <categories>
      
      <category>Javaè™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>JavaçŸ¥è¯†ç»“æ„æ¢³ç†</tag>
      
      <tag>å­¦ä¹ æ€»ç»“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM åŸºç¡€ â€” Java å­—èŠ‚ç </title>
    <link href="/2021/05/07/java-bytecode/"/>
    <url>/2021/05/07/java-bytecode/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬é€šå¸¸è¡¨è¿°çš„ JVM é€šå¸¸æœ‰ä¸‰ç§æ„æ€ï¼ŒJVM æ˜¯ Java virtual machine å³ java è™šæ‹Ÿæœºçš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€æŒ‡çš„ JVMã€‚JVMè¿˜æ˜¯ä¸€ç§ç”¨äºè®¡ç®—è®¾å¤‡çš„è§„èŒƒï¼Œå®ƒæ˜¯ä¸€ä¸ªè™šæ„å‡ºæ¥çš„è®¡ç®—æœºï¼Œæ˜¯é€šè¿‡åœ¨å®é™…çš„è®¡ç®—æœºä¸Šä»¿çœŸæ¨¡æ‹Ÿå„ç§è®¡ç®—æœºåŠŸèƒ½æ¥å®ç°çš„ã€‚å› æ­¤ JVM ä¹Ÿæ˜¯å›¾çµå®Œå¤‡çš„ã€‚å½“ç„¶ JVM è¿˜å¯ä»¥è¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿæœºçš„å®ä¾‹ã€‚Java ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§å°±æ˜¯å’Œå¹³å°æ— å…³ï¼Œè€Œ JVM æ˜¯å®ç°è¿™ä¸€ç‚¹çš„å…³é”®ã€‚JVM åº•å±‚ä½¿ç”¨ C è¿›è¡Œç¼–å†™ï¼Œåªè¦å¹³å°èƒ½æ‰§è¡Œ C è¯­è¨€ï¼Œè¿™ä¹Ÿå°±èƒ½å¯åŠ¨ JVM è¿è¡Œ Java ç¨‹åºã€‚JVM é€šè¿‡ç¼–è¯‘ Java è¯­è¨€ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œå­—èŠ‚ç æ–‡ä»¶åœ¨é€šè¿‡ JVM è¿›è¡Œè§£é‡Šæ‰§è¡Œã€‚å› æ­¤åªè¦è¿è¡Œåœ¨ä¸åŒçš„å¹³å°ä¸Šçš„JVM èƒ½æ‹¿åˆ°å­—èŠ‚ç æ–‡ä»¶ï¼Œå°±èƒ½è§£é‡Šæ‰§è¡Œå‡ºç›¸åŒçš„ç»“æœã€‚è¿™å°±æ˜¯ Java å¯ä»¥ â€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„æ‰§è¡Œâ€ çš„åŸå› ã€‚ </p><p>å½“ç„¶å¹¶ä¸æ˜¯Java è¯­è¨€æ˜¯è·¨å¹³å°çš„è¯­è¨€ï¼Œæ‹¿ C++ ä¸¾ä¸ªä¾‹å­ï¼ŒC++ ä¹Ÿæ˜¯ä¸€é—¨è·¨å¹³å°çš„è¯­è¨€ï¼Œä½†æ˜¯å’Œ Java è¯­è¨€ä¸åŒçš„æ˜¯ï¼ŒC++ éœ€è¦åˆ°ä¸åŒçš„å¹³å°ç”Ÿæˆä¸åŒçš„æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æºç è·¨å¹³å°ï¼Œè€Œ Java æ˜¯äºŒè¿›åˆ¶è·¨å¹³å°ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210507003029.png"></p><h2 id="Java-å­—èŠ‚ç æŠ€æœ¯"><a href="#Java-å­—èŠ‚ç æŠ€æœ¯" class="headerlink" title="Java å­—èŠ‚ç æŠ€æœ¯"></a>Java å­—èŠ‚ç æŠ€æœ¯</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Java ä»£ç é€šè¿‡ç¼–è¯‘ç”Ÿæˆ Java å­—èŠ‚ç å³ .class æ–‡ä»¶ï¼Œä¸åŒçš„ JVM é€šè¿‡æ‰§è¡Œ .class æ–‡ä»¶å®ç°è·¨å¹³å°ã€‚Java bytecode ç”±ä½†å­—èŠ‚ ï¼ˆbyteï¼‰çš„æŒ‡ä»¤ç»„æˆï¼Œç†è®ºä¸Šæœ€å¤šæ”¯æŒ 256 ä¸ªæ“ä½œç ï¼ˆopencodeï¼‰ã€‚å®é™…ä¸Š Java åªç”¨äº† 200 å·¦å³çš„æ“ä½œç ï¼Œè¿˜æœ‰ä¸€äº›æ“ä½œç åˆ™ä¿ç•™ç»™è°ƒè¯•æ“ä½œã€‚æ“ä½œç ï¼Œ ä¸‹é¢ç§°ä¸º æŒ‡ä»¤ , ä¸»è¦ç”± ç±»å‹å‰ç¼€ å’Œ æ“ä½œåç§° ä¸¤éƒ¨åˆ†ç»„æˆã€‚ </p><blockquote><p>ä¾‹å¦‚ï¼Œâ€™ i â€˜ å‰ç¼€ä»£è¡¨ â€˜ integer â€™ï¼Œæ‰€ä»¥ï¼Œâ€™ iadd â€˜ å¾ˆå®¹æ˜“ç†è§£, è¡¨ç¤ºå¯¹æ•´æ•°æ‰§è¡ŒåŠ æ³•è¿ç®—ã€‚</p></blockquote><p>æ ¹æ®æŒ‡ä»¤æ€§è´¨ï¼Œä¸»è¦åˆ†ä¸º 4 ä¸ªå¤§ç±»ï¼š</p><ol><li>æ ˆæ“ä½œæŒ‡ä»¤ï¼Œ åŒ…æ‹¬ä¸å±€éƒ¨å˜é‡äº¤äº’çš„æŒ‡ä»¤ã€‚</li><li>ç¨‹åºæµç¨‹æ§åˆ¶æŒ‡ä»¤ã€‚</li><li>å¯¹è±¡æ“ä½œæŒ‡ä»¤ï¼ŒåŒ…æ‹¬æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ã€‚</li><li>ç®—æœ¯è¿ç®—ä»¥åŠç±»å‹è½¬æ¢æŒ‡ä»¤ã€‚</li></ol><h3 id="è·å–å­—èŠ‚ç "><a href="#è·å–å­—èŠ‚ç " class="headerlink" title="è·å–å­—èŠ‚ç "></a>è·å–å­—èŠ‚ç </h3><p>å¯ä»¥ä½¿ç”¨ javap å‘½ä»¤æ¥è·å– class æ–‡ä»¶ä¸­çš„å­—èŠ‚ç ï¼Œ javap æ˜¯ jdk ä¸­å†…ç½®çš„ç”¨äºåç¼–è¯‘å­—èŠ‚ç çš„å·¥å…·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloByteCode</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        HelloByteCode obj = <span class="hljs-keyword">new</span> HelloByteCode();<br>        System.out.println(<span class="hljs-string">&quot;hello&quot;</span>);<br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><p>ç°ä½¿ç”¨ javac å‘½ä»¤ç¼–è¯‘å‡º .classï¼Œåœ¨ä½¿ç”¨ <code>javap -c</code> å‘½ä»¤ç¼–è¯‘å¾—åˆ°å­—èŠ‚ç æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">daiwei@daiweideMacBook-Pro <span class="hljs-built_in">test</span> % javap -c HelloByteCode.class<br>Compiled from <span class="hljs-string">&quot;HelloByteCode.java&quot;</span><br>public class HelloByteCode &#123;<br>  public HelloByteCode();<br>    Code:<br>       0: aload_0<br>       1: invokespecial <span class="hljs-comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br>       4: <span class="hljs-built_in">return</span><br><br>  public static void main(java.lang.String[]);<br>    Code:<br>       0: new           <span class="hljs-comment">#2                  // class HelloByteCode</span><br>       3: dup<br>       4: invokespecial <span class="hljs-comment">#3                  // Method &quot;&lt;init&gt;&quot;:()V</span><br>       7: astore_1<br>       8: getstatic     <span class="hljs-comment">#4                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br>      11: ldc           <span class="hljs-comment">#5                  // String hello</span><br>      13: invokevirtual <span class="hljs-comment">#6                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br>      16: <span class="hljs-built_in">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢æ‹‰å‡º java çš„å­—èŠ‚ç æ¸…å•ä¹‹åï¼Œä¸‹é¢å¯¹å…¶è¿›è¡Œç®€å•çš„è§£è¯»</p><h3 id="è§£æå­—èŠ‚ç æ¸…å•"><a href="#è§£æå­—èŠ‚ç æ¸…å•" class="headerlink" title="è§£æå­—èŠ‚ç æ¸…å•"></a>è§£æå­—èŠ‚ç æ¸…å•</h3><p>åœ¨ä¸Šé¢çš„è¾“å‡ºä¿¡æ¯ä¸­ï¼Œç¬¬äºŒè¡Œä¹Ÿå°±æ˜¯æ‰“å°å‡ºæ¥çš„å­—èŠ‚ç çš„ç¬¬ä¸€è¡Œ<code>Compiled from &quot;HelloByteCode.java&quot;</code>è¡¨ç¤ºæˆ‘ä»¬æ˜¯ä» HelloByteCodeè¿™ä¸ªç±»åç¼–è¯‘è€Œæ¥çš„å­—èŠ‚ç æ–‡ä»¶ã€‚4ï½8 è¡Œæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ€»æ‰€å‘¨çŸ¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ä¸ç¼–å†™æ„é€ å‡½æ•°ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªå°±æ˜¯é»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚è€Œè¿™ä¸ªæ„é€ æ–¹æ³•é‡Œä¹Ÿåªæœ‰ä¸€æ¡æŒ‡ä»¤å°±æ˜¯ <code>invokespecial</code> è¿™ä¸ªæ˜¯è°ƒç”¨çˆ¶ç±»Object å¯¹è±¡çš„æ„é€ æ–¹æ³•å³ <code>super()</code> æ–¹æ³•ã€‚</p><p>å¦‚æœæƒ³è¦çœ‹åˆ°æ›´å¤šçš„ä¿¡æ¯åˆ™éœ€è¦ä½¿ç”¨<code>javap -c -verbose</code> å‘½ä»¤è¾“å‡ºæ›´å¤šä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs bash">daiwei@daiweideMacBook-Pro <span class="hljs-built_in">test</span> % javap -c -verbose HelloByteCode.class<br>Classfile /Users/daiwei/study/java-course/JVM/<span class="hljs-built_in">test</span>/HelloByteCode.class<br>  Last modified 2021-1-7; size 442 bytes<br>  MD5 checksum 8e2a795fb147ef48ba63f55886005f32<br>  Compiled from <span class="hljs-string">&quot;HelloByteCode.java&quot;</span><br>public class HelloByteCode<br>  minor version: 0<br>  major version: 52<br>  flags: ACC_PUBLIC, ACC_SUPER<br>Constant pool:<br>   <span class="hljs-comment">#1 = Methodref          #7.#16         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br>   <span class="hljs-comment">#2 = Class              #17            // HelloByteCode</span><br>   <span class="hljs-comment">#3 = Methodref          #2.#16         // HelloByteCode.&quot;&lt;init&gt;&quot;:()V</span><br>   <span class="hljs-comment">#4 = Fieldref           #18.#19        // java/lang/System.out:Ljava/io/PrintStream;</span><br>   <span class="hljs-comment">#5 = String             #20            // hello</span><br>   <span class="hljs-comment">#6 = Methodref          #21.#22        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br>   <span class="hljs-comment">#7 = Class              #23            // java/lang/Object</span><br>   <span class="hljs-comment">#8 = Utf8               &lt;init&gt;</span><br>   <span class="hljs-comment">#9 = Utf8               ()V</span><br>  <span class="hljs-comment">#10 = Utf8               Code</span><br>  <span class="hljs-comment">#11 = Utf8               LineNumberTable</span><br>  <span class="hljs-comment">#12 = Utf8               main</span><br>  <span class="hljs-comment">#13 = Utf8               ([Ljava/lang/String;)V</span><br>  <span class="hljs-comment">#14 = Utf8               SourceFile</span><br>  <span class="hljs-comment">#15 = Utf8               HelloByteCode.java</span><br>  <span class="hljs-comment">#16 = NameAndType        #8:#9          // &quot;&lt;init&gt;&quot;:()V</span><br>  <span class="hljs-comment">#17 = Utf8               HelloByteCode</span><br>  <span class="hljs-comment">#18 = Class              #24            // java/lang/System</span><br>  <span class="hljs-comment">#19 = NameAndType        #25:#26        // out:Ljava/io/PrintStream;</span><br>  <span class="hljs-comment">#20 = Utf8               hello</span><br>  <span class="hljs-comment">#21 = Class              #27            // java/io/PrintStream</span><br>  <span class="hljs-comment">#22 = NameAndType        #28:#29        // println:(Ljava/lang/String;)V</span><br>  <span class="hljs-comment">#23 = Utf8               java/lang/Object</span><br>  <span class="hljs-comment">#24 = Utf8               java/lang/System</span><br>  <span class="hljs-comment">#25 = Utf8               out</span><br>  <span class="hljs-comment">#26 = Utf8               Ljava/io/PrintStream;</span><br>  <span class="hljs-comment">#27 = Utf8               java/io/PrintStream</span><br>  <span class="hljs-comment">#28 = Utf8               println</span><br>  <span class="hljs-comment">#29 = Utf8               (Ljava/lang/String;)V</span><br>&#123;<br>  public HelloByteCode();<br>    descriptor: ()V<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=1, locals=1, args_size=1<br>         0: aload_0<br>         1: invokespecial <span class="hljs-comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br>         4: <span class="hljs-built_in">return</span><br>      LineNumberTable:<br>        line 1: 0<br><br>  public static void main(java.lang.String[]);<br>    descriptor: ([Ljava/lang/String;)V<br>    flags: ACC_PUBLIC, ACC_STATIC<br>    Code:<br>      stack=2, locals=2, args_size=1<br>         0: new           <span class="hljs-comment">#2                  // class HelloByteCode</span><br>         3: dup<br>         4: invokespecial <span class="hljs-comment">#3                  // Method &quot;&lt;init&gt;&quot;:()V</span><br>         7: astore_1<br>         8: getstatic     <span class="hljs-comment">#4                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br>        11: ldc           <span class="hljs-comment">#5                  // String hello</span><br>        13: invokevirtual <span class="hljs-comment">#6                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br>        16: <span class="hljs-built_in">return</span><br>      LineNumberTable:<br>        line 3: 0<br>        line 4: 8<br>        line 5: 16<br>&#125;<br>SourceFile: <span class="hljs-string">&quot;HelloByteCode.java&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™æ¬¡çš„è¾“å‡ºæ¯”ä¹‹å‰ä¸€æ¬¡å¤šäº†ä¸å°‘çš„ä¿¡æ¯ï¼Œé¦–å…ˆæ˜¯ 10ï½39 è¡Œçš„å¸¸é‡æ± ä¿¡æ¯ã€‚è¿™é‡Œè®°å½•äº†ä»£ç ä¸­ç”¨åˆ°çš„å¸¸é‡ã€‚40ï½68è¡Œæ˜¯ä¹‹å‰ä»£ç éƒ¨åˆ†çš„å­—èŠ‚ç ï¼Œè¿™ä¸€æ¬¡å¤šäº†ä¸€äº›å¦‚ <code>descriptor, flags</code> çš„ä¿¡æ¯ã€‚descriptor æ˜¯æ–¹æ³•çš„æè¿°ç¬¦ï¼Œflags åˆ™æ˜¯æ–¹æ³•çš„è®¿é—®æè¿°ç¬¦ï¼Œè¿™æ˜¯ä¸ª public static æ–¹æ³•ã€‚ç¬¬45è¡Œçš„ <code>stack=1, locals=1, args_size=1</code> è¡¨ç¤ºæ–¹æ³•æ ˆçš„æ·±åº¦ä¸º1ï¼Œ æœ¬åœ°å±€éƒ¨å˜é‡è¡¨å¤§å°ä¸º1 ï¼Œæ–¹æ³•çš„å…¥å‚ä¸º1ã€‚è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„åœ°æ–¹ï¼Œå°±æ˜¯æ— å‚æ„é€ çš„ args_size ä¸ä¸º0 è€Œæ˜¯ 1 ï¼Œè¿™æ˜¯å› ä¸ºå¯¹äºæ„é€ æ–¹æ³•éœ€è¦æœ‰ä¸€ä¸ªå¼•ç”¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯ this çš„å¼•ç”¨åœ°å€ï¼Œè¿™ä¸ªå¯ä»¥ç±»æ¯”åå°„é‡Œé¢<code>Method#invoke(Object obj, Object... args);</code> ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«è°ƒç”¨å¯¹è±¡ä¸€æ ·ã€‚</p><h3 id="çº¿ç¨‹æ ˆå’Œå­—èŠ‚ç æ‰§è¡Œæ¨¡å‹"><a href="#çº¿ç¨‹æ ˆå’Œå­—èŠ‚ç æ‰§è¡Œæ¨¡å‹" class="headerlink" title="çº¿ç¨‹æ ˆå’Œå­—èŠ‚ç æ‰§è¡Œæ¨¡å‹"></a>çº¿ç¨‹æ ˆå’Œå­—èŠ‚ç æ‰§è¡Œæ¨¡å‹</h3><p>JVM æ˜¯åŸºäºæ ˆçš„è®¡ç®—æœºæ¨¡å‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„çº¿ç¨‹æ ˆï¼ˆJVM stackï¼‰å’Œç”¨äºå­˜å‚¨çš„<code>æ ˆå¸§</code>ï¼ˆFrameï¼‰ï¼Œæ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•JVMéƒ½ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§ä¸­åŒ…æ‹¬<code>æ“ä½œæ•°æ ˆ</code>ï¼Œ<code>å±€éƒ¨å˜é‡æ•°ç»„</code>å’Œä¸€ä¸ª <code>class å¼•ç”¨</code>æ„æˆï¼Œclass å¼•ç”¨æŒ‡å‘å½“å‰æ–¹æ³•åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å¯¹åº”çš„classã€‚</p><p>â€‹       <img src="https://gitee.com/realDaiwei/img/raw/master/20210507003351.png"></p><p><code>å±€éƒ¨å˜é‡æ•°ç»„</code> ä¹Ÿæˆä¸º <code>å±€éƒ¨æ–¹æ³•è¡¨</code>ï¼ˆLocalVariableTableï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬æ–¹æ³•çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚å±€éƒ¨å˜é‡æ•°ç»„é•¿åº¦åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šã€‚å’Œå±€éƒ¨å˜é‡å’Œæ–¹æ³•å½¢å‚æœ‰å…³ï¼Œä½†æ˜¯å…·ä½“é•¿åº¦è¿˜è¦çœ‹å…·ä½“æ¯ä¸ªå­—æ®µå ç”¨çš„é•¿åº¦ã€‚<code>æ“ä½œæ•°æ ˆ</code>ï¼ˆOperand Stackï¼‰æ˜¯ä¸€ä¸ª LIFO çš„ç»“æ„æ ˆï¼Œé€šè¿‡äºå‹å…¥å¼¹å‡ºè¿›è¡Œæ•°æ®æ“ä½œï¼Œå…¶å¤§å°åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚</p><p>ä¸€äº›æ“ä½œç /æŒ‡ä»¤å¯ä»¥å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œè¿˜æœ‰ä¸€äº›æ“ä½œç /æŒ‡ä»¤ä»æ“ä½œæ•°æ ˆè·å–æ“ä½œæ•°ï¼Œå¹¶è¿›è¡Œè®¡ç®—ï¼Œç„¶åå†å‹å…¥æ“ä½œæ•°æ ˆã€‚æ“ä½œæ•°æ ˆè¿˜ç”¨äºæ¥å—è°ƒç”¨å…¶ä»–æ–¹æ³•çš„è¿”å›å€¼ã€‚</p><h3 id="æ–¹æ³•ä½“ä¸­çš„å­—èŠ‚ç è§£æ"><a href="#æ–¹æ³•ä½“ä¸­çš„å­—èŠ‚ç è§£æ" class="headerlink" title="æ–¹æ³•ä½“ä¸­çš„å­—èŠ‚ç è§£æ"></a>æ–¹æ³•ä½“ä¸­çš„å­—èŠ‚ç è§£æ</h3><p>åœ¨å‰é¢çš„å‡ ä¸ªä¾‹å­å½“ä¸­ï¼Œå­—èŠ‚ç çœ‹èµ·æ¥é—®é¢˜éƒ½ä¸å¤§ï¼Œä½†æ˜¯çœ‹æ–¹æ³•ä½“ä¸­çš„å­—èŠ‚ç çš„ç¼–å·æœ‰ç‚¹çœ‹ä¸æ‡‚ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä¸€äº›å­—èŠ‚ç </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">0:</span> <span class="hljs-string">new</span>           <span class="hljs-comment">#2                  // class HelloByteCode</span><br><span class="hljs-attr">3:</span> <span class="hljs-string">dup</span><br><span class="hljs-attr">4:</span> <span class="hljs-string">invokespecial</span> <span class="hljs-comment">#3                  // Method &quot;&lt;init&gt;&quot;:()V</span><br><span class="hljs-attr">7:</span> <span class="hljs-string">astore_1</span><br><span class="hljs-attr">8:</span> <span class="hljs-string">return</span><br></code></pre></td></tr></table></figure><p>å‰é¢çš„ä¸€æ’æ•°å­—æ˜¯<code>æŒ‡ä»¤é›†æ•°ç»„ä¸­çš„ç´¢å¼•</code> new æ“ä½œå ç”¨ä¸€ä¸ªæ§½ä½ï¼Œå¹¶ä¸” new æŒ‡ä»¤éœ€è¦æ¶ˆè€—ä¸¤ä¸ªæ“ä½œæ•°ï¼Œæ‰€ä»¥ dup æŒ‡ä»¤æ˜¯ä»<code>3</code>å¼€å§‹çš„ï¼Œ<code>dup</code> æŒ‡ä»¤ä¸éœ€è¦æ“ä½œæ•°ï¼Œæ‰€ä»¥åªå ä¸€ä¸ªæ§½ä½ã€‚ä½äº<code>4</code>å·æ§½ä½ä¸­çš„ <code>invokespecial</code> æŒ‡ä»¤åŒæ ·éœ€è¦æ¶ˆè€—ä¸¤ä¸ªæ“ä½œæ•°ï¼Œæ‰€ä»¥ astore_1 ä»7å·æ§½ä½å¼€å§‹ã€‚<code>astore_1</code>æ„æ€æ˜¯å°†æ ˆé¡¶å…ƒç´ å­˜å…¥å±€éƒ¨å˜é‡è¡¨1å·æ§½ä½ï¼Œä¸éœ€è¦æ“ä½œæ•°ï¼Œæ‰€ä»¥ <code>return</code> ä½äº<code>8</code>å·æ§½ä½ã€‚<img src="https://gitee.com/realDaiwei/img/raw/master/20210507003454.png"></p><p>é€šè¿‡æ“ä½œç /æŒ‡ä»¤å¯¹ç…§è¡¨å¹¶æ¢ç®—åå…­è¿›åˆ¶ï¼ˆHEXï¼‰è¡¨ç¤ºå½¢å¼ä¹‹åã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210507003612.png"></p><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šè¿‡åå…­è¿›åˆ¶æ‰“å¼€.class æ–‡ä»¶æ‰€èƒ½çœ‹åˆ°çš„æ•°æ®ç‰‡æ®µäº†ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210507003708.png"></p><h3 id="å¯¹è±¡åˆå§‹åŒ–æŒ‡ä»¤"><a href="#å¯¹è±¡åˆå§‹åŒ–æŒ‡ä»¤" class="headerlink" title="å¯¹è±¡åˆå§‹åŒ–æŒ‡ä»¤"></a>å¯¹è±¡åˆå§‹åŒ–æŒ‡ä»¤</h3><p>new æ˜¯Java çš„å…³é”®å­—ï¼Œä½†æ˜¯åœ¨å­—èŠ‚ç ä¸­ï¼Œä¹Ÿæœ‰ä¸€ä¸ªæŒ‡ä»¤ new ä½†æ˜¯æ•´ä¸ª new çš„é€»è¾‘ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹çš„å­—èŠ‚ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">0: new           <span class="hljs-comment">#2                  // class HelloByteCode</span><br>3: dup<br>4: invokespecial <span class="hljs-comment">#3                  // Method &quot;&lt;init&gt;&quot;:()V</span><br></code></pre></td></tr></table></figure><p>new æŒ‡ä»¤å’Œ invokespecial æŒ‡ä»¤åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆè¿™æ®µå­—èŠ‚ç ä¸€å®šæ˜¯åœ¨å®ä¾‹ä¸€ä¸ªå¯¹è±¡ã€‚é‚£ä¸ºä»€ä¹ˆå®ä¾‹ä¸€ä¸ªå¯¹è±¡ä¸æ˜¯ä¸€ä¸ªæŒ‡ä»¤è€Œæ˜¯ä¸‰ä¸ªæŒ‡ä»¤å‘¢ï¼Ÿ</p><ul><li><code>new</code> æŒ‡ä»¤åªæ˜¯åˆ›å»ºå¯¹è±¡ï¼Œè€Œå¹¶æ²¡æœ‰è°ƒç”¨æ„é€ å‡½æ•°ã€‚</li><li><code>dup</code> å¤åˆ¶æ ˆé¡¶å…ƒç´ ã€‚è¿™é‡Œä¸ºä»€ä¹ˆè¦å¤åˆ¶æ ˆé¡¶å…ƒç´ å‘¢ï¼Ÿå› ä¸ºæ„é€ å‡½æ•°ä¸ä¼šè¿”å›å®ä¾‹å¯¹è±¡å¼•ç”¨ï¼Œæ‰€ä»¥æ²¡ç”¨dupæŒ‡ä»¤ï¼Œæ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ï¼Œåˆå§‹åŒ–ä¹‹åå°±ä¼šæœ‰é—®é¢˜ã€‚</li><li><code>invokespecial</code> å­—é¢æ„æ€ï¼Œè°ƒç”¨ç‰¹æ®Šçš„æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå°±æ˜¯è°ƒç”¨æ„é€ å‡½æ•°ã€‚</li></ul><p>å®Œæˆäº†ä¸Šé¢çš„ä»£ç åä¸€èˆ¬ä¼šæ‰§è¡Œçš„æŒ‡ä»¤ä¼šæœ‰ä¸‹é¢å‡ ç§ï¼š</p><ul><li><code>astore &#123;N&#125;</code> æˆ–è€… <code>astore_&#123;N&#125;</code> ç»™å±€éƒ¨å˜é‡èµ‹å€¼ï¼Œå…¶ä¸­{N}ä»£è¡¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„ä½ç½®ã€‚</li><li><code>putfield</code>  å°†å€¼èµ‹ç»™å®ä¾‹ã€‚</li><li><code>putstatic</code> å°†å®ä¾‹èµ‹ç»™é™æ€å­—æ®µã€‚</li></ul><p>è¿™ä¸ªæ—¶å€™å¦‚æœæ²¡æœ‰é‚£ä¸ª dup çš„å¼•ç”¨çš„è¯è¿™é‡Œå°±æ²¡æœ‰å°±æ²¡æ³•è¿›è¡Œå‡ºæ ˆèµ‹å€¼æ“ä½œã€‚</p><p>åœ¨è°ƒç”¨æ„é€ å‡½æ•°ä¹‹å‰ï¼Œè¿˜ä¼šæ‰§è¡Œä¸€ä¸ªç±»ä¼¼ <init> çš„æ–¹æ³•ã€‚ä½†æ˜¯ <clinit> å¹¶ä¸èƒ½è¢«ç›´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯ç”± <code>new</code>ï¼Œ<code>getstatic</code>ï¼Œ<code>putstatic</code> æˆ– <code>invokestatic</code> è§¦å‘ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œè®¿é—®é™æ€å­—æ®µæˆ–ä¸€äº›é™æ€æ–¹æ³•ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªç±»çš„é™æ€åˆå§‹åŒ–æ–¹æ³•ã€‚</p><h3 id="æ ˆå†…å­˜æ“ä½œæŒ‡ä»¤"><a href="#æ ˆå†…å­˜æ“ä½œæŒ‡ä»¤" class="headerlink" title="æ ˆå†…å­˜æ“ä½œæŒ‡ä»¤"></a>æ ˆå†…å­˜æ“ä½œæŒ‡ä»¤</h3><p>æœ‰å¾ˆå¤šæŒ‡ä»¤å¯ä»¥æ“ä½œæ–¹æ³•æ ˆã€‚å‹å…¥æ ˆæ•°æ®å’Œä»æ•°æ®æ ˆå¼¹å‡ºæ•°æ®ç­‰ä¸€äº›åŸºç¡€çš„æ“ä½œï¼Œæœ‰ <code>dup</code> å¤åˆ¶æ ˆé¡¶å…ƒç´ ï¼Œå’Œ <code>pop</code> å¼¹å‡ºæ ˆé¡¶å…ƒç´ çš„æŒ‡ä»¤ã€‚è¿˜æœ‰ä¸€äº›å¤æ‚ç‚¹çš„æŒ‡ä»¤ä¾‹å¦‚ï¼š</p><ul><li><code>swap</code> ï¼šäº¤æ¢ä¸¤ä¸ªæ ˆé¡¶å…ƒç´ ã€‚</li><li><code>dup_x1</code>ï¼šå¤åˆ¶æ ˆé¡¶çš„å€¼, å¹¶å°†å¤åˆ¶çš„å€¼æ’å…¥åˆ°æœ€ä¸Šé¢2ä¸ªå€¼çš„ä¸‹æ–¹ã€‚</li><li><code>dup2_x1</code>ï¼šåˆ¶æ ˆé¡¶ 1ä¸ª64ä½/æˆ–2ä¸ª32ä½çš„å€¼, å¹¶å°†å¤åˆ¶çš„å€¼æŒ‰ç…§åŸå§‹é¡ºåºï¼Œæ’å…¥åŸå§‹å€¼ä¸‹é¢ä¸€ä¸ª32ä½å€¼çš„ä¸‹æ–¹ã€‚ é…åˆä½¿ç”¨å¯ç”¨äºäº¤æ¢ä¸¤ä¸ª64ä½æ•°æ®çš„ä½ç½®ã€‚</li></ul><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210507003819.png"></p><blockquote><p>æ•°æ®ç±»å‹åˆ†ç»„ï¼ˆ1ä»£è¡¨32 ä½å…ƒç´ ï¼Œ 2ä»£è¡¨64ä½å…ƒç´ ï¼‰</p></blockquote><table><thead><tr><th>å®é™…ç±»å‹</th><th>JVM è®¡ç®—ç±»å‹</th><th>ç±»å‹åˆ†ç»„</th></tr></thead><tbody><tr><td>boolean</td><td>int</td><td>1</td></tr><tr><td>byte</td><td>int</td><td>1</td></tr><tr><td>char</td><td>int</td><td>1</td></tr><tr><td>short</td><td>int</td><td>1</td></tr><tr><td>int</td><td>int</td><td>1</td></tr><tr><td>float</td><td>float</td><td>1</td></tr><tr><td>refrence</td><td>refrence</td><td>1</td></tr><tr><td>retrunAddress</td><td>retrunAddress</td><td>1</td></tr><tr><td>long</td><td>long</td><td>2</td></tr><tr><td>double</td><td>double</td><td>2</td></tr></tbody></table><blockquote><p>âš ï¸ ç†è§£è¿™äº›å­—èŠ‚ç çš„è¯€çªåœ¨äº</p><p>ç»™å±€éƒ¨å˜é‡èµ‹å€¼æ—¶ï¼Œéœ€è¦ä½¿ç”¨ç›¸åº”çš„æŒ‡ä»¤æ¥è¿›è¡Œ <code>store</code> ï¼Œå¦‚ <code>astore_1</code>ã€ <code>store</code> ç±»çš„æŒ‡ä»¤éƒ½ä¼šåˆ é™¤æ ˆé¡¶å€¼ã€‚ ç›¸åº”çš„ load æŒ‡ä»¤åˆ™ä¼šå°†å€¼ä»å±€éƒ¨å˜é‡è¡¨å‹å…¥æ“ä½œæ•°æ ˆï¼Œä½†å¹¶ä¸ä¼šåˆ é™¤å±€éƒ¨å˜é‡ä¸­çš„å€¼ã€‚</p></blockquote><h3 id="ç®—æœ¯è¿ç®—æŒ‡ä»¤ä¸ç±»å‹è½¬æ¢æŒ‡ä»¤"><a href="#ç®—æœ¯è¿ç®—æŒ‡ä»¤ä¸ç±»å‹è½¬æ¢æŒ‡ä»¤" class="headerlink" title="ç®—æœ¯è¿ç®—æŒ‡ä»¤ä¸ç±»å‹è½¬æ¢æŒ‡ä»¤"></a>ç®—æœ¯è¿ç®—æŒ‡ä»¤ä¸ç±»å‹è½¬æ¢æŒ‡ä»¤</h3><p>Java å­—èŠ‚ç æœ‰å¾ˆå¤šçš„æŒ‡ä»¤å¯ä»¥æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚å¯¹äºæ‰€æœ‰æ•°å€¼ç±»å‹ï¼ˆ<code>int</code>, <code>long</code>, <code>double</code>, <code>float</code>ï¼‰éƒ½æœ‰å„è‡ªçš„åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–åæŒ‡ä»¤ã€‚å½“ç„¶booleanã€byteã€shortã€char ç­‰éƒ½æ˜¯å½“ int ç±»å‹å¤„ç†ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210507003904.png"></p><p>åœ¨java æ˜¯ä¸€ä¸ªå¼ºç±»å‹çš„è¯­è¨€ï¼Œå¦‚æœç±»å‹ä¸åŒ¹é…éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå¦‚æœ<code>int</code>éœ€è¦è½¬æ¢ä¸º <code>double</code> ä¼šè°ƒç”¨ i2d æŒ‡ä»¤è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p><p><img src="https://gitee.com/realDaiwei/img/raw/master/20210507003936.png"></p><p>å”¯ä¸€ä¸€ä¸ªä¸éœ€è¦å°†æ•°å€¼loadåˆ°æ“ä½œæ•°æ ˆçš„æŒ‡ä»¤æ˜¯ <code>iinc</code>ï¼Œä»–å¯ä»¥ç›´æ¥å¯¹ <code>LocalVariableTable</code> ä¸­çš„æ•°å€¼è¿›è¡Œè¿ç®—ã€‚å…¶ä»–çš„æ“ä½œå‡ä½¿ç”¨æ“ä½œæ•°æ ˆè¿›è¡Œè¿ç®—ã€‚</p><blockquote><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-7.html">æ“ä½œç å¯¹ç…§è¡¨</a></p></blockquote><h3 id="æ–¹æ³•è°ƒç”¨æŒ‡ä»¤"><a href="#æ–¹æ³•è°ƒç”¨æŒ‡ä»¤" class="headerlink" title="æ–¹æ³•è°ƒç”¨æŒ‡ä»¤"></a>æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</h3><p>åœ¨å‰é¢å·²ç»åˆ°äº† <code>invokespceial</code> è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œé‚£è°ƒç”¨å…¶ä»–ä¸åŒç±»å‹çš„æ–¹æ³•ç”¨ä»€ä¹ˆæŒ‡ä»¤å‘¢ï¼Ÿ</p><ul><li><code>invokestatic</code> è°ƒç”¨é™æ€æ–¹æ³•ï¼Œä¹Ÿæ˜¯å‡ ä¸ªè°ƒç”¨æŒ‡ä»¤å½“ä¸­æœ€å¿«çš„ã€‚</li><li><code>invokespeical</code> å¯ä»¥ç”¨æ¥è°ƒç”¨æ„é€ æ–¹æ³•ï¼ŒåŒæ—¶è¿™ä¸ªæŒ‡ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥è°ƒç”¨ <code>private</code> æ–¹æ³• å’Œå¯è§çš„ <code>super</code> ä¸­çš„æ–¹æ³•ã€‚</li><li><code>invokevirtual</code> å¯ä»¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€‚</li><li><code>invokeinterface</code> ç”¨äºè°ƒç”¨ç›®æ ‡æ¥å£æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æœç´¢ä¸€ä¸ªå®ç°è¿™ä¸ªæ¥å£çš„å¯¹è±¡ï¼Œå¹¶æ‰¾å‡ºåˆé€‚çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚</li><li><code>invokedynamic</code> jdk 1.7 æ–°åŠ å…¥çš„ä¸€ä¸ªè™šæ‹ŸæœºæŒ‡ä»¤ï¼Œå‰å››æ¡æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘åœ¨è™šæ‹Ÿæœºå†…éƒ¨æ˜¯å›ºå®šçš„ï¼Œ<code>invokedynamic</code> å®ƒå…è®¸åº”ç”¨ä»£ç æ¥ç¡®å®šå…·ä½“æ‰§è¡Œçš„æ˜¯é‚£ä¸ªæ–¹æ³•ï¼Œä»è€Œåˆ°è¾¾å¯¹åŠ¨æ€è¯­è¨€çš„æ”¯æŒã€‚Lambda è¡¨è¾¾å¼åŸºäº <code>invokedynamic</code> å®ç°ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªéƒ¨åˆ†ç®€å•ä»‹ç»äº†Java å­—èŠ‚ç ï¼Œä»å¼€ç¯‡ä»‹ç»æ€ä¹ˆæ‹‰å–ä¸€ä¸ª Java ä»£ç çš„å­—èŠ‚ç å¼€å§‹ï¼Œé€æ­¥å¤ä¹ äº†jvm æ–¹æ³•æ ˆçš„æ ˆå¸§ï¼Œä¹Ÿå°±æ˜¯ å­—èŠ‚ç çš„æ‰§è¡Œç¯å¢ƒï¼Œè¿™ä¸ªéƒ¨åˆ†ç”±ä¸€ä¸ªæ“ä½œæ•°æ ˆï¼Œä¸€ä¸ªæœ¬åœ°å±€éƒ¨å˜é‡è¡¨å’Œä¸€ä¸ªclass å¼•ç”¨æ„æˆã€‚é€šè¿‡åˆ†æä¸€äº›å¸¸è§çš„å­—èŠ‚ç ä¾‹å¦‚æ„é€ å‡½æ•°å’Œä¸€äº›ç®€å•çš„æ–¹æ³•ä½“ï¼Œç†Ÿæ‚‰äº†è§£äº†ä¸€äº›åŸºæœ¬çš„æ“ä½œç ï¼Œä¾‹å¦‚ dupã€popã€istoreã€iload ç­‰æŒ‡ä»¤ã€‚å…¶ä¸­ç†è§£çš„è¯€çªåœ¨äº ç»™å±€éƒ¨å˜é‡èµ‹å€¼æ—¶ï¼Œéœ€è¦ä½¿ç”¨ç›¸åº”çš„æŒ‡ä»¤æ¥è¿›è¡Œ <code>store</code> ï¼Œå¦‚ <code>astore_1</code>ã€ <code>store</code> ç±»çš„æŒ‡ä»¤éƒ½ä¼šåˆ é™¤æ ˆé¡¶å€¼ã€‚ ç›¸åº”çš„ load æŒ‡ä»¤åˆ™ä¼šå°†å€¼ä»å±€éƒ¨å˜é‡è¡¨å‹å…¥æ“ä½œæ•°æ ˆï¼Œä½†å¹¶ä¸ä¼šåˆ é™¤å±€éƒ¨å˜é‡ä¸­çš„å€¼ã€‚å½“ç„¶åœ¨è¿™äº›åŸºæœ¬çš„æ“ä½œæŒ‡ä»¤ä¸­è¿˜åŒ…æ‹¬ä¸€äº›ç±»å‹è½¬æ¢çš„æŒ‡ä»¤å’Œæ–¹æ³•çš„è°ƒç”¨çš„æŒ‡ä»¤ï¼Œæ–¹æ³•è°ƒç”¨åˆ°åé¢ä¼šæœ‰ä¸“é—¨æ¢³ç†ã€‚</p><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li>Java å­—èŠ‚ç æŠ€æœ¯ï¼šä¸ç§¯ç»†æµï¼Œæ— ä»¥æˆæ±Ÿæ²³ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Javaè™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>JavaçŸ¥è¯†ç»“æ„æ¢³ç†</tag>
      
      <tag>å­¦ä¹ æ€»ç»“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>leetcodes ä¹ é¢˜æ±‡æ€»</title>
    <link href="/2021/03/28/leetcodes/"/>
    <url>/2021/03/28/leetcodes/</url>
    
    <content type="html"><![CDATA[<h2 id="LeetCode-ä¹ é¢˜æ±‡æ€»"><a href="#LeetCode-ä¹ é¢˜æ±‡æ€»" class="headerlink" title="LeetCode ä¹ é¢˜æ±‡æ€»"></a>LeetCode ä¹ é¢˜æ±‡æ€»</h2><h5 id="æ•°ç»„ã€é“¾è¡¨"><a href="#æ•°ç»„ã€é“¾è¡¨" class="headerlink" title="æ•°ç»„ã€é“¾è¡¨"></a>æ•°ç»„ã€é“¾è¡¨</h5><ol><li><a href="https://leetcode-cn.com/problems/container-with-most-water/">ç››æ°´æœ€å¤šçš„å®¹å™¨</a></li><li><a href="https://leetcode-cn.com/problems/move-zeroes/">ç§»åŠ¨é›¶</a></li><li><a href="https://leetcode-cn.com/problems/climbing-stairs/">çˆ¬æ¥¼æ¢¯</a></li><li><a href="https://leetcode-cn.com/problems/two-sum/">ä¸¤æ•°ä¹‹å’Œ</a></li><li><a href="https://leetcode-cn.com/problems/3sum/">ä¸‰æ•°ä¹‹å’Œ</a></li><li><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></li><li><a href="https://leetcode-cn.com/problems/rotate-array/">æ—‹è½¬æ•°ç»„</a></li><li><a href="https://leetcode-cn.com/problems/reverse-linked-list/">åè½¬é“¾è¡¨</a></li><li><a href="https://leetcode-cn.com/problems/swap-nodes-in-pairs/">ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</a></li><li><a href="https://leetcode-cn.com/problems/linked-list-cycle/">ç¯å½¢é“¾è¡¨</a></li><li><a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/">ç¯å½¢é“¾è¡¨2</a></li><li><a href="https://leetcode-cn.com/problems/reverse-nodes-in-k-group/">K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</a></li><li><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></li></ol><h5 id="æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—"><a href="#æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—" class="headerlink" title="æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—"></a>æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—</h5><ol><li><a href="https://leetcode-cn.com/problems/valid-parentheses/">æœ‰æ•ˆçš„æ‹¬å·</a></li><li><a href="https://leetcode-cn.com/problems/min-stack/">æœ€å°æ ˆ</a></li><li><a href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/">æŸ±çŠ¶å›¾ä¸­çš„æœ€å¤§çŸ©å½¢</a></li><li><a href="https://leetcode-cn.com/problems/sliding-window-maximum/">æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></li><li><a href="https://leetcode-cn.com/problems/trapping-rain-water/">æ¥é›¨æ°´</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¯å¤©ä¸€ä¸ªå¼€å‘å°æŠ€å·§</title>
    <link href="/2021/03/11/daily-tips/"/>
    <url>/2021/03/11/daily-tips/</url>
    
    <content type="html"><![CDATA[<h2 id="å°¬èŠ"><a href="#å°¬èŠ" class="headerlink" title="å°¬èŠ"></a>å°¬èŠ</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸å…ä¼šé‡åˆ°è‡ªå·±ä¸ç†Ÿæ‚‰çš„åœ°æ–¹ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æŸ¥å®Œç”¨å®Œç„¶åå°±æ˜¯æŠ€èƒ½å½’è¿˜ã€‚å¦‚æœèƒ½åœ¨è¿™é‡Œè®°å½•æ•´ç†æ”¶é›†ï¼Œé‚£ä¹Ÿæ˜¯ä¸€ç¬”å®è´µçš„çŸ¥è¯†åŠ›é‡ã€‚å¯èƒ½æœ‰çš„å°æŠ€å·§å¹¶æ²¡æœ‰å¤ªå¤šçš„å®ç”¨ä»·å€¼ï¼Œä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„å¥‡æŠ€æ·«å·§ï¼Œä½†è¿™äº›ä»£ç é‡Œçš„ç²¾å½©çš„ç¢ç‰‡ã€‚æ—¥æ‹±ä¸€å’ï¼Œç§¯å°‘æˆå¤šï¼Œç›¸ä¿¡æ—¶é—´çš„åŠ›é‡ã€‚</p><h2 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h2><ul><li>Macæ ¡éªŒæ–‡ä»¶SHA</li></ul><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs zsh">shasum -a 256 <span class="hljs-variable">$&#123;file&#125;</span><br></code></pre></td></tr></table></figure><ul><li><a href="https://jaywcjlove.gitee.io/linux-command/c/tcpdump.html">Linux å‘½ä»¤è¡ŒæŠ“åŒ…</a></li></ul><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs zsh">tcpdump -D <span class="hljs-comment"># å½“å‰å¯ä»¥ç›‘å¬çš„ç½‘å¡</span><br></code></pre></td></tr></table></figure><ul><li>git tag é‡å‘½å</li></ul><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs zsh">daiwei@daiweideMacBook-Pro ~ % git tag [new_name] [old_name]  <span class="hljs-comment"># å¤åˆ¶åŸæœ‰çš„tag</span><br>daiwei@daiweideMacBook-Pro ~ % git tag -d [old_name] <span class="hljs-comment"># åˆ é™¤åŸæœ‰tag</span><br>daiwei@daiweideMacBook-Pro ~ % git push origin :refs/tag/v1.0 <span class="hljs-comment"># åˆ é™¤è¿œç¨‹ tag</span><br>daiwei@daiweideMacBook-Pro ~ % git push --tag <span class="hljs-comment">#æ¨é€æœ¬åœ°æ–°çš„tag</span><br></code></pre></td></tr></table></figure><ul><li>reflections åå°„å·¥å…·åŒ…ï¼Œå†…ç½®åå°„ç›¸å…³æ“ä½œï¼Œç®€åŒ–å¼€å‘</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.reflections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reflections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>ä¸ä½¿ç”¨ springboot-parent åˆ›å»º springboot é¡¹ç›®ï¼Œæ–¹ä¾¿æ¸…æ™°ç³»ç»Ÿæ•´ä½“ç»§æ‰¿ç»“æ„ã€‚åªéœ€è¦åœ¨ä¾èµ–çš„çˆ¶pom çš„ dependencyManagement ä¸­æ·»åŠ  spring-boot-dependencies ä¾èµ–å³å¯ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;springboot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>ä¸‰ä¸ªæœ‰æ„æ€çš„åœ¨çº¿çš„ playgroud </p><ul><li><p>redis åœ¨çº¿çš„web shell <a href="https://try.redis.io/">try redis</a> ï¼Œå¯ä»¥æ‰§è¡Œä¸€äº› redis cmdsã€‚</p></li><li><p>docker çš„åœ¨çº¿ <a href="https://labs.play-with-docker.com/">docker lab</a>ï¼Œç™»å½•åæä¾›ä¸€ä¸ªæ—¶é•¿å››ä¸ªå°æ—¶çš„ sessionï¼Œè¿‡æœŸéœ€è¦é‡æ–°ç™»å½•ï¼Œç™»å½•éœ€è¦ docker hub çš„è´¦å·ï¼Œåœ¨ session ä¸­å¯ä»¥æ“ä½œå¤šä¸ªdockerå®ä¾‹ï¼Œæ­£å¦‚è¿™ä¸ª lab çš„åå­—ä¸€æ ·ï½paly with dockerã€‚</p></li><li><p>git åœ¨çº¿å­¦ä¹ ç½‘ç«™ <a href="https://learngitbranching.js.org/?locale=zh_CN">learn-git-branch</a>ï¼Œåœ¨è¿™ä¸ªç½‘ç«™é€šè¿‡å®Œæˆä¸€ä¸ªä¸ªä»»åŠ¡å­¦ä¹ å‘½ä»¤æ“ä½œå¯è§†åŒ–çš„gitèŠ‚ç‚¹åˆ°è¾¾å­¦ä¹  git çš„ç›®çš„ï¼Œå°±å¾ˆniceï½</p></li></ul></li><li><p>.gitignore æ–‡ä»¶ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œæ¸…ç† git çš„æœ¬åœ°çš„ç¼“å­˜ï¼Œç„¶åé‡æ–° add commit å°±å¯ä»¥äº†</p></li></ul><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs zsh">daiwei@daiweideMacBook-Pro ~ % git rm -r --cached .<br>daiwei@daiweideMacBook-Pro ~ % git add .<br>daiwei@daiweideMacBook-Pro ~ % git commit -m<span class="hljs-string">&#x27;update msg&#x27;</span><br>daiwei@daiweideMacBook-Pro ~ % git push origin main<br></code></pre></td></tr></table></figure><ul><li><p>linux æŸ¥çœ‹ç«¯å£ï¼Œæ¯æ¬¡éƒ½è¦æŸ¥ï¼Œæ¯æ¬¡éƒ½è®°ä¸ä½ğŸ˜«</p><p>netstat å‘½ä»¤ ç”¨äºæŸ¥çœ‹ tcp å’Œ udp çš„ç«¯å£å ç”¨æƒ…å†µ</p><ul><li>-t (tcp) ä»…ä»…æ˜¾ç¤º tcp ç›¸å…³</li><li>-u(udp) ä»…ä»…æ˜¾ç¤º udp ç›¸å…³</li><li>-n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–ä¸ºæ•°å­—</li><li>-l ä»…åˆ—å‡ºåœ¨Listen(ç›‘å¬)çš„æœåŠ¡çŠ¶æ€</li><li>-p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå</li></ul><p>æ‰€ä»¥æˆ‘å…¨éƒ½è¦ æ‰€ä»¥å‘½ä»¤å°±æ˜¯ -nptul (ç‰›æ‰¹åäº†)ğŸ˜</p><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs zsh">netstat -nptul | grep &lt;port&gt;<br></code></pre></td></tr></table></figure><p> <strong>æ³¨æ„è¿™ä¸ªå‘½ä»¤ mac ä¸Šå°±æ˜¯å¦å¤–ä¸€å¥—å‚æ•°äº†ï¼Œmac ä¸Šå¯ä»¥ä½¿ç”¨ lsof - i:port</strong></p></li><li><p>redis ä¸­ lua è„šæœ¬çš„ç¼–å†™çš„åŸºæœ¬æ–¹æ³•</p><p>ä» redis 2.6.0 å¼€å§‹å†…ç½®æ”¯æŒ lua è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ lua è„šæœ¬å®ç°æ‰§è¡Œå¤šæ¡å‘½ä»¤çš„åŸå­æ€§ï¼Œå…¸å‹çš„ä½¿ç”¨åœºæ™¯æœ‰ åˆ†å¸ƒå¼é” å’Œ åˆ†å¸ƒå¼æ‰£å‡ç­‰ã€‚åŸºæœ¬çš„æ“ä½œå‘½ä»¤å¦‚ä¸‹</p><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs zsh">127.0.0.1:6379&gt; EVAL script numkeys key [key...] arg [arg...]<br></code></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>script</td><td>è„šæœ¬å†…å®¹</td></tr><tr><td>numkeys</td><td>key çš„ä¸ªæ•°ï¼ˆåªæ˜¯ key çš„ä¸ªæ•°å’Œ argv æ²¡æœ‰å…³ç³»ï¼‰</td></tr><tr><td>key [keyâ€¦]</td><td>keyåˆ—è¡¨ï¼Œé”®åé€šè¿‡å…¨å±€å˜é‡ KEYS æ•°ç»„ï¼Œç”¨ 1 ä¸ºåŸºå€çš„å½¢å¼è®¿é—®( KEYS[1] ï¼Œ KEYS[2] ï¼Œä»¥æ­¤ç±»æ¨)</td></tr><tr><td>arg [argâ€¦]</td><td>å‚æ•°åˆ—è¡¨ï¼Œå‚æ•°é€šè¿‡å…¨å±€å˜é‡ ARGV æ•°ç»„ï¼Œç”¨ 1 ä¸ºåŸºå€çš„å½¢å¼è®¿é—®( ARGV[1] ï¼Œ ARGV[2] ï¼Œä»¥æ­¤ç±»æ¨)</td></tr></tbody></table><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs zsh">127.0.0.1:6379&gt; <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;return &#123;KEYS[1], KEYS[2], ARGV[1], ARGV[2], ARGV[3]&#125;&quot;</span> 2 key1 key2 avg1 avg2 avg3<br><span class="hljs-comment">## è¾“å‡º</span><br>1) <span class="hljs-string">&quot;key1&quot;</span><br>2) <span class="hljs-string">&quot;key2&quot;</span><br>3) <span class="hljs-string">&quot;avg1&quot;</span><br>4) <span class="hljs-string">&quot;avg2&quot;</span><br>5) <span class="hljs-string">&quot;avg3&quot;</span><br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥é€šè¿‡ <strong>script load</strong> å‘½ä»¤ç¼“å­˜å‘½ä»¤ï¼Œå¹¶é€šè¿‡ <strong>evalsha</strong> å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs zsh">SCRIPT LOAD script <span class="hljs-comment"># ç¼“å­˜ lua è„šæœ¬</span><br>EVALSHA sha1 numkeys key [key ...] arg [arg ...]  <span class="hljs-comment"># æ‰§è¡Œ lua è„šæœ¬</span><br></code></pre></td></tr></table></figure><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs zsh">script load <span class="hljs-string">&quot;return &#123;KEYS[1], KEYS[2], ARGV[1], ARGV[2], ARGV[3]&#125;&quot;</span><br><span class="hljs-string">&quot;0e8e5b92bfe818cf5eb29a03465e71bd8ef3e95a&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs zsh">127.0.0.1:6379&gt; evalsha 0e8e5b92bfe818cf5eb29a03465e71bd8ef3e95a 2 hello word arg1 arg2 arg3<br>1) <span class="hljs-string">&quot;hello&quot;</span><br>2) <span class="hljs-string">&quot;word&quot;</span><br>3) <span class="hljs-string">&quot;arg1&quot;</span><br>4) <span class="hljs-string">&quot;arg2&quot;</span><br>5) <span class="hljs-string">&quot;arg3&quot;</span><br></code></pre></td></tr></table></figure><p>å‡ ä¸ªå¸¸ç”¨çš„ redis lua è„šæœ¬</p><p>â€‹    åˆ†å¸ƒå¼é”</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">--lock</span><br><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&#x27;setnx&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;expire&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">2</span>]) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;false&#x27;</span> <span class="hljs-keyword">end</span><br><span class="hljs-comment">-- unlock</span><br><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;del&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) <span class="hljs-keyword">end</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;true&#x27;</span><br></code></pre></td></tr></table></figure><p>â€‹    åˆ†å¸ƒå¼è®¡æ•°å™¨</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&#x27;EXISTS&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> redis.call(<span class="hljs-string">&#x27;GET&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) &gt; ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;decr&#x27;</span>, KEYS[<span class="hljs-number">1</span>])  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-keyword">else</span>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;false&#x27;</span> <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>éšç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘å°æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>100wæ•°æ®æ’å…¥å®ç°ä¸æ€è€ƒ</title>
    <link href="/2021/03/07/100w-data-insert/"/>
    <url>/2021/03/07/100w-data-insert/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>è¿™æ˜¯å­¦ä¹ ä¸­é‡åˆ°çš„ä¸€ä¸ªé¢˜ç›®ï¼Œå¾€ä¸€ä¸ªè¡¨ä¸­æ’å…¥100wæ¡æ•°æ®ï¼Œçœ‹åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™äººæ˜¯æ‡µé€¼çš„ã€‚å› ä¸ºç›®å‰å…¬å¸çº¿ä¸Šæœ€å¤§çš„è¡¨è®°å½•ä¸è¿‡100wå‡ºå¤´ï¼Œæ¯æ¬¡åšæ•°æ®æ¸…æ´—æˆ–è€…æ•°æ®è¿ç§»çš„æ—¶å€™ä¸€ä¸ªé€šå®µéƒ½ä¸ä¸€å®šèƒ½è·‘å®Œï¼Œé‚£ä¹ˆæ’å…¥100w åˆæ€ä¹ˆä¼šå¿«çš„èµ·æ¥å‘¢ï¼Ÿæ›´ä½•å†µè€å¸ˆé—®æ˜¯å¦èƒ½æŠŠæ€§èƒ½ä¼˜åŒ–åˆ° 10s ä¹‹å†…å‘¢ã€‚ã€‚</p><h3 id="æ€ç»´çˆ†ç‚¸"><a href="#æ€ç»´çˆ†ç‚¸" class="headerlink" title="æ€ç»´çˆ†ç‚¸"></a>æ€ç»´çˆ†ç‚¸</h3><p>åªè¦æ€æƒ³ä¸æ»‘å¡ï¼ŒåŠæ³•æ€»æ¯”æ–¹æ³•å¤šã€‚è€å¸ˆæ—¢ç„¶é—®äº†é‚£è¿™ä¸ªé—®é¢˜è‚¯å®šæ˜¯æœ‰è§£çš„ï¼Œå¦‚æœè„‘æš´åˆ†æä¸‹å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ä¸€äº›ä¿¡æ¯çº¿ç´¢ã€‚</p><ul><li><p><strong>æ•°æ®åº“ä¼˜åŒ–ä¸»è¦åˆ†ä»¥ä¸‹ä¸‰éƒ¨åˆ†</strong></p><ul><li><strong>æ•°æ®åº“ç«¯å‚æ•°ä¼˜åŒ–</strong></li><li><strong>sql ä¼˜åŒ–</strong></li><li><strong>è¡¨ç»“æ„ä¼˜åŒ–</strong></li></ul></li><li><p>å½±å“æ•°æ®åº“ååé‡çš„å› ç´ </p><ul><li>å•ä¸ªäº‹åŠ¡å¤§å°</li><li>redologå†™å…¥æƒ…å†µå’Œè„é¡µæ•°é‡</li><li>æ•°æ®åº“è¿æ¥æ± ç©ºé—²æƒ…å†µå’Œä¸€äº›ç›¸å…³çš„buffer</li><li>ç´¢å¼•</li><li>æ•°æ®åº“å®ä¾‹æ€§èƒ½</li></ul></li><li><p>java ä»£ç çš„æ€§èƒ½å› ç´ </p><ul><li>å°è£…è¶Šå° é€Ÿåº¦è¶Šå¿«</li><li>å¤šçº¿ç¨‹</li><li>æ•°æ®åº“è¿æ¥æ± </li></ul></li><li><p>è¿è¡Œç¯å¢ƒå› ç´ </p><ul><li>cpu</li><li>io</li><li>system</li></ul></li></ul><p>ä»¥ä¸Šè¿™äº›æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„ä¸€äº›å½±å“çš„æ–¹é¢ï¼Œå’Œå¯ä»¥é’ˆå¯¹ä¼˜åŒ–çš„ç‚¹ã€‚æœ¬æ¬¡æµ‹è¯•åŸºæœ¬ä¸Šéƒ½åœ¨æˆ‘è‡ªå·±çš„ mbp ä¸Šè·‘ï¼Œæ‰€ä»¥<strong>è¿è¡Œç¯å¢ƒè¿™ä¸ªæ¡ä»¶å˜é‡åŸºæœ¬æ˜¯æ§åˆ¶ä¸å˜</strong>çš„ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„ä¸€äº›å› ç´ å¯ä»¥å¾—åˆ°ä¸€äº›å¯è¡Œçš„æ“ä½œæ–¹æ¡ˆ</p><ol><li>æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql</li><li>åŸºæœ¬çš„å¾ªç¯æ’å…¥</li><li>æ‹¼æ¥æ‰¹é‡ sql</li><li>ä½¿ç”¨preparedStatement + queryBatch</li><li>å¤šçº¿ç¨‹æå‡æ€§èƒ½</li></ol><h3 id="èµ°ä¸¤æ­¥è¯•è¯•"><a href="#èµ°ä¸¤æ­¥è¯•è¯•" class="headerlink" title="èµ°ä¸¤æ­¥è¯•è¯•"></a>èµ°ä¸¤æ­¥è¯•è¯•</h3><h4 id="æ•°æ®åº“ç¯å¢ƒ"><a href="#æ•°æ®åº“ç¯å¢ƒ" class="headerlink" title="æ•°æ®åº“ç¯å¢ƒ"></a>æ•°æ®åº“ç¯å¢ƒ</h4><blockquote><p>docker é»˜è®¤é…ç½® + mysql5.7</p></blockquote><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs zsh">docker pull mysql:5.7<br>docker run --name mysql-test -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7<br></code></pre></td></tr></table></figure><h4 id="è¡¨ç»“æ„"><a href="#è¡¨ç»“æ„" class="headerlink" title="è¡¨ç»“æ„"></a>è¡¨ç»“æ„</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_order_test_1(<br>`id` <span class="hljs-type">int</span> auto_increment,<br>`good_id` <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>`user_id` <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>, <br>`good_status` tinyint <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>`username` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br><span class="hljs-keyword">primary</span> key(id)<br>) engine<span class="hljs-operator">=</span>innodb<br></code></pre></td></tr></table></figure><h4 id="æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql"><a href="#æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql" class="headerlink" title="æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql"></a>æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql</h4><p>ä»æ•°æ®åº“ä¸­åå‘å¯¼å‡ºæ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">LOCK TABLES `tb_order_test_1` WRITE;<br><span class="hljs-comment">/*!40000 ALTER TABLE `tb_order_test_1` DISABLE KEYS */</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tb_order_test_1` (`id`, `good_id`, `user_id`, `good_status`, `username`)<br><span class="hljs-keyword">VALUES</span><br>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>..... <span class="hljs-number">100</span>w .....<br>(<span class="hljs-number">999997</span>,<span class="hljs-number">999996</span>,<span class="hljs-number">999996</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">999998</span>,<span class="hljs-number">999997</span>,<span class="hljs-number">999997</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">999999</span>,<span class="hljs-number">999998</span>,<span class="hljs-number">999998</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),<br>(<span class="hljs-number">1000000</span>,<span class="hljs-number">999999</span>,<span class="hljs-number">999999</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>);<br><br><span class="hljs-comment">/*!40000 ALTER TABLE `tb_order_test_1` ENABLE KEYS */</span>;<br>UNLOCK TABLES;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯¼å‡ºæ•°æ®å¯ä»¥å‘ç°ä¸¤ä¸ªé—®é¢˜ï¼Œé¦–å…ˆsql çš„å­˜å‚¨çš„æ–‡ä»¶æ˜¯æ‰¹é‡æ’å…¥çš„ï¼Œå…¶æ¬¡åœ¨æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œè¡¨æ˜¯é”å®šçŠ¶æ€çš„ã€‚</p><p>æœ€ç»ˆæ‰‹åŠ¨ğŸ™ˆæè¡¨æµ‹100w çš„æ•°æ®å¯¼å…¥å¤§æ¦‚éœ€è¦ 7.5 ç§’ã€‚</p><h4 id="åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ"><a href="#åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ" class="headerlink" title="åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ"></a>åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ</h4><p>è¿™ä¸ªæœ€åŸºæœ¬æœ€ç®€å•çš„å¾ªç¯æ’å…¥ï¼Œæ˜æ˜¾æ˜¯ä¸å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„æ’å…¥æ€§èƒ½çš„ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯æƒ³çŸ¥é“æœ€æ…¢ç€è¦å¤šä¹…ğŸ¤¤ã€‚è¿™æœ€åŸºæœ¬çš„å°±ä¸ç”¨é‚£äº›ORM æ¡†æ¶äº†å°±ç›´æ¥ä½¿ç”¨ jdbc æ“ä½œäº†ï¼Œå°è£…è¶Šé«˜é€Ÿåº¦ä¹Ÿå°±è¶Šæ…¢ã€‚åŒæ—¶ç¨å¾®æ§åˆ¶ä¸‹äº‹åŠ¡ï¼Œè¿™ç§ä¸è€ƒè™‘å¤§äº‹åŠ¡çš„å‰æä¸‹ï¼Œå‡å°‘äº‹åŠ¡æäº¤ï¼Œä¸€æ¬¡æäº¤ã€‚å¤§é‡æ•°æ®çš„æ’å…¥ä¼šå½±å“åˆ°æ•°æ®é¡µå¯¼è‡´é¡µåˆ†è£‚ï¼Œä¹Ÿä¼šæ‹–æ…¢æ•´ä½“çš„æ—¶é—´ï¼Œæ‰€ä»¥æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä¸é¢å¤–åˆ›å»ºç´¢å¼•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertByLoop</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>  Connection conn = JdbcUtil.getConnFromHikari();<br>  PreparedStatement stat = <span class="hljs-keyword">null</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>      String sql = <span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values (?, ?, ?, ?)&quot;</span>;<br>      conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>      stat = conn.prepareStatement(sql);<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3000</span>; i++) &#123;<br>          stat.setLong(<span class="hljs-number">1</span>, i);<br>          stat.setLong(<span class="hljs-number">2</span>, i);<br>          stat.setInt(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>);<br>          stat.setString(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;daiwei&quot;</span>);<br>          stat.execute();<br>        &#125;<br>      conn.commit();<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>      throwables.printStackTrace();<br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);<br>    &#125;<br>  System.out.println(System.currentTimeMillis() - start);<br>&#125;<br></code></pre></td></tr></table></figure><p>1wæ¡æ•°æ®æ’å…¥è€—æ—¶ 24015 msï¼Œæ’å…¥çš„æ•°æ®é‡å’Œæ’å…¥æ—¶é—´æ˜¯çº¿æ€§ç›¸å…³çš„ï¼Œæ‰€ä»¥å°±ä¸è¿‡å¤šçš„æµªè´¹æ—¶é—´äº†ã€‚ã€‚ã€‚ğŸ¤¨</p><h4 id="jdbc-batch-æ‰¹å¤„ç†"><a href="#jdbc-batch-æ‰¹å¤„ç†" class="headerlink" title="jdbc batch æ‰¹å¤„ç†"></a>jdbc batch æ‰¹å¤„ç†</h4><p>è¿™ä¸ªç‰ˆæœ¬çš„æ“ä½œç›¸è¾ƒäºä¸Šé¢çš„ä¸€ç§ï¼Œæœ€å¤§çš„æå‡å°±æ˜¯ç”¨äº†æ‰¹å¤„ç†æ“ä½œã€‚åœ¨æ‰¹é‡æ’å…¥ä¸Šæ€§èƒ½èƒ½æœ‰ä¸€å®šçš„æå‡ï¼Œä½†æ˜¯æå‡æ•ˆæœä¸æ˜¯å¾ˆå¤§ã€‚1w æ•°æ®é‡ 11358msã€‚<strong>ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå‚æ•°rewriteBatchedStatements=true</strong>ï¼ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°å…è®¸å°†æ‰¹é‡å¤„ç†çš„ sql è¿›è¡Œé‡å†™ï¼Œæ¥æé«˜æ‰¹å¤„ç†æ€§èƒ½ï¼Œç›¸å½“äºé­”æ”¹äº†ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertSqlBatch</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>  Connection conn = JdbcUtil.getConnFromHikari();<br>  PreparedStatement stat = <span class="hljs-keyword">null</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>      String sql = <span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values (?, ?, ?, ?)&quot;</span>;<br>      conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>      stat = conn.prepareStatement(sql);<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50000</span>; i++) &#123;<br>          stat.setLong(<span class="hljs-number">1</span>, i);<br>          stat.setLong(<span class="hljs-number">2</span>, i);<br>          stat.setInt(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>);<br>          stat.setString(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;daiwei&quot;</span>);<br>          stat.addBatch();<br>        &#125;<br>      stat.executeBatch();<br>      conn.commit();<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>      throwables.printStackTrace();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);<br>    &#125;<br>  System.out.println(System.currentTimeMillis() - start);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/test?rewriteBatchedStatements=true</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ å‚æ•°ä¹‹åï¼Œbatch insert çš„æ€§èƒ½æœ‰æå¤§çš„æé«˜ã€‚100w çš„æ•°æ®é‡ 8775ms å°±æ“ä½œå®Œæˆã€‚</p><h4 id="æ‹¼æ¥sql-æ‰¹å¤„ç†"><a href="#æ‹¼æ¥sql-æ‰¹å¤„ç†" class="headerlink" title="æ‹¼æ¥sql + æ‰¹å¤„ç†"></a>æ‹¼æ¥sql + æ‰¹å¤„ç†</h4><p>åœ¨ä¸å¼€å¯rewriteBatchedStatements = true çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘è‡ªå·±æ‰‹åŠ¨æ‹¼æ¥sql å‡å°‘ jdbc çš„å°è£…ï¼Œé€Ÿåº¦æ˜¯å¦èƒ½åœ¨å¾€ä¸Šæå‡å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertByBatch</span><span class="hljs-params">()</span> </span>&#123;<br>  Connection conn = JdbcUtil.getConnFromHikari();<br>    Statement stat = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>    <span class="hljs-keyword">try</span> &#123;<br>      stat = conn.createStatement();<br>      String sql;<br>      StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values&quot;</span>);<br>      conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) &#123;<br>              sb.append(<span class="hljs-string">&quot;(&quot;</span> + i +<span class="hljs-string">&quot; , &quot;</span> + j +<span class="hljs-string">&quot;, 1 , &#x27;daiwei&#x27;),&quot;</span>);<br>            &#125;<br>          sql = sb.deleteCharAt(sb.length() - <span class="hljs-number">1</span>).toString();<br>          stat.addBatch(sql);<br>          sb.delete(<span class="hljs-number">75</span>, sb.length());<br>        &#125;<br>      stat.executeBatch();<br>      conn.commit();<br>      System.out.println(System.currentTimeMillis() - start);<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>      throwables.printStackTrace();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ¡ˆè·‘ä¸‹æ¥ï¼Œä¼˜åŒ–æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ï¼Œ100wçš„æ•°æ®æ’å…¥çš„æ—¶é—´å¤§æ¦‚åœ¨ 5s ï½6s è¿™ä¸ªåŒºé—´ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„å°ç¼ºç‚¹æ˜¯äº‹åŠ¡åˆ†å¼€çš„æ•´ä½“çš„æ•°æ®æ’å…¥ä¸æ˜¯åŸå­æ€§çš„ã€‚</p><h4 id="å¤šçº¿ç¨‹-æ‹¼æ¥sql-æ‰¹å¤„ç†"><a href="#å¤šçº¿ç¨‹-æ‹¼æ¥sql-æ‰¹å¤„ç†" class="headerlink" title="å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç†"></a>å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç†</h4><p>å•çº¿ç¨‹è·‘ä¸‹æ¥æ€§èƒ½éƒ½å·²ç»æå‡è¿™ä¹ˆæ˜æ˜¾äº†ï¼Œé‚£å¤šçº¿ç¨‹ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertConcurBatch</span><span class="hljs-params">()</span> </span>&#123;<br>  ExecutorService executor = Executors.newFixedThreadPool(<span class="hljs-number">4</span>);<br>  <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>  CyclicBarrier cyclicBarrier = <span class="hljs-keyword">new</span> CyclicBarrier(<span class="hljs-number">4</span>, () -&gt; &#123;<br>      System.out.println(System.currentTimeMillis() - start);<br>      executor.shutdown();<br>    &#125;);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>      executor.execute(() -&gt; &#123;<br>          insertByBatch(<span class="hljs-number">250</span>);<br>          <span class="hljs-keyword">try</span> &#123;<br>              cyclicBarrier.await();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>              e.printStackTrace();<br>            &#125; <span class="hljs-keyword">catch</span> (BrokenBarrierException e) &#123;<br>              e.printStackTrace();<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertByBatch</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>  Connection conn = JdbcUtil.getConnFromHikari();<br>    Statement stat = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>    <span class="hljs-keyword">try</span> &#123;<br>      stat = conn.createStatement();<br>      String sql;<br>      StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values&quot;</span>);<br>      conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) &#123;<br>              sb.append(<span class="hljs-string">&quot;(&quot;</span> + i +<span class="hljs-string">&quot; , &quot;</span> + j +<span class="hljs-string">&quot;, 1 , &#x27;daiwei&#x27;),&quot;</span>);<br>            &#125;<br>          sql = sb.deleteCharAt(sb.length() - <span class="hljs-number">1</span>).toString();<br>          stat.addBatch(sql);<br>          sb.delete(<span class="hljs-number">75</span>, sb.length());<br>        &#125;<br>      stat.executeBatch();<br>      conn.commit();<br>      System.out.println(System.currentTimeMillis() - start);<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>      throwables.printStackTrace();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœç„¶å‘æŒ¥å¤šçº¿ç¨‹çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæ•´ä½“æ€§èƒ½ä¼˜èƒ½å¾€ä¸Šæå‡ä¸€ç‚¹ç‚¹ã€‚</p><h3 id="æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°"><a href="#æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°" class="headerlink" title="æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°"></a>æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°</h3><p>å®é™…ç”Ÿäº§ç¯å¢ƒçš„è¯ï¼Œå¹¶ä¸ä¼šæœ‰å‡ ä¸ªè¡¨åªæœ‰ å‡ ä¸ªå­—æ®µï¼Œå¤šæ˜¯å­—æ®µ20+ ï¼Œæ‰€ä»¥å¦‚æœå­—æ®µå¤šä¸Šå»ï¼Œæ’å…¥æ€§èƒ½æ˜¯å¦ä¼šå—åˆ°å½±å“ï¼Ÿå¦‚æ­¤ä¾¿æœ‰äº†ä¸‹é¢çš„æµ‹è¯•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tb_order_test` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `good_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `user_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `good_status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>  `field_4` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_5` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_6` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_7` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_8` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_9` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_10` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_11` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_12` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_13` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_14` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_15` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_16` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_17` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_18` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_19` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_20` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_21` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_22` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_23` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_24` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_25` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_26` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_27` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_28` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_29` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `field_30` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">5214001</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>latin1;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç çš„è¯è¿™é‡Œç”¨çš„è¿˜æ˜¯ å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç† çš„ pro ç‰ˆæœ¬ï¼Œæœç„¶è¿™æ¬¡çš„æµ‹è¯•çš„é€Ÿåº¦æœ‰å¾ˆæ˜æ˜¾çš„ä¸‹é™ 100w çš„æ’å…¥æ—¶é—´ åˆ°äº† 19866msï¼Œæˆ‘çš„ç”µè„‘æ˜¯ 8 æ ¸çš„ï¼Œæœ¬ç€å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºå’Œæ•°æ®åº“å¹¶å‘èµ„æºçš„åŸåˆ™ã€‚æœ€ç»ˆçš„ 100w æ—¶é—´åˆ°äº† 18080msã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­æœ‰å¾ˆå¤šçš„ç¯å¢ƒå› ç´ ï¼šmysqlæ•°æ®åº“ã€sqlè¯­å¥å’Œ javaä»£ç ç­‰å¤šä¸ªæ–¹é¢ï¼Œå…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ¨åˆ†å‡ºç°ç“¶é¢ˆï¼Œéƒ½ä¼šæ‹–ç´¯æ•´ä½“çš„æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœæ¢ä¸ªè§’åº¦å»çœ‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æ¯ä¸ªéƒ¨åˆ†çš„æ€§èƒ½éƒ½èƒ½å……åˆ†å‘æŒ¥æ•´ä½“çš„æ€§èƒ½ä¹Ÿç›¸åº”æé«˜ã€‚æœ¬æ¬¡çš„ä¼˜åŒ–è¿‡ç¨‹ä» sqléƒ¨åˆ†ï¼Œç¼–ç æŠ€å·§åˆ°è¡¨ç»“æ„ä¼˜åŒ–å»å°½å¯èƒ½æå‡100wæ•°æ®çš„æ’å…¥é€Ÿåº¦ã€‚è¿™é‡Œæ¼äº†ä¸€ä¸ªè§’åº¦ï¼Œå°±æ˜¯è°ƒæ•´mysql çš„å‚æ•°å»ä¼˜åŒ–ï¼Œåœ¨mysql å†™å…¥è¿‡ç¨‹ä¸­æœ‰ WAL æœºåˆ¶ï¼Œå¦‚æœè¿™é‡Œè°ƒå¤§ redolog buf å°½å¯èƒ½å°‘çš„å‡å°‘ redolog çš„ åˆ·è„é¡µæ“ä½œï¼Œæ˜¯å¦ä¹Ÿèƒ½æå‡å†™å…¥çš„æ€§èƒ½å‘¢ï¼ŸğŸ¤”ï¼Œæœ€åä¸‹é¢æ˜¯æœ¬æ¬¡æµ‹è¯•ç»“æœè¡¨æ ¼</p><table><thead><tr><th>æ’å…¥æ–¹å¼</th><th>1w</th><th>10w</th><th>100W</th></tr></thead><tbody><tr><td>æ•°æ®åº“å·¥å…·å¯¼å…¥</td><td>-</td><td>-</td><td>7500ms</td></tr><tr><td>å•ä¸ªäº‹åŠ¡å¾ªç¯æ’å…¥</td><td>24015ms</td><td>-</td><td>-</td></tr><tr><td>å•ä¸ªäº‹åŠ¡batchæ‰¹å¤„ç†</td><td>11358ms</td><td>-</td><td>-</td></tr><tr><td>é­”æ”¹ batch <br />ï¼ˆrewriteBatchedStatementsï¼‰</td><td>689ms</td><td>1562ms</td><td>8775ms</td></tr><tr><td>æ‹¼æ¥sql + æ‰¹å¤„ç†</td><td>105ms</td><td>992ms</td><td>5302ms</td></tr><tr><td>å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç†</td><td>-</td><td>-</td><td>4314ms</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>éšç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>jdbc</tag>
      
      <tag>å®æ“</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
