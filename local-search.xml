<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>leetcodes ä¹ é¢˜æ±‡æ€»</title>
    <link href="/2021/03/28/leetcodes/"/>
    <url>/2021/03/28/leetcodes/</url>
    
    <content type="html"><![CDATA[<h2 id="LeetCode-ä¹ é¢˜æ±‡æ€»"><a href="#LeetCode-ä¹ é¢˜æ±‡æ€»" class="headerlink" title="LeetCode ä¹ é¢˜æ±‡æ€»"></a>LeetCode ä¹ é¢˜æ±‡æ€»</h2><h5 id="æ•°ç»„ã€é“¾è¡¨"><a href="#æ•°ç»„ã€é“¾è¡¨" class="headerlink" title="æ•°ç»„ã€é“¾è¡¨"></a>æ•°ç»„ã€é“¾è¡¨</h5><ol><li><a href="https://leetcode-cn.com/problems/container-with-most-water/">ç››æ°´æœ€å¤šçš„å®¹å™¨</a></li><li><a href="https://leetcode-cn.com/problems/move-zeroes/">ç§»åŠ¨é›¶</a></li><li><a href="https://leetcode-cn.com/problems/climbing-stairs/">çˆ¬æ¥¼æ¢¯</a></li><li><a href="https://leetcode-cn.com/problems/two-sum/">ä¸¤æ•°ä¹‹å’Œ</a></li><li><a href="https://leetcode-cn.com/problems/3sum/">ä¸‰æ•°ä¹‹å’Œ</a></li><li><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></li><li><a href="https://leetcode-cn.com/problems/rotate-array/">æ—‹è½¬æ•°ç»„</a></li><li><a href="https://leetcode-cn.com/problems/reverse-linked-list/">åè½¬é“¾è¡¨</a></li><li><a href="https://leetcode-cn.com/problems/swap-nodes-in-pairs/">ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</a></li><li><a href="https://leetcode-cn.com/problems/linked-list-cycle/">ç¯å½¢é“¾è¡¨</a></li><li><a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/">ç¯å½¢é“¾è¡¨2</a></li><li><a href="https://leetcode-cn.com/problems/reverse-nodes-in-k-group/">K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</a></li><li><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></li></ol><h5 id="æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—"><a href="#æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—" class="headerlink" title="æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—"></a>æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—</h5><ol><li><a href="https://leetcode-cn.com/problems/valid-parentheses/">æœ‰æ•ˆçš„æ‹¬å·</a></li><li><a href="https://leetcode-cn.com/problems/min-stack/">æœ€å°æ ˆ</a></li><li><a href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/">æŸ±çŠ¶å›¾ä¸­çš„æœ€å¤§çŸ©å½¢</a></li><li><a href="https://leetcode-cn.com/problems/sliding-window-maximum/">æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></li><li><a href="https://leetcode-cn.com/problems/trapping-rain-water/">æ¥é›¨æ°´</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¯å¤©ä¸€ä¸ªå¼€å‘å°æŠ€å·§</title>
    <link href="/2021/03/11/daily-tips/"/>
    <url>/2021/03/11/daily-tips/</url>
    
    <content type="html"><![CDATA[<h2 id="å°¬èŠ"><a href="#å°¬èŠ" class="headerlink" title="å°¬èŠ"></a>å°¬èŠ</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸å…ä¼šé‡åˆ°è‡ªå·±ä¸ç†Ÿæ‚‰çš„åœ°æ–¹ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æŸ¥å®Œç”¨å®Œç„¶åå°±æ˜¯æŠ€èƒ½å½’è¿˜ã€‚å¦‚æœèƒ½åœ¨è¿™é‡Œè®°å½•æ•´ç†æ”¶é›†ï¼Œé‚£ä¹Ÿæ˜¯ä¸€ç¬”å®è´µçš„çŸ¥è¯†åŠ›é‡ã€‚å¯èƒ½æœ‰çš„å°æŠ€å·§å¹¶æ²¡æœ‰å¤ªå¤šçš„å®ç”¨ä»·å€¼ï¼Œä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„å¥‡æŠ€æ·«å·§ï¼Œä½†è¿™äº›ä»£ç é‡Œçš„ç²¾å½©çš„ç¢ç‰‡ã€‚æ—¥æ‹±ä¸€å’ï¼Œç§¯å°‘æˆå¤šï¼Œç›¸ä¿¡æ—¶é—´çš„åŠ›é‡ã€‚</p><h2 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h2><ul><li>Macæ ¡éªŒæ–‡ä»¶SHA</li></ul><div class="code-wrapper"><pre><code class="hljs zsh">shasum -a 256 <span class="hljs-variable">$&#123;file&#125;</span></code></pre></div><ul><li><a href="https://jaywcjlove.gitee.io/linux-command/c/tcpdump.html">Linux å‘½ä»¤è¡ŒæŠ“åŒ…</a></li></ul><div class="code-wrapper"><pre><code class="hljs zsh">tcpdump -D <span class="hljs-comment"># å½“å‰å¯ä»¥ç›‘å¬çš„ç½‘å¡</span></code></pre></div><ul><li>git tag é‡å‘½å</li></ul><div class="code-wrapper"><pre><code class="hljs zsh">daiwei@daiweideMacBook-Pro ~ % git tag [new_name] [old_name]  <span class="hljs-comment"># å¤åˆ¶åŸæœ‰çš„tag</span>daiwei@daiweideMacBook-Pro ~ % git tag -d [old_name] <span class="hljs-comment"># åˆ é™¤åŸæœ‰tag</span>daiwei@daiweideMacBook-Pro ~ % git push origin :refs/tag/v1.0 <span class="hljs-comment"># åˆ é™¤è¿œç¨‹ tag</span>daiwei@daiweideMacBook-Pro ~ % git push --tag <span class="hljs-comment">#æ¨é€æœ¬åœ°æ–°çš„tag</span></code></pre></div><ul><li>reflections åå°„å·¥å…·åŒ…ï¼Œå†…ç½®åå°„ç›¸å…³æ“ä½œï¼Œç®€åŒ–å¼€å‘</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.reflections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reflections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><ul><li>ä¸ä½¿ç”¨ springboot-parent åˆ›å»º springboot é¡¹ç›®ï¼Œæ–¹ä¾¿æ¸…æ™°ç³»ç»Ÿæ•´ä½“ç»§æ‰¿ç»“æ„ã€‚åªéœ€è¦åœ¨ä¾èµ–çš„çˆ¶pom çš„ dependencyManagement ä¸­æ·»åŠ  spring-boot-dependencies ä¾èµ–å³å¯ã€‚</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;springboot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><ul><li><p>ä¸‰ä¸ªæœ‰æ„æ€çš„åœ¨çº¿çš„ playgroud </p><ul><li><p>redis åœ¨çº¿çš„web shell <a href="https://try.redis.io/">try redis</a> ï¼Œå¯ä»¥æ‰§è¡Œä¸€äº› redis cmdsã€‚</p></li><li><p>docker çš„åœ¨çº¿ <a href="https://labs.play-with-docker.com/">docker lab</a>ï¼Œç™»å½•åæä¾›ä¸€ä¸ªæ—¶é•¿å››ä¸ªå°æ—¶çš„ sessionï¼Œè¿‡æœŸéœ€è¦é‡æ–°ç™»å½•ï¼Œç™»å½•éœ€è¦ docker hub çš„è´¦å·ï¼Œåœ¨ session ä¸­å¯ä»¥æ“ä½œå¤šä¸ªdockerå®ä¾‹ï¼Œæ­£å¦‚è¿™ä¸ª lab çš„åå­—ä¸€æ ·ï½paly with dockerã€‚</p></li><li><p>git åœ¨çº¿å­¦ä¹ ç½‘ç«™ <a href="https://learngitbranching.js.org/?locale=zh_CN">learn-git-branch</a>ï¼Œåœ¨è¿™ä¸ªç½‘ç«™é€šè¿‡å®Œæˆä¸€ä¸ªä¸ªä»»åŠ¡å­¦ä¹ å‘½ä»¤æ“ä½œå¯è§†åŒ–çš„gitèŠ‚ç‚¹åˆ°è¾¾å­¦ä¹  git çš„ç›®çš„ï¼Œå°±å¾ˆniceï½</p></li></ul></li><li><p>.gitignore æ–‡ä»¶ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œæ¸…ç† git çš„æœ¬åœ°çš„ç¼“å­˜ï¼Œç„¶åé‡æ–° add commit å°±å¯ä»¥äº†</p></li></ul><div class="code-wrapper"><pre><code class="hljs zsh">daiwei@daiweideMacBook-Pro ~ % git rm -r --cached .daiwei@daiweideMacBook-Pro ~ % git add .daiwei@daiweideMacBook-Pro ~ % git commit -m<span class="hljs-string">&#x27;update msg&#x27;</span>daiwei@daiweideMacBook-Pro ~ % git push origin main</code></pre></div><ul><li><p>linux æŸ¥çœ‹ç«¯å£ï¼Œæ¯æ¬¡éƒ½è¦æŸ¥ï¼Œæ¯æ¬¡éƒ½è®°ä¸ä½ğŸ˜«</p><p>netstat å‘½ä»¤ ç”¨äºæŸ¥çœ‹ tcp å’Œ udp çš„ç«¯å£å ç”¨æƒ…å†µ</p><ul><li>-t (tcp) ä»…ä»…æ˜¾ç¤º tcp ç›¸å…³</li><li>-u(udp) ä»…ä»…æ˜¾ç¤º udp ç›¸å…³</li><li>-n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–ä¸ºæ•°å­—</li><li>-l ä»…åˆ—å‡ºåœ¨Listen(ç›‘å¬)çš„æœåŠ¡çŠ¶æ€</li><li>-p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå</li></ul><p>æ‰€ä»¥æˆ‘å…¨éƒ½è¦ æ‰€ä»¥å‘½ä»¤å°±æ˜¯ -nptul (ç‰›æ‰¹åäº†)ğŸ˜</p><div class="code-wrapper"><pre><code class="hljs zsh">netstat -nptul | grep &lt;port&gt;</code></pre></div><p> <strong>æ³¨æ„è¿™ä¸ªå‘½ä»¤ mac ä¸Šå°±æ˜¯å¦å¤–ä¸€å¥—å‚æ•°äº†ï¼Œmac ä¸Šå¯ä»¥ä½¿ç”¨ lsof - i:port</strong></p></li><li><p>redis ä¸­ lua è„šæœ¬çš„ç¼–å†™çš„åŸºæœ¬æ–¹æ³•</p><p>ä» redis 2.6.0 å¼€å§‹å†…ç½®æ”¯æŒ lua è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ lua è„šæœ¬å®ç°æ‰§è¡Œå¤šæ¡å‘½ä»¤çš„åŸå­æ€§ï¼Œå…¸å‹çš„ä½¿ç”¨åœºæ™¯æœ‰ åˆ†å¸ƒå¼é” å’Œ åˆ†å¸ƒå¼æ‰£å‡ç­‰ã€‚åŸºæœ¬çš„æ“ä½œå‘½ä»¤å¦‚ä¸‹</p><div class="code-wrapper"><pre><code class="hljs zsh">127.0.0.1:6379&gt; EVAL script numkeys key [key...] arg [arg...]</code></pre></div><table><thead><tr><th>å‚æ•°</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>script</td><td>è„šæœ¬å†…å®¹</td></tr><tr><td>numkeys</td><td>key çš„ä¸ªæ•°ï¼ˆåªæ˜¯ key çš„ä¸ªæ•°å’Œ argv æ²¡æœ‰å…³ç³»ï¼‰</td></tr><tr><td>key [keyâ€¦]</td><td>keyåˆ—è¡¨ï¼Œé”®åé€šè¿‡å…¨å±€å˜é‡ KEYS æ•°ç»„ï¼Œç”¨ 1 ä¸ºåŸºå€çš„å½¢å¼è®¿é—®( KEYS[1] ï¼Œ KEYS[2] ï¼Œä»¥æ­¤ç±»æ¨)</td></tr><tr><td>arg [argâ€¦]</td><td>å‚æ•°åˆ—è¡¨ï¼Œå‚æ•°é€šè¿‡å…¨å±€å˜é‡ ARGV æ•°ç»„ï¼Œç”¨ 1 ä¸ºåŸºå€çš„å½¢å¼è®¿é—®( ARGV[1] ï¼Œ ARGV[2] ï¼Œä»¥æ­¤ç±»æ¨)</td></tr></tbody></table><div class="code-wrapper"><pre><code class="hljs zsh">127.0.0.1:6379&gt; <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;return &#123;KEYS[1], KEYS[2], ARGV[1], ARGV[2], ARGV[3]&#125;&quot;</span> 2 key1 key2 avg1 avg2 avg3<span class="hljs-comment">## è¾“å‡º</span>1) <span class="hljs-string">&quot;key1&quot;</span>2) <span class="hljs-string">&quot;key2&quot;</span>3) <span class="hljs-string">&quot;avg1&quot;</span>4) <span class="hljs-string">&quot;avg2&quot;</span>5) <span class="hljs-string">&quot;avg3&quot;</span></code></pre></div><p>è¿˜å¯ä»¥é€šè¿‡ <strong>script load</strong> å‘½ä»¤ç¼“å­˜å‘½ä»¤ï¼Œå¹¶é€šè¿‡ <strong>evalsha</strong> å‘½ä»¤æ‰§è¡Œ</p><div class="code-wrapper"><pre><code class="hljs zsh">SCRIPT LOAD script <span class="hljs-comment"># ç¼“å­˜ lua è„šæœ¬</span>EVALSHA sha1 numkeys key [key ...] arg [arg ...]  <span class="hljs-comment"># æ‰§è¡Œ lua è„šæœ¬</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs zsh">script load <span class="hljs-string">&quot;return &#123;KEYS[1], KEYS[2], ARGV[1], ARGV[2], ARGV[3]&#125;&quot;</span><span class="hljs-string">&quot;0e8e5b92bfe818cf5eb29a03465e71bd8ef3e95a&quot;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs zsh">127.0.0.1:6379&gt; evalsha 0e8e5b92bfe818cf5eb29a03465e71bd8ef3e95a 2 hello word arg1 arg2 arg31) <span class="hljs-string">&quot;hello&quot;</span>2) <span class="hljs-string">&quot;word&quot;</span>3) <span class="hljs-string">&quot;arg1&quot;</span>4) <span class="hljs-string">&quot;arg2&quot;</span>5) <span class="hljs-string">&quot;arg3&quot;</span></code></pre></div><p>å‡ ä¸ªå¸¸ç”¨çš„ redis lua è„šæœ¬</p><p>â€‹    åˆ†å¸ƒå¼é”</p><div class="code-wrapper"><pre><code class="hljs lua"><span class="hljs-comment">--lock</span><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&#x27;setnx&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;expire&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">2</span>]) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;false&#x27;</span> <span class="hljs-keyword">end</span><span class="hljs-comment">-- unlock</span><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;del&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) <span class="hljs-keyword">end</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;true&#x27;</span></code></pre></div><p>â€‹    åˆ†å¸ƒå¼è®¡æ•°å™¨</p><div class="code-wrapper"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&#x27;EXISTS&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> redis.call(<span class="hljs-string">&#x27;GET&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) &gt; ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;decr&#x27;</span>, KEYS[<span class="hljs-number">1</span>])  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-keyword">else</span>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;false&#x27;</span> <span class="hljs-keyword">end</span></code></pre></div></li></ul>]]></content>
    
    
    <categories>
      
      <category>éšç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘å°æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>100wæ•°æ®æ’å…¥å®ç°ä¸æ€è€ƒ</title>
    <link href="/2021/03/07/100w-data-insert/"/>
    <url>/2021/03/07/100w-data-insert/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>è¿™æ˜¯å­¦ä¹ ä¸­é‡åˆ°çš„ä¸€ä¸ªé¢˜ç›®ï¼Œå¾€ä¸€ä¸ªè¡¨ä¸­æ’å…¥100wæ¡æ•°æ®ï¼Œçœ‹åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™äººæ˜¯æ‡µé€¼çš„ã€‚å› ä¸ºç›®å‰å…¬å¸çº¿ä¸Šæœ€å¤§çš„è¡¨è®°å½•ä¸è¿‡100wå‡ºå¤´ï¼Œæ¯æ¬¡åšæ•°æ®æ¸…æ´—æˆ–è€…æ•°æ®è¿ç§»çš„æ—¶å€™ä¸€ä¸ªé€šå®µéƒ½ä¸ä¸€å®šèƒ½è·‘å®Œï¼Œé‚£ä¹ˆæ’å…¥100w åˆæ€ä¹ˆä¼šå¿«çš„èµ·æ¥å‘¢ï¼Ÿæ›´ä½•å†µè€å¸ˆé—®æ˜¯å¦èƒ½æŠŠæ€§èƒ½ä¼˜åŒ–åˆ° 10s ä¹‹å†…å‘¢ã€‚ã€‚</p><h3 id="æ€ç»´çˆ†ç‚¸"><a href="#æ€ç»´çˆ†ç‚¸" class="headerlink" title="æ€ç»´çˆ†ç‚¸"></a>æ€ç»´çˆ†ç‚¸</h3><p>åªè¦æ€æƒ³ä¸æ»‘å¡ï¼ŒåŠæ³•æ€»æ¯”æ–¹æ³•å¤šã€‚è€å¸ˆæ—¢ç„¶é—®äº†é‚£è¿™ä¸ªé—®é¢˜è‚¯å®šæ˜¯æœ‰è§£çš„ï¼Œå¦‚æœè„‘æš´åˆ†æä¸‹å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ä¸€äº›ä¿¡æ¯çº¿ç´¢ã€‚</p><ul><li><p><strong>æ•°æ®åº“ä¼˜åŒ–ä¸»è¦åˆ†ä»¥ä¸‹ä¸‰éƒ¨åˆ†</strong></p><ul><li><strong>æ•°æ®åº“ç«¯å‚æ•°ä¼˜åŒ–</strong></li><li><strong>sql ä¼˜åŒ–</strong></li><li><strong>è¡¨ç»“æ„ä¼˜åŒ–</strong></li></ul></li><li><p>å½±å“æ•°æ®åº“ååé‡çš„å› ç´ </p><ul><li>å•ä¸ªäº‹åŠ¡å¤§å°</li><li>redologå†™å…¥æƒ…å†µå’Œè„é¡µæ•°é‡</li><li>æ•°æ®åº“è¿æ¥æ± ç©ºé—²æƒ…å†µå’Œä¸€äº›ç›¸å…³çš„buffer</li><li>ç´¢å¼•</li><li>æ•°æ®åº“å®ä¾‹æ€§èƒ½</li></ul></li><li><p>java ä»£ç çš„æ€§èƒ½å› ç´ </p><ul><li>å°è£…è¶Šå° é€Ÿåº¦è¶Šå¿«</li><li>å¤šçº¿ç¨‹</li><li>æ•°æ®åº“è¿æ¥æ± </li></ul></li><li><p>è¿è¡Œç¯å¢ƒå› ç´ </p><ul><li>cpu</li><li>io</li><li>system</li></ul></li></ul><p>ä»¥ä¸Šè¿™äº›æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„ä¸€äº›å½±å“çš„æ–¹é¢ï¼Œå’Œå¯ä»¥é’ˆå¯¹ä¼˜åŒ–çš„ç‚¹ã€‚æœ¬æ¬¡æµ‹è¯•åŸºæœ¬ä¸Šéƒ½åœ¨æˆ‘è‡ªå·±çš„ mbp ä¸Šè·‘ï¼Œæ‰€ä»¥<strong>è¿è¡Œç¯å¢ƒè¿™ä¸ªæ¡ä»¶å˜é‡åŸºæœ¬æ˜¯æ§åˆ¶ä¸å˜</strong>çš„ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„ä¸€äº›å› ç´ å¯ä»¥å¾—åˆ°ä¸€äº›å¯è¡Œçš„æ“ä½œæ–¹æ¡ˆ</p><ol><li>æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql</li><li>åŸºæœ¬çš„å¾ªç¯æ’å…¥</li><li>æ‹¼æ¥æ‰¹é‡ sql</li><li>ä½¿ç”¨preparedStatement + queryBatch</li><li>å¤šçº¿ç¨‹æå‡æ€§èƒ½</li></ol><h3 id="èµ°ä¸¤æ­¥è¯•è¯•"><a href="#èµ°ä¸¤æ­¥è¯•è¯•" class="headerlink" title="èµ°ä¸¤æ­¥è¯•è¯•"></a>èµ°ä¸¤æ­¥è¯•è¯•</h3><h4 id="æ•°æ®åº“ç¯å¢ƒ"><a href="#æ•°æ®åº“ç¯å¢ƒ" class="headerlink" title="æ•°æ®åº“ç¯å¢ƒ"></a>æ•°æ®åº“ç¯å¢ƒ</h4><blockquote><p>docker é»˜è®¤é…ç½® + mysql5.7</p></blockquote><div class="code-wrapper"><pre><code class="hljs zsh">docker pull mysql:5.7docker run --name mysql-test -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</code></pre></div><h4 id="è¡¨ç»“æ„"><a href="#è¡¨ç»“æ„" class="headerlink" title="è¡¨ç»“æ„"></a>è¡¨ç»“æ„</h4><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_order_test_1(`id` <span class="hljs-type">int</span> auto_increment,`good_id` <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>,`user_id` <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>, `good_status` tinyint <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;1&#x27;</span>,`username` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-keyword">primary</span> key(id)) engine<span class="hljs-operator">=</span>innodb</code></pre></div><h4 id="æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql"><a href="#æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql" class="headerlink" title="æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql"></a>æ•°æ®åº“è¿æ¥å·¥å…·æ‰§è¡Œæ‰¹é‡sql</h4><p>ä»æ•°æ®åº“ä¸­åå‘å¯¼å‡ºæ•°æ®</p><div class="code-wrapper"><pre><code class="hljs sql">LOCK TABLES `tb_order_test_1` WRITE;<span class="hljs-comment">/*!40000 ALTER TABLE `tb_order_test_1` DISABLE KEYS */</span>;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tb_order_test_1` (`id`, `good_id`, `user_id`, `good_status`, `username`)<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),..... <span class="hljs-number">100</span>w .....(<span class="hljs-number">999997</span>,<span class="hljs-number">999996</span>,<span class="hljs-number">999996</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">999998</span>,<span class="hljs-number">999997</span>,<span class="hljs-number">999997</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">999999</span>,<span class="hljs-number">999998</span>,<span class="hljs-number">999998</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>),(<span class="hljs-number">1000000</span>,<span class="hljs-number">999999</span>,<span class="hljs-number">999999</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;daiwei&#x27;</span>);<span class="hljs-comment">/*!40000 ALTER TABLE `tb_order_test_1` ENABLE KEYS */</span>;UNLOCK TABLES;</code></pre></div><p>è¿™é‡Œå¯¼å‡ºæ•°æ®å¯ä»¥å‘ç°ä¸¤ä¸ªé—®é¢˜ï¼Œé¦–å…ˆsql çš„å­˜å‚¨çš„æ–‡ä»¶æ˜¯æ‰¹é‡æ’å…¥çš„ï¼Œå…¶æ¬¡åœ¨æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œè¡¨æ˜¯é”å®šçŠ¶æ€çš„ã€‚</p><p>æœ€ç»ˆæ‰‹åŠ¨ğŸ™ˆæè¡¨æµ‹100w çš„æ•°æ®å¯¼å…¥å¤§æ¦‚éœ€è¦ 7.5 ç§’ã€‚</p><h4 id="åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ"><a href="#åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ" class="headerlink" title="åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ"></a>åŸºç¡€çš„å¾ªç¯æ“ä½œæ’å…¥æ“ä½œ</h4><p>è¿™ä¸ªæœ€åŸºæœ¬æœ€ç®€å•çš„å¾ªç¯æ’å…¥ï¼Œæ˜æ˜¾æ˜¯ä¸å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„æ’å…¥æ€§èƒ½çš„ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯æƒ³çŸ¥é“æœ€æ…¢ç€è¦å¤šä¹…ğŸ¤¤ã€‚è¿™æœ€åŸºæœ¬çš„å°±ä¸ç”¨é‚£äº›ORM æ¡†æ¶äº†å°±ç›´æ¥ä½¿ç”¨ jdbc æ“ä½œäº†ï¼Œå°è£…è¶Šé«˜é€Ÿåº¦ä¹Ÿå°±è¶Šæ…¢ã€‚åŒæ—¶ç¨å¾®æ§åˆ¶ä¸‹äº‹åŠ¡ï¼Œè¿™ç§ä¸è€ƒè™‘å¤§äº‹åŠ¡çš„å‰æä¸‹ï¼Œå‡å°‘äº‹åŠ¡æäº¤ï¼Œä¸€æ¬¡æäº¤ã€‚å¤§é‡æ•°æ®çš„æ’å…¥ä¼šå½±å“åˆ°æ•°æ®é¡µå¯¼è‡´é¡µåˆ†è£‚ï¼Œä¹Ÿä¼šæ‹–æ…¢æ•´ä½“çš„æ—¶é—´ï¼Œæ‰€ä»¥æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä¸é¢å¤–åˆ›å»ºç´¢å¼•ã€‚</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertByLoop</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">long</span> start = System.currentTimeMillis();  Connection conn = JdbcUtil.getConnFromHikari();  PreparedStatement stat = <span class="hljs-keyword">null</span>;  <span class="hljs-keyword">try</span> &#123;      String sql = <span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values (?, ?, ?, ?)&quot;</span>;      conn.setAutoCommit(<span class="hljs-keyword">false</span>);      stat = conn.prepareStatement(sql);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3000</span>; i++) &#123;          stat.setLong(<span class="hljs-number">1</span>, i);          stat.setLong(<span class="hljs-number">2</span>, i);          stat.setInt(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>);          stat.setString(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;daiwei&quot;</span>);          stat.execute();        &#125;      conn.commit();    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;      throwables.printStackTrace();    &#125;<span class="hljs-keyword">finally</span> &#123;      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);    &#125;  System.out.println(System.currentTimeMillis() - start);&#125;</code></pre></div><p>1wæ¡æ•°æ®æ’å…¥è€—æ—¶ 24015 msï¼Œæ’å…¥çš„æ•°æ®é‡å’Œæ’å…¥æ—¶é—´æ˜¯çº¿æ€§ç›¸å…³çš„ï¼Œæ‰€ä»¥å°±ä¸è¿‡å¤šçš„æµªè´¹æ—¶é—´äº†ã€‚ã€‚ã€‚ğŸ¤¨</p><h4 id="jdbc-batch-æ‰¹å¤„ç†"><a href="#jdbc-batch-æ‰¹å¤„ç†" class="headerlink" title="jdbc batch æ‰¹å¤„ç†"></a>jdbc batch æ‰¹å¤„ç†</h4><p>è¿™ä¸ªç‰ˆæœ¬çš„æ“ä½œç›¸è¾ƒäºä¸Šé¢çš„ä¸€ç§ï¼Œæœ€å¤§çš„æå‡å°±æ˜¯ç”¨äº†æ‰¹å¤„ç†æ“ä½œã€‚åœ¨æ‰¹é‡æ’å…¥ä¸Šæ€§èƒ½èƒ½æœ‰ä¸€å®šçš„æå‡ï¼Œä½†æ˜¯æå‡æ•ˆæœä¸æ˜¯å¾ˆå¤§ã€‚1w æ•°æ®é‡ 11358msã€‚<strong>ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå‚æ•°rewriteBatchedStatements=true</strong>ï¼ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°å…è®¸å°†æ‰¹é‡å¤„ç†çš„ sql è¿›è¡Œé‡å†™ï¼Œæ¥æé«˜æ‰¹å¤„ç†æ€§èƒ½ï¼Œç›¸å½“äºé­”æ”¹äº†ã€‚ã€‚ã€‚</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertSqlBatch</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">long</span> start = System.currentTimeMillis();  Connection conn = JdbcUtil.getConnFromHikari();  PreparedStatement stat = <span class="hljs-keyword">null</span>;  <span class="hljs-keyword">try</span> &#123;      String sql = <span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values (?, ?, ?, ?)&quot;</span>;      conn.setAutoCommit(<span class="hljs-keyword">false</span>);      stat = conn.prepareStatement(sql);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50000</span>; i++) &#123;          stat.setLong(<span class="hljs-number">1</span>, i);          stat.setLong(<span class="hljs-number">2</span>, i);          stat.setInt(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>);          stat.setString(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;daiwei&quot;</span>);          stat.addBatch();        &#125;      stat.executeBatch();      conn.commit();    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;      throwables.printStackTrace();    &#125; <span class="hljs-keyword">finally</span> &#123;      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);    &#125;  System.out.println(System.currentTimeMillis() - start);&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/test?rewriteBatchedStatements=true</span></code></pre></div><p>æ·»åŠ å‚æ•°ä¹‹åï¼Œbatch insert çš„æ€§èƒ½æœ‰æå¤§çš„æé«˜ã€‚100w çš„æ•°æ®é‡ 8775ms å°±æ“ä½œå®Œæˆã€‚</p><h4 id="æ‹¼æ¥sql-æ‰¹å¤„ç†"><a href="#æ‹¼æ¥sql-æ‰¹å¤„ç†" class="headerlink" title="æ‹¼æ¥sql + æ‰¹å¤„ç†"></a>æ‹¼æ¥sql + æ‰¹å¤„ç†</h4><p>åœ¨ä¸å¼€å¯rewriteBatchedStatements = true çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘è‡ªå·±æ‰‹åŠ¨æ‹¼æ¥sql å‡å°‘ jdbc çš„å°è£…ï¼Œé€Ÿåº¦æ˜¯å¦èƒ½åœ¨å¾€ä¸Šæå‡å‘¢ï¼Ÿ</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertByBatch</span><span class="hljs-params">()</span> </span>&#123;  Connection conn = JdbcUtil.getConnFromHikari();    Statement stat = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();    <span class="hljs-keyword">try</span> &#123;      stat = conn.createStatement();      String sql;      StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values&quot;</span>);      conn.setAutoCommit(<span class="hljs-keyword">false</span>);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) &#123;              sb.append(<span class="hljs-string">&quot;(&quot;</span> + i +<span class="hljs-string">&quot; , &quot;</span> + j +<span class="hljs-string">&quot;, 1 , &#x27;daiwei&#x27;),&quot;</span>);            &#125;          sql = sb.deleteCharAt(sb.length() - <span class="hljs-number">1</span>).toString();          stat.addBatch(sql);          sb.delete(<span class="hljs-number">75</span>, sb.length());        &#125;      stat.executeBatch();      conn.commit();      System.out.println(System.currentTimeMillis() - start);    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;      throwables.printStackTrace();    &#125; <span class="hljs-keyword">finally</span> &#123;      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre></div><p>è¿™ä¸ªæ–¹æ¡ˆè·‘ä¸‹æ¥ï¼Œä¼˜åŒ–æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ï¼Œ100wçš„æ•°æ®æ’å…¥çš„æ—¶é—´å¤§æ¦‚åœ¨ 5s ï½6s è¿™ä¸ªåŒºé—´ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„å°ç¼ºç‚¹æ˜¯äº‹åŠ¡åˆ†å¼€çš„æ•´ä½“çš„æ•°æ®æ’å…¥ä¸æ˜¯åŸå­æ€§çš„ã€‚</p><h4 id="å¤šçº¿ç¨‹-æ‹¼æ¥sql-æ‰¹å¤„ç†"><a href="#å¤šçº¿ç¨‹-æ‹¼æ¥sql-æ‰¹å¤„ç†" class="headerlink" title="å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç†"></a>å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç†</h4><p>å•çº¿ç¨‹è·‘ä¸‹æ¥æ€§èƒ½éƒ½å·²ç»æå‡è¿™ä¹ˆæ˜æ˜¾äº†ï¼Œé‚£å¤šçº¿ç¨‹ã€‚ã€‚ã€‚</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertConcurBatch</span><span class="hljs-params">()</span> </span>&#123;  ExecutorService executor = Executors.newFixedThreadPool(<span class="hljs-number">4</span>);  <span class="hljs-keyword">long</span> start = System.currentTimeMillis();  CyclicBarrier cyclicBarrier = <span class="hljs-keyword">new</span> CyclicBarrier(<span class="hljs-number">4</span>, () -&gt; &#123;      System.out.println(System.currentTimeMillis() - start);      executor.shutdown();    &#125;);  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;      executor.execute(() -&gt; &#123;          insertByBatch(<span class="hljs-number">250</span>);          <span class="hljs-keyword">try</span> &#123;              cyclicBarrier.await();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;              e.printStackTrace();            &#125; <span class="hljs-keyword">catch</span> (BrokenBarrierException e) &#123;              e.printStackTrace();            &#125;        &#125;);    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertByBatch</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;  Connection conn = JdbcUtil.getConnFromHikari();    Statement stat = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();    <span class="hljs-keyword">try</span> &#123;      stat = conn.createStatement();      String sql;      StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-string">&quot;insert into tb_order_test_1(good_id, user_id, good_status, username) values&quot;</span>);      conn.setAutoCommit(<span class="hljs-keyword">false</span>);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) &#123;              sb.append(<span class="hljs-string">&quot;(&quot;</span> + i +<span class="hljs-string">&quot; , &quot;</span> + j +<span class="hljs-string">&quot;, 1 , &#x27;daiwei&#x27;),&quot;</span>);            &#125;          sql = sb.deleteCharAt(sb.length() - <span class="hljs-number">1</span>).toString();          stat.addBatch(sql);          sb.delete(<span class="hljs-number">75</span>, sb.length());        &#125;      stat.executeBatch();      conn.commit();      System.out.println(System.currentTimeMillis() - start);    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;      throwables.printStackTrace();    &#125; <span class="hljs-keyword">finally</span> &#123;      JdbcUtil.release(conn, stat, <span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre></div><p>æœç„¶å‘æŒ¥å¤šçº¿ç¨‹çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæ•´ä½“æ€§èƒ½ä¼˜èƒ½å¾€ä¸Šæå‡ä¸€ç‚¹ç‚¹ã€‚</p><h3 id="æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°"><a href="#æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°" class="headerlink" title="æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°"></a>æ³¥å·´è·¯ä¸Šèµ°ä¸€èµ°</h3><p>å®é™…ç”Ÿäº§ç¯å¢ƒçš„è¯ï¼Œå¹¶ä¸ä¼šæœ‰å‡ ä¸ªè¡¨åªæœ‰ å‡ ä¸ªå­—æ®µï¼Œå¤šæ˜¯å­—æ®µ20+ ï¼Œæ‰€ä»¥å¦‚æœå­—æ®µå¤šä¸Šå»ï¼Œæ’å…¥æ€§èƒ½æ˜¯å¦ä¼šå—åˆ°å½±å“ï¼Ÿå¦‚æ­¤ä¾¿æœ‰äº†ä¸‹é¢çš„æµ‹è¯•</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tb_order_test` (  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  `good_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `user_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `good_status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,  `field_4` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_5` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_6` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_7` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_8` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_9` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_10` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_11` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_12` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_13` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_14` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_15` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_16` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_17` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_18` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_19` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_20` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_21` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_22` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_23` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_24` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_25` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_26` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_27` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_28` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_29` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `field_30` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">5214001</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>latin1;</code></pre></div><p>æµ‹è¯•ä»£ç çš„è¯è¿™é‡Œç”¨çš„è¿˜æ˜¯ å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç† çš„ pro ç‰ˆæœ¬ï¼Œæœç„¶è¿™æ¬¡çš„æµ‹è¯•çš„é€Ÿåº¦æœ‰å¾ˆæ˜æ˜¾çš„ä¸‹é™ 100w çš„æ’å…¥æ—¶é—´ åˆ°äº† 19866msï¼Œæˆ‘çš„ç”µè„‘æ˜¯ 8 æ ¸çš„ï¼Œæœ¬ç€å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºå’Œæ•°æ®åº“å¹¶å‘èµ„æºçš„åŸåˆ™ã€‚æœ€ç»ˆçš„ 100w æ—¶é—´åˆ°äº† 18080msã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­æœ‰å¾ˆå¤šçš„ç¯å¢ƒå› ç´ ï¼šmysqlæ•°æ®åº“ã€sqlè¯­å¥å’Œ javaä»£ç ç­‰å¤šä¸ªæ–¹é¢ï¼Œå…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ¨åˆ†å‡ºç°ç“¶é¢ˆï¼Œéƒ½ä¼šæ‹–ç´¯æ•´ä½“çš„æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœæ¢ä¸ªè§’åº¦å»çœ‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æ¯ä¸ªéƒ¨åˆ†çš„æ€§èƒ½éƒ½èƒ½å……åˆ†å‘æŒ¥æ•´ä½“çš„æ€§èƒ½ä¹Ÿç›¸åº”æé«˜ã€‚æœ¬æ¬¡çš„ä¼˜åŒ–è¿‡ç¨‹ä» sqléƒ¨åˆ†ï¼Œç¼–ç æŠ€å·§åˆ°è¡¨ç»“æ„ä¼˜åŒ–å»å°½å¯èƒ½æå‡100wæ•°æ®çš„æ’å…¥é€Ÿåº¦ã€‚è¿™é‡Œæ¼äº†ä¸€ä¸ªè§’åº¦ï¼Œå°±æ˜¯è°ƒæ•´mysql çš„å‚æ•°å»ä¼˜åŒ–ï¼Œåœ¨mysql å†™å…¥è¿‡ç¨‹ä¸­æœ‰ WAL æœºåˆ¶ï¼Œå¦‚æœè¿™é‡Œè°ƒå¤§ redolog buf å°½å¯èƒ½å°‘çš„å‡å°‘ redolog çš„ åˆ·è„é¡µæ“ä½œï¼Œæ˜¯å¦ä¹Ÿèƒ½æå‡å†™å…¥çš„æ€§èƒ½å‘¢ï¼ŸğŸ¤”ï¼Œæœ€åä¸‹é¢æ˜¯æœ¬æ¬¡æµ‹è¯•ç»“æœè¡¨æ ¼</p><table><thead><tr><th>æ’å…¥æ–¹å¼</th><th>1w</th><th>10w</th><th>100W</th></tr></thead><tbody><tr><td>æ•°æ®åº“å·¥å…·å¯¼å…¥</td><td>-</td><td>-</td><td>7500ms</td></tr><tr><td>å•ä¸ªäº‹åŠ¡å¾ªç¯æ’å…¥</td><td>24015ms</td><td>-</td><td>-</td></tr><tr><td>å•ä¸ªäº‹åŠ¡batchæ‰¹å¤„ç†</td><td>11358ms</td><td>-</td><td>-</td></tr><tr><td>é­”æ”¹ batch <br />ï¼ˆrewriteBatchedStatementsï¼‰</td><td>689ms</td><td>1562ms</td><td>8775ms</td></tr><tr><td>æ‹¼æ¥sql + æ‰¹å¤„ç†</td><td>105ms</td><td>992ms</td><td>5302ms</td></tr><tr><td>å¤šçº¿ç¨‹ + æ‹¼æ¥sql + æ‰¹å¤„ç†</td><td>-</td><td>-</td><td>4314ms</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>éšç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>jdbc</tag>
      
      <tag>å®æ“</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
